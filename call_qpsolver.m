function [solution,alloc_out,status]=call_qpsolver(T_r,method,N_max_thr)
c_scale=1;
thruster_data = struct('label',{1,2,3,4,5,6,7,8}, ...
                        'type',{4,3,2,2,2,3,3,3}, ...
                        'enable',{1,1,1,1,1,1,1,1}, ...
                        'reserved',0, ...
                        'dt',0.5, ...
                        'x0',0, ...
                        'y0',0, ...
                        'x',{10,-30,-30,21,23,18,5,5}, ...
                        'y',{4,-3.5,3.5,0,0,0,4,-4}, ...
                        'T',{5435*c_scale,3510*c_scale,3510*c_scale,70000*1*c_scale,3211*c_scale,231*c_scale,42200*c_scale,5866*c_scale}, ...
                        'phi',{pi/2,0,0,0,0,0,0,0}, ...
                        'Tmax',71500*c_scale, ...
                        'Tmin',0, ...
                        'dTmax',7150*c_scale, ...
                        'dphi_max',0.1, ...
                        'Tplus',0, ...
                        'T_',0, ...
                        'phiPlus',0, ...
                        'phi_',0, ...
                        'phi_min',{-1.04,-1.04,2.09,-1.04,-1,-0.69,-2.4,0.01}, ...
                        'phi_max',{-2.09,-2.09,1.04,-2.09,2,0.69,2.4,6}, ...
                        'weight',[1 1],...
                        'weight_s',[1000000 1000000 100000000]'*1e0);


rudder_table = [0,0.980000000000000,0,0,0.980000000000000;0.0872664625997165,0.965000000000000,0.0800000000000000,0.0827124154481730,0.968310384122777;0.174532925199433,0.956000000000000,0.163000000000000,0.168878105792867,0.969796370378854;0.261799387799149,0.920000000000000,0.200000000000000,0.214060683563822,0.941488183675186;0.349065850398866,0.895000000000000,0.287000000000000,0.310310945764607,0.939890419144700;0.436332312998582,0.840000000000000,0.300000000000000,0.343023940420703,0.891964124839110;0.523598775598299,0.811000000000000,0.341000000000000,0.398026222516986,0.879773834573409;0.610865238198015,0.770000000000000,0.345000000000000,0.421232744089294,0.843756481456587;0.698131700797732,0.743000000000000,0.347000000000000,0.436921840812821,0.820035365091043];


thruster_data_in = thruster_data(1);
coder.varsize('thruster_data_in')

N_enabled_thruster=0;


for i = 1:N_max_thr
    if thruster_data(i).enable == 1
        N_enabled_thruster = N_enabled_thruster + 1;
        thruster_data_in(end+1) = thruster_data(i);
    end
end
thruster_data_in(1) = [];
[solution,alloc_out,status]=qpsolver(thruster_data_in,T_r,N_enabled_thruster,rudder_table,method);
end