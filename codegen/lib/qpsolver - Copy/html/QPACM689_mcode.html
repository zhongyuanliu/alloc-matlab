<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="147,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T1U3">x</span>,<span class="var type1" id="S3T3U4">flag</span>]=QPACM(<span class="var type1" id="S4T18U7">B</span>,<span class="var type1" id="S5T1U8">b</span>,<span class="var type1" id="S6T18U9">C</span>,<span class="var type1" id="S7T1U10">c</span>,<span class="var type1" id="S8T18U11">A</span>,<span class="var type1" id="S9T1U12">d</span>,<span class="var type1" id="S10T1U13">x0</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="147,2" id="srcline2">  2</a></span><span class="line"><span class="comment">%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,3" id="srcline3">  3</a></span><span class="line"><span class="comment">% min f(x)=1/2*x'*B*x - b'*x  %NB</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,4" id="srcline4">  4</a></span><span class="line"><span class="comment">% C*x = c</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,5" id="srcline5">  5</a></span><span class="line"><span class="comment">% A * x &lt;= d %NB</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,6" id="srcline6">  6</a></span><span class="line"><span class="comment">% assert (M_A &lt;= 1000);</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,7" id="srcline7">  7</a></span><span class="line">coder.varsize(<span class="string">'W.A'</span>,<span class="string">'W.d'</span>);<span class="comment">%!!!!!!!!!very important</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,8" id="srcline8">  8</a></span><span class="line"><span class="mxinfo " id="T3:U10"><span class="var type1" id="S3T3U23">flag</span> = <span class="mxinfo " id="T3:U12">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="147,9" id="srcline9">  9</a></span><span class="line"><span class="mxinfo " id="T3:U13"><span class="var type1" id="S12T3U27">tol</span> = <span class="mxinfo " id="T3:U15">1e-8</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="147,10" id="srcline10"> 10</a></span><span class="line"><span class="mxinfo " id="T1:U16"><span class="var type1" id="S2T1U31">x</span>=<span class="var type1" id="S10T1U32">x0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="147,11" id="srcline11"> 11</a></span><span class="line"><span class="comment">% W.A = A([1],:);</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,12" id="srcline12"> 12</a></span><span class="line"><span class="comment">% W.d = d([1]);</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,13" id="srcline13"> 13</a></span><span class="line"><span class="mxinfo " id="T18:U19"><span class="mxinfo " id="T18:U20"><span class="var type1" id="S13T126U36">W</span>.A</span>=<span class="mxinfo " id="T127:U22">zeros(<span class="mxinfo " id="T3:U23">0</span>,<span class="mxinfo " id="T3:U24">size(<span class="var type1" id="S8T18U43">A</span>,2)</span>)</span></span>;<span class="comment">%empty</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,14" id="srcline14"> 14</a></span><span class="line"><span class="mxinfo " id="T18:U26"><span class="mxinfo " id="T18:U27"><span class="var type1" id="S13T126U48">W</span>.d</span>=<span class="mxinfo " id="T47:U29">[]</span></span>;<span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,15" id="srcline15"> 15</a></span><span class="line"><span class="comment">% [CW.A,IA] = setdiff(A,W.A,'rows','stable');%set1 - set2</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,16" id="srcline16"> 16</a></span><span class="line"><span class="mxinfo " id="T18:U30"><span class="mxinfo " id="T18:U31"><span class="var type1" id="S16T128U55">CW</span>.A</span> = <span class="var type1" id="S8T18U57">A</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="147,17" id="srcline17"> 17</a></span><span class="line"><span class="mxinfo " id="T1:U34"><span class="mxinfo " id="T1:U35"><span class="var type1" id="S16T128U61">CW</span>.d</span> = <span class="var type1" id="S9T1U63">d</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="147,18" id="srcline18"> 18</a></span><span class="line"><span class="comment">% CW.d = d(IA);</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,19" id="srcline19"> 19</a></span><span class="line"><span class="mxinfo " id="T3:U38"><span class="var type1" id="S17T3U66">m_C</span> = <span class="mxinfo " id="T3:U40">size(<span class="var type1" id="S6T18U69">C</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="147,20" id="srcline20"> 20</a></span><span class="line"><span class="mxinfo " id="T3:U42"><span class="var type1" id="S18T3U73">max_iter</span> = <span class="mxinfo " id="T3:U44">200</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="147,21" id="srcline21"> 21</a></span><span class="line"><span class="mxinfo " id="T3:U45"><span class="var type1" id="S19T3U77">i</span> = <span class="mxinfo " id="T3:U47">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="147,22" id="srcline22"> 22</a></span><span class="line"><span class="keyword">while</span> <span class="mxinfo " id="T11:U48"><span class="var type1" id="S19T3U81">i</span>&lt;<span class="var type1" id="S18T3U82">max_iter</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="147,23" id="srcline23"> 23</a></span><span class="line"><span class="mxinfo " id="T3:U51"><span class="var type1" id="S19T3U85">i</span> = <span class="mxinfo " id="T3:U53"><span class="var type1" id="S19T3U87">i</span> + <span class="mxinfo " id="T3:U55">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="147,24" id="srcline24"> 24</a></span><span class="line"><span class="mxinfo " id="T3:U56"><span class="var type1" id="S3T3U91">flag</span> = <span class="var type1" id="S19T3U92">i</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="147,25" id="srcline25"> 25</a></span><span class="line"><span class="comment">% check_rank = (rank([C;W.A])==size([C;W.A],1));</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,26" id="srcline26"> 26</a></span><span class="line">[ <span class="var type1" id="S20T1U96">p</span>,<span class="var type1" id="S21T18U97">r</span>] = <span class="fcn" id="F708N6:B99">null_space</span>(<span class="var type1" id="S4T18U100">B</span>,<span class="mxinfo " id="T1:U62"><span class="mxinfo " id="T1:U63"><span class="var type1" id="S4T18U103">B</span>*<span class="var type1" id="S2T1U104">x</span></span>-<span class="var type1" id="S5T1U105">b</span></span>,<span class="mxinfo " id="T18:U67">[<span class="var type1" id="S6T18U108">C</span>;<span class="mxinfo " id="T18:U69"><span class="var type1" id="S13T126U111">W</span>.A</span>]</span>,<span class="mxinfo " id="T18:U71"><span class="mxinfo " id="T3:U72">0</span>*<span class="mxinfo " id="T18:U73">[<span class="var type1" id="S7T1U117">c</span>;<span class="mxinfo " id="T18:U75"><span class="var type1" id="S13T126U120">W</span>.d</span>]</span></span>);<span class="comment">%null space is better</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,27" id="srcline27"> 27</a></span><span class="line"><span class="mxinfo " id="T1:U77"><span class="var type1" id="S20T1U124">p</span> = <span class="mxinfo " id="T1:U79"><span class="var type1" id="S20T1U126">p</span> .* (<span class="mxinfo " id="T21:U81"><span class="mxinfo " id="T1:U82">abs(<span class="var type1" id="S20T1U131">p</span>)</span>&gt;<span class="var type1" id="S12T3U132">tol</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="147,28" id="srcline28"> 28</a></span><span class="line"><span class="mxinfo " id="T18:U85"><span class="var type1" id="S21T18U135">r</span> = <span class="mxinfo " id="T18:U87"><span class="var type1" id="S21T18U137">r</span> .* (<span class="mxinfo " id="T129:U89"><span class="mxinfo " id="T18:U90">abs(<span class="var type1" id="S21T18U142">r</span>)</span>&gt;<span class="var type1" id="S12T3U143">tol</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="147,29" id="srcline29"> 29</a></span><span class="line"><span class="comment">% lambda = r(1:m_C);</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,30" id="srcline30"> 30</a></span><span class="line"><span class="mxinfo " id="T10:U93"><span class="var type1" id="S24T10U146">miu</span> = <span class="mxinfo " id="T10:U95"><span class="var type1" id="S21T18U148">r</span>(<span class="mxinfo " id="T10:U97"><span class="mxinfo " id="T3:U98"><span class="var type1" id="S17T3U151">m_C</span> + <span class="mxinfo " id="T3:U100">1</span></span>:end</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="147,31" id="srcline31"> 31</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="147,32" id="srcline32"> 32</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T11:U101"><span class="mxinfo " id="T3:U102">sum(<span class="mxinfo " id="T1:U103">abs(<span class="var type1" id="S20T1U162">p</span>)</span>)</span> == <span class="mxinfo " id="T3:U105">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="147,33" id="srcline33"> 33</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo " id="T11:U106"><span class="mxinfo " id="T3:U107">min(<span class="var type1" id="S24T10U169">miu</span>)</span>&gt;=<span class="mxinfo " id="T3:U109">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="147,34" id="srcline34"> 34</a></span><span class="line">        <span class="mxinfo " id="T3:U110"><span class="var type1" id="S3T3U173">flag</span>=<span class="var type1" id="S19T3U174">i</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="147,35" id="srcline35"> 35</a></span><span class="line">        <span class="keyword">break</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="147,36" id="srcline36"> 36</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,37" id="srcline37"> 37</a></span><span class="line">        [<span class="mxinfo " id="T3:U113">~</span>,<span class="var type1" id="S28T3U181">I</span>] = min(<span class="var type1" id="S24T10U184">miu</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="147,38" id="srcline38"> 38</a></span><span class="line">        <span class="mxinfo " id="T18:U116"><span class="mxinfo " id="T18:U117"><span class="var type1" id="S16T128U188">CW</span>.A</span> = <span class="mxinfo " id="T18:U119">[<span class="mxinfo " id="T18:U120"><span class="var type1" id="S16T128U193">CW</span>.A</span>;<span class="mxinfo " id="T10:U122"><span class="mxinfo " id="T18:U123"><span class="var type1" id="S13T126U198">W</span>.A</span>(<span class="var type1" id="S28T3U200">I</span>,<span class="mxinfo " id="T30:U126">:</span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="147,39" id="srcline39"> 39</a></span><span class="line">        <span class="mxinfo " id="T1:U127"><span class="mxinfo " id="T1:U128"><span class="var type1" id="S16T128U205">CW</span>.d</span> = <span class="mxinfo " id="T1:U130">[<span class="mxinfo " id="T1:U131"><span class="var type1" id="S16T128U210">CW</span>.d</span>;<span class="mxinfo " id="T3:U133"><span class="mxinfo " id="T18:U134"><span class="var type1" id="S13T126U215">W</span>.d</span>(<span class="var type1" id="S28T3U217">I</span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="147,40" id="srcline40"> 40</a></span><span class="line">        <span class="keyword">if</span> (<span class="mxinfo " id="T11:U137">~isempty(<span class="mxinfo " id="T10:U138"><span class="mxinfo " id="T18:U139"><span class="var type1" id="S13T126U227">W</span>.A</span>(<span class="var type1" id="S28T3U229">I</span>,<span class="mxinfo " id="T30:U142">:</span>)</span>)</span>) &amp;&amp; (~isempty(<span class="mxinfo " id="T14:U143"><span class="mxinfo " id="T18:U144"><span class="var type1" id="S13T126U237">W</span>.d</span>(<span class="var type1" id="S28T3U239">I</span>)</span>))</span></span>
<span class="srcline"><span class="lineno"><a href="147,41" id="srcline41"> 41</a></span><span class="line">        <span class="mxinfo " id="T18:U147"><span class="mxinfo " id="T18:U148"><span class="var type1" id="S13T126U244">W</span>.A</span>(<span class="var type1" id="S28T3U246">I</span>,:) = []</span>;<span class="comment">%delete constr</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,42" id="srcline42"> 42</a></span><span class="line">        <span class="mxinfo " id="T18:U151"><span class="mxinfo " id="T18:U152"><span class="var type1" id="S13T126U254">W</span>.d</span>(<span class="var type1" id="S28T3U256">I</span>) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="147,43" id="srcline43"> 43</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,44" id="srcline44"> 44</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,45" id="srcline45"> 45</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,46" id="srcline46"> 46</a></span><span class="line">    <span class="mxinfo " id="T1:U155"><span class="var type1" id="S30T1U262">temp</span> = <span class="mxinfo " id="T1:U157"><span class="mxinfo " id="T18:U158"><span class="var type1" id="S16T128U265">CW</span>.A</span> * <span class="var type1" id="S20T1U267">p</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="147,47" id="srcline47"> 47</a></span><span class="line">    <span class="mxinfo " id="T1:U161"><span class="var type1" id="S28T1U270">I</span> = <span class="mxinfo " id="T1:U163">find(<span class="mxinfo " id="T21:U164"><span class="var type1" id="S30T1U274">temp</span>&lt;<span class="mxinfo " id="T3:U166">-<span class="var type1" id="S12T3U276">tol</span></span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="147,48" id="srcline48"> 48</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="147,49" id="srcline49"> 49</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo " id="T11:U168">isempty(<span class="var type1" id="S28T1U281">I</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,50" id="srcline50"> 50</a></span><span class="line">        <span class="mxinfo " id="T3:U170"><span class="var type1" id="S32T3U284">alpha</span> = <span class="mxinfo " id="T3:U172">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="147,51" id="srcline51"> 51</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,52" id="srcline52"> 52</a></span><span class="line">    [<span class="var type1" id="S32T3U290">alpha</span>,<span class="var type1" id="S33T3U291">Imin_alpha</span>] = min(<span class="mxinfo " id="T1:U175">(<span class="mxinfo " id="T1:U176"><span class="mxinfo " id="T1:U177"><span class="mxinfo " id="T18:U178"><span class="mxinfo " id="T18:U179"><span class="var type1" id="S16T128U300">CW</span>.A</span>(<span class="var type1" id="S28T1U302">I</span>,<span class="mxinfo " id="T30:U182">:</span>)</span> * <span class="var type1" id="S2T1U304">x</span></span> - <span class="mxinfo " id="T1:U184"><span class="mxinfo " id="T1:U185"><span class="var type1" id="S16T128U307">CW</span>.d</span>(<span class="var type1" id="S28T1U309">I</span>)</span></span>)./(<span class="mxinfo " id="T1:U188"><span class="mxinfo " id="T18:U189"><span class="mxinfo " id="T18:U190"><span class="var type1" id="S16T128U314">CW</span>.A</span>(<span class="var type1" id="S28T1U316">I</span>,<span class="mxinfo " id="T30:U193">:</span>)</span> * <span class="var type1" id="S20T1U318">p</span></span>)</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="147,53" id="srcline53"> 53</a></span><span class="line">    <span class="mxinfo " id="T3:U195">[<span class="var type1" id="S32T3U322">alpha</span>] = <span class="mxinfo " id="T3:U197">min(<span class="mxinfo " id="T3:U198">1</span>,<span class="var type1" id="S32T3U326">alpha</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="147,54" id="srcline54"> 54</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,55" id="srcline55"> 55</a></span><span class="line">    <span class="mxinfo " id="T1:U200"><span class="var type1" id="S2T1U329">x</span> = <span class="mxinfo " id="T1:U202"><span class="var type1" id="S2T1U331">x</span> -<span class="mxinfo " id="T1:U204"><span class="var type1" id="S32T3U333">alpha</span> * <span class="var type1" id="S20T1U334">p</span></span></span></span>;<span class="comment">%NB</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,56" id="srcline56"> 56</a></span><span class="line">    <span class="keyword">if</span>  <span class="mxinfo " id="T11:U207"><span class="var type1" id="S32T3U338">alpha</span>&lt;<span class="mxinfo " id="T3:U209">1</span></span>    <span class="comment">%alpha&gt;0 &amp;&amp;</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,57" id="srcline57"> 57</a></span><span class="line"><span class="comment">%         [~,Imin_alpha] = min((CW.A(I,:) * x - CW.d(I))./(CW.A(I,:) * p));</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,58" id="srcline58"> 58</a></span><span class="line">        <span class="mxinfo " id="T18:U210"><span class="mxinfo " id="T18:U211"><span class="var type1" id="S13T126U343">W</span>.A</span> = <span class="mxinfo " id="T18:U213">[<span class="mxinfo " id="T18:U214"><span class="var type1" id="S13T126U348">W</span>.A</span>;<span class="mxinfo " id="T10:U216"><span class="mxinfo " id="T18:U217"><span class="var type1" id="S16T128U353">CW</span>.A</span>(<span class="mxinfo " id="T3:U219"><span class="var type1" id="S28T1U356">I</span>(<span class="var type1" id="S33T3U357">Imin_alpha</span>)</span>,<span class="mxinfo " id="T30:U222">:</span>)</span>]</span></span>;<span class="comment">%add constr</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,59" id="srcline59"> 59</a></span><span class="line">        <span class="mxinfo " id="T18:U223"><span class="mxinfo " id="T18:U224"><span class="var type1" id="S13T126U362">W</span>.d</span> = <span class="mxinfo " id="T1:U226">[<span class="mxinfo " id="T18:U227"><span class="var type1" id="S13T126U367">W</span>.d</span>;<span class="mxinfo " id="T3:U229"><span class="mxinfo " id="T1:U230"><span class="var type1" id="S16T128U372">CW</span>.d</span>(<span class="mxinfo " id="T3:U232"><span class="var type1" id="S28T1U375">I</span>(<span class="var type1" id="S33T3U376">Imin_alpha</span>)</span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="147,60" id="srcline60"> 60</a></span><span class="line">        <span class="mxinfo " id="T18:U235"><span class="mxinfo " id="T18:U236"><span class="var type1" id="S16T128U381">CW</span>.A</span>(<span class="mxinfo " id="T3:U238"><span class="var type1" id="S28T1U384">I</span>(<span class="var type1" id="S33T3U385">Imin_alpha</span>)</span>,:) = []</span>;<span class="comment">%delete</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,61" id="srcline61"> 61</a></span><span class="line">        <span class="mxinfo " id="T1:U241"><span class="mxinfo " id="T1:U242"><span class="var type1" id="S16T128U393">CW</span>.d</span>(<span class="mxinfo " id="T3:U244"><span class="var type1" id="S28T1U396">I</span>(<span class="var type1" id="S33T3U397">Imin_alpha</span>)</span>) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="147,62" id="srcline62"> 62</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,63" id="srcline63"> 63</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,64" id="srcline64"> 64</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,65" id="srcline65"> 65</a></span><span class="line"><span class="comment">% 1/2*x'*B*x - b'*x;</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,66" id="srcline66"> 66</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
