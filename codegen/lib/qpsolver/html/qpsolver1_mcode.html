<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T1U3">solution</span>,<span class="var type1" id="S3T2U4">alloc_out</span>,<span class="var type1" id="S4T4U5">thruster_data</span>,<span class="var type1" id="S5T3U6">status</span>]=qpsolver(<span class="var type1" id="S6T7U9">init</span>,<span class="var type1" id="S4T4U10">thruster_data</span>,<span class="var type1" id="S7T8U11">T_r</span>,<span class="var type1" id="S8T3U12">N_enabled_thruster</span>,<span class="var type1" id="S9T9U13">rudder_table0</span>,<span class="var type1" id="S10T3U14">no_azi_angle_constr</span>,<span class="var type1" id="S11T3U15">method</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2">  2</a></span><span class="line"><span class="comment">% method == 1 qpkwik</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3">  3</a></span><span class="line"><span class="comment">% method == 2 sef made primal active set</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4">  4</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5">  5</a></span><span class="line"><span class="comment">% solves a quadratic program to determine an optimal solution, x.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6">  6</a></span><span class="line"><span class="comment">% It minimizes the quadratic objective function, J = 0.5*x'*H*x + f'*x,</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7">  7</a></span><span class="line"><span class="comment">% subject to linear inequality constraints, A*x &gt;= b, and linear equality</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8">  8</a></span><span class="line"><span class="comment">% constraints, Aeq*x = beq, where x is a column vector of length n.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9">  9</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10"> 10</a></span><span class="line"><span class="comment">% H is the n-by-n hessian matrix, which must be symmetric and positive</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11"> 11</a></span><span class="line"><span class="comment">% definite.  L is its lower-triangular Cholesky decomposition and Linv is</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12"> 12</a></span><span class="line"><span class="comment">% the inverse of L.  Consequently, Linv can be computed from H as follows</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13"> 13</a></span><span class="line"><span class="comment">% in MATLAB:</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14"> 14</a></span><span class="line"><span class="comment">%   L = chol(H, 'lower')</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15"> 15</a></span><span class="line"><span class="comment">%   Linv = L\eye(size(H,1))</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16"> 16</a></span><span class="line"><span class="comment">% Note that H = L*L'</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17"> 17</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18"> 18</a></span><span class="line"><span class="comment">% Input arguments (all are mandatory):</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19"> 19</a></span><span class="line"><span class="comment">%    Linv:  n-by-n (n&gt;0) matrix representing the inverse of L.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20"> 20</a></span><span class="line"><span class="comment">%       f:  column vector of length n (n&gt;0).</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21"> 21</a></span><span class="line"><span class="comment">%       A:  m-by-n matrix of linear inequality constraint coefficients.  If</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22"> 22</a></span><span class="line"><span class="comment">%           your problem has no inequality constraints, use [].</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23"> 23</a></span><span class="line"><span class="comment">%       b:  column vector of length m, the right-hand side of A*x &gt;= b.  If</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24"> 24</a></span><span class="line"><span class="comment">%           your problem has no inequality constraints, use "zeros(0,1)".</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25"> 25</a></span><span class="line"><span class="comment">%     Aeq:  q-by-n matrix of linear equality constraint coefficients,</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26"> 26</a></span><span class="line"><span class="comment">%           q &lt;= n.  If your problem has no equality constraints, use [].</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27"> 27</a></span><span class="line"><span class="comment">%           NOTE:  equality constraints must be linearly independent with</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28"> 28</a></span><span class="line"><span class="comment">%           rank(Aeq) = q.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29"> 29</a></span><span class="line"><span class="comment">%     beq:  column vector of length q, the right-hand side of Aeq*x = beq.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30"> 30</a></span><span class="line"><span class="comment">%           If your problem has no equality constraints, use "zeros(0,1)".</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31"> 31</a></span><span class="line"><span class="comment">%     iA0:  logical vector of length m.  If your problem has no inequality</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32"> 32</a></span><span class="line"><span class="comment">%           constraints, use "false(0,1)".  For a "cold start": use</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33"> 33</a></span><span class="line"><span class="comment">%           false(m,1).  For a "warm start": if iA0(i) == true, the</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34"> 34</a></span><span class="line"><span class="comment">%           algorithm begins with A(i,:)*x = b(i), i.e., with the ith</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35"> 35</a></span><span class="line"><span class="comment">%           inequality active.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36"> 36</a></span><span class="line"><span class="comment">%           Tips:</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37"> 37</a></span><span class="line"><span class="comment">%           (1) Normally, you should use the optional output argument iA</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38"> 38</a></span><span class="line"><span class="comment">%           from a previous solution as the input iA0 in the next</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39"> 39</a></span><span class="line"><span class="comment">%           calculation.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40"> 40</a></span><span class="line"><span class="comment">%           (2) if iA0(i) and iA0(j) are true, rows i and j of A should be</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41"> 41</a></span><span class="line"><span class="comment">%           linearly independent.  Otherwise, the solution may fail (status</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42"> 42</a></span><span class="line"><span class="comment">%           = -2). This should not happen if you use iA from a previous</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,43" id="srcline43"> 43</a></span><span class="line"><span class="comment">%           solution as recommended above.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,44" id="srcline44"> 44</a></span><span class="line"><span class="comment">% options:  Structure with following fields used by the QP solver.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,45" id="srcline45"> 45</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,46" id="srcline46"> 46</a></span><span class="line"><span class="comment">%                  DataType: string, either 'double' or 'single'.  All the</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,47" id="srcline47"> 47</a></span><span class="line"><span class="comment">%                            real input arguments to the "mpcqpsolver"</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,48" id="srcline48"> 48</a></span><span class="line"><span class="comment">%                            command must match this data type and it is</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,49" id="srcline49"> 49</a></span><span class="line"><span class="comment">%                            used in both simulation and code generation.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,50" id="srcline50"> 50</a></span><span class="line"><span class="comment">%                            Default value is 'double'.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,51" id="srcline51"> 51</a></span><span class="line"><span class="comment">%                   MaxIter: scalar, maximum number of iterations allowed</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,52" id="srcline52"> 52</a></span><span class="line"><span class="comment">%                            when computing QP solution.  Default value is</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,53" id="srcline53"> 53</a></span><span class="line"><span class="comment">%                            200.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,54" id="srcline54"> 54</a></span><span class="line"><span class="comment">%            FeasibilityTol: scalar, tolerance used to verify that</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,55" id="srcline55"> 55</a></span><span class="line"><span class="comment">%                            inequality constraints are satisfied at the</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,56" id="srcline56"> 56</a></span><span class="line"><span class="comment">%                            optimal solution.  Increasing this causes</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,57" id="srcline57"> 57</a></span><span class="line"><span class="comment">%                            MPCQPSOLVER to allow larger constraint</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,58" id="srcline58"> 58</a></span><span class="line"><span class="comment">%                            violations. Default value is 1.0e-6.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,59" id="srcline59"> 59</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,60" id="srcline60"> 60</a></span><span class="line"><span class="comment">%           Use the MPCQPSOLVEROPTIONS command to create such a structure</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,61" id="srcline61"> 61</a></span><span class="line"><span class="comment">%           with default values.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,62" id="srcline62"> 62</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,63" id="srcline63"> 63</a></span><span class="line"><span class="comment">% Output arguments:</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,64" id="srcline64"> 64</a></span><span class="line"><span class="comment">%       x: column vector of length n, representing the optimal solution.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,65" id="srcline65"> 65</a></span><span class="line"><span class="comment">%          MPCQPSOLVER will return x in all cases, but it is likely to be</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,66" id="srcline66"> 66</a></span><span class="line"><span class="comment">%          sub-optimal and/or infeasible unless status &gt; 0.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,67" id="srcline67"> 67</a></span><span class="line"><span class="comment">%  status: scalar, indicating the validity of the returned x as follows:</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,68" id="srcline68"> 68</a></span><span class="line"><span class="comment">%            &gt;  0:  x is optimal, representing the number of iterations</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,69" id="srcline69"> 69</a></span><span class="line"><span class="comment">%                   used in optimization.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,70" id="srcline70"> 70</a></span><span class="line"><span class="comment">%           ==  0:  x was obtained when maximum number of iterations is</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,71" id="srcline71"> 71</a></span><span class="line"><span class="comment">%                   reached.  It may be sub-optimal and/or violate A*x &gt;=b.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,72" id="srcline72"> 72</a></span><span class="line"><span class="comment">%           == -1:  The problem appears to be infeasible.  In other words,</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,73" id="srcline73"> 73</a></span><span class="line"><span class="comment">%                   A*x &gt;= b cannot be satisfied.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,74" id="srcline74"> 74</a></span><span class="line"><span class="comment">%           == -2:  An unrecoverable numerical error occurred (e.g., see</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,75" id="srcline75"> 75</a></span><span class="line"><span class="comment">%                   description of iA0).</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,76" id="srcline76"> 76</a></span><span class="line"><span class="comment">%      iA: logical vector of length m, indicating the inequalities that</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,77" id="srcline77"> 77</a></span><span class="line"><span class="comment">%          are active (at equality) at the solution.  In a series of</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,78" id="srcline78"> 78</a></span><span class="line"><span class="comment">%          problems in which A is constant, you can use iA from one</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,79" id="srcline79"> 79</a></span><span class="line"><span class="comment">%          solution as the input iA0 to the next ("warm start").</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,80" id="srcline80"> 80</a></span><span class="line"><span class="comment">%  lambda: structure of Lagrange multipliers with two fields:</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,81" id="srcline81"> 81</a></span><span class="line"><span class="comment">%           ineqlin: column vector of length m, multipliers of the</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,82" id="srcline82"> 82</a></span><span class="line"><span class="comment">%                    inequality constraints.  Must be non-negative at an</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,83" id="srcline83"> 83</a></span><span class="line"><span class="comment">%                    optimal solution.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,84" id="srcline84"> 84</a></span><span class="line"><span class="comment">%             eqlin: column vector of length q, multipliers of the equality</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,85" id="srcline85"> 85</a></span><span class="line"><span class="comment">%                    constraints.  No sign restriction.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,86" id="srcline86"> 86</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,87" id="srcline87"> 87</a></span><span class="line"><span class="comment">%  command for code generation:</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,88" id="srcline88"> 88</a></span><span class="line"><span class="comment">%  cfg = coder.config('lib');</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,89" id="srcline89"> 89</a></span><span class="line"><span class="comment">%  codegen -config cfg -c  -args {init,thruster_data,T_r,N_enabled_thruster,rudder_table,0,1} qpsolver</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,90" id="srcline90"> 90</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,91" id="srcline91"> 91</a></span><span class="line"><span class="comment">%  update:</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,92" id="srcline92"> 92</a></span><span class="line"><span class="comment">%  1.01 add check_phi in pre_qp.m to make sure initial phi meets</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,93" id="srcline93"> 93</a></span><span class="line"><span class="comment">%  constraint. |29-11-2016 by Liu</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,94" id="srcline94"> 94</a></span><span class="line"><span class="comment">%  1.02 correct mark8 and add if status &lt; 0 then break to avoid risk of</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,95" id="srcline95"> 95</a></span><span class="line"><span class="comment">%  infinite loop. |29-11-2016 by Liu</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,96" id="srcline96"> 96</a></span><span class="line"><span class="comment">%  1.04 change alloc_out(i).phi = thruster_data(i).phi;%output is equal to input for tunnel thruster</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,97" id="srcline97"> 97</a></span><span class="line"><span class="comment">%  1.05 improve function check_angle(phi_min,phi_,phi,phiPlus,phi_max) and angleMaxMin(angle_start,angle_end,phi,phi1,phi2)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,98" id="srcline98"> 98</a></span><span class="line"><span class="comment">%  1.06 guarantee initial x feasible, add mark8(i) = 2 to avoid infinite</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,99" id="srcline99"> 99</a></span><span class="line"><span class="comment">%  loop, add count_run &gt; 50 then break |03-01-2017 by Liu</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,100" id="srcline100">100</a></span><span class="line"><span class="comment">%  1.07 guarantee tunnel angle input feasible |23-01-2017 by Liu</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,101" id="srcline101">101</a></span><span class="line"><span class="comment">%  4.01 base thrust added, Tmin of azi must be zero in thrust_config !!!!!</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,102" id="srcline102">102</a></span><span class="line"><span class="comment">%  and bastT must be half of real Tmin. dt*dphi_max is replaced by a bigger constant |01-02-2017 by Liu</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,103" id="srcline103">103</a></span><span class="line"><span class="comment">%  4.04 azi use efficiency one by one |03-02-2017 by Liu</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,104" id="srcline104">104</a></span><span class="line"><span class="comment">%  4.05 azi efficiency is smoothy |06-02-2017 by Liu</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,105" id="srcline105">105</a></span><span class="line"><span class="comment">%  4.06 u is scaled. c_scale * Tmax^2 == 1 |13-03-2017 by Liu</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,106" id="srcline106">106</a></span><span class="line">coder.inline(<span class="string">'never'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,107" id="srcline107">107</a></span><span class="line"><span class="mxinfo " id="T10:U12"><span class="var type1" id="S13T10U24">rudder_table</span> = <span class="mxinfo " id="T10:U14"><span class="var type1" id="S9T9U26">rudder_table0</span>'</span></span>;<span class="comment">%!!!!!!!!!!!!!!!</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,108" id="srcline108">108</a></span><span class="line"><span class="comment">% no_azi_angle_constr = 1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,109" id="srcline109">109</a></span><span class="line"><span class="comment">%% rudder table processing</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,110" id="srcline110">110</a></span><span class="line"><span class="keyword">persistent</span> <span class="var type1" id="S14T11U28">Rangle_T</span> <span class="var type1" id="S15T11U29">Rangle_Fangle</span> <span class="var type1" id="S16T11U30">Fangle_Rangle</span> <span class="var type1" id="S17T7U31">rudder_dat_init</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,111" id="srcline111">111</a></span><span class="line"><span class="keyword">persistent</span> <span class="var type1" id="S18T12U33">on_border</span> <span class="var type1" id="S19T12U34">phi_guider_old</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,112" id="srcline112">112</a></span><span class="line"><span class="comment">% persistent iA;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,113" id="srcline113">113</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T7:U22">isempty(<span class="var type0" id="S17T0U39">rudder_dat_init</span>)</span><span class="comment">%assume this is only one type of rudder</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,114" id="srcline114">114</a></span><span class="line">    <span class="mxinfo " id="T7:U23"><span class="var type1" id="S17T7U42">rudder_dat_init</span> = <span class="mxinfo " id="T7:U25">false</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,115" id="srcline115">115</a></span><span class="line">    <span class="mxinfo " id="T3:U26"><span class="var type1" id="S22T3U47">N_poly</span> = <span class="mxinfo " id="T3:U28">2</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,116" id="srcline116">116</a></span><span class="line">    [<span class="var type1" id="S14T11U52">Rangle_T</span>, <span class="mxinfo " id="T13:U30">~</span>] = polyfit(<span class="mxinfo " id="T15:U31"><span class="var type1" id="S13T10U57">rudder_table</span>(<span class="mxinfo " id="T16:U33">:</span>,<span class="mxinfo " id="T17:U34">1</span>)</span>, <span class="mxinfo " id="T15:U35"><span class="var type1" id="S13T10U61">rudder_table</span>(<span class="mxinfo " id="T16:U37">:</span>,<span class="mxinfo " id="T17:U38">5</span>)</span>,<span class="var type1" id="S22T3U64">N_poly</span>);<span class="comment">%rudder angle vs T</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,117" id="srcline117">117</a></span><span class="line">    [<span class="var type1" id="S15T11U68">Rangle_Fangle</span>, <span class="mxinfo " id="T13:U41">~</span>] = polyfit(<span class="mxinfo " id="T15:U42"><span class="var type1" id="S13T10U73">rudder_table</span>(<span class="mxinfo " id="T16:U44">:</span>,<span class="mxinfo " id="T17:U45">1</span>)</span>, <span class="mxinfo " id="T15:U46"><span class="var type1" id="S13T10U77">rudder_table</span>(<span class="mxinfo " id="T16:U48">:</span>,<span class="mxinfo " id="T17:U49">4</span>)</span>,<span class="var type1" id="S22T3U80">N_poly</span>);<span class="comment">%rudder angle vs F angle</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,118" id="srcline118">118</a></span><span class="line">    [<span class="var type1" id="S16T11U84">Fangle_Rangle</span>, <span class="mxinfo " id="T13:U52">~</span>] = polyfit(<span class="mxinfo " id="T15:U53"><span class="var type1" id="S13T10U89">rudder_table</span>(<span class="mxinfo " id="T16:U55">:</span>,<span class="mxinfo " id="T17:U56">4</span>)</span>, <span class="mxinfo " id="T15:U57"><span class="var type1" id="S13T10U93">rudder_table</span>(<span class="mxinfo " id="T16:U59">:</span>,<span class="mxinfo " id="T17:U60">1</span>)</span>,<span class="var type1" id="S22T3U96">N_poly</span>);<span class="comment">%F angle vs rudder angle</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,119" id="srcline119">119</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,120" id="srcline120">120</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,121" id="srcline121">121</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T7:U62">isempty(<span class="var type0" id="S18T0U101">on_border</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,122" id="srcline122">122</a></span><span class="line">    <span class="mxinfo " id="T12:U63"><span class="var type1" id="S18T12U104">on_border</span> = <span class="mxinfo " id="T12:U65">zeros(<span class="mxinfo " id="T3:U66">8</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,123" id="srcline123">123</a></span><span class="line">    <span class="mxinfo " id="T12:U67"><span class="var type1" id="S19T12U111">phi_guider_old</span> = <span class="mxinfo " id="T12:U69">zeros(<span class="mxinfo " id="T3:U70">8</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,124" id="srcline124">124</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,125" id="srcline125">125</a></span><span class="line"><span class="mxinfo " id="T3:U71"><span class="var type1" id="S25T3U118">max_semi_angle</span> = <span class="mxinfo " id="T3:U73"><span class="mxinfo " id="T3:U74"><span class="mxinfo " id="T3:U75">15</span>/<span class="mxinfo " id="T3:U76">180</span></span>*<span class="mxinfo " id="T3:U77">pi</span></span></span>;<span class="comment">%max half range of phi;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,126" id="srcline126">126</a></span><span class="line"><span class="mxinfo " id="T3:U78"><span class="var type1" id="S27T3U127">NA_fpp</span> = <span class="mxinfo " id="T3:U80"><span class="mxinfo " id="T18:U81">size(<span class="var type1" id="S13T10U131">rudder_table</span>,1)</span> * 2</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,127" id="srcline127">127</a></span><span class="line"><span class="comment">% coder.varsize('alloc_out');%!!!!!!!!!very important???</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,128" id="srcline128">128</a></span><span class="line"><span class="mxinfo " id="T2:U83"><span class="var type1" id="S3T2U136">alloc_out</span> = <span class="mxinfo " id="T2:U85">struct (<span class="string">'label'</span>,<span class="mxinfo " id="T19:U86">{0,0,0,0,0,0,0,0}</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,129" id="srcline129">129</a></span><span class="line">    <span class="string">'enable'</span>,<span class="mxinfo " id="T3:U87">0</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,130" id="srcline130">130</a></span><span class="line">    <span class="string">'TSP'</span>,<span class="mxinfo " id="T3:U88">0</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,131" id="srcline131">131</a></span><span class="line">    <span class="string">'ASP'</span>,<span class="mxinfo " id="T3:U89">0</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,132" id="srcline132">132</a></span><span class="line">    <span class="string">'Tx'</span>,<span class="mxinfo " id="T3:U90">0</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,133" id="srcline133">133</a></span><span class="line">    <span class="string">'Ty'</span>,<span class="mxinfo " id="T3:U91">0</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,134" id="srcline134">134</a></span><span class="line">    <span class="string">'T'</span>,<span class="mxinfo " id="T3:U92">0</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,135" id="srcline135">135</a></span><span class="line">    <span class="string">'phi'</span>,<span class="mxinfo " id="T3:U93">0</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,136" id="srcline136">136</a></span><span class="line">    <span class="string">'Tm'</span>,<span class="mxinfo " id="T3:U94">0</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,137" id="srcline137">137</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,138" id="srcline138">138</a></span><span class="line"><span class="mxinfo " id="T20:U95"><span class="var type1" id="S30T20U168">Ce0</span>=<span class="mxinfo " id="T20:U97">[0,0.800000000000000;0.174532925199433,0.820000000000000;0.349065850398866,0.840000000000000;0.523598775598299,0.870000000000000;0.698131700797732,0.900000000000000;0.872664625997165,0.910000000000000;1.04719755119660,0.930000000000000;1.22173047639603,0.960000000000000;1.39626340159546,0.750000000000000;1.57079632679490,0.500000000000000;1.74532925199433,0.750000000000000;1.91986217719376,1;2.09439510239320,1;2.26892802759263,1;2.44346095279206,1;2.61799387799149,1;2.79252680319093,1;2.96705972839036,1;3.14159265358979,1;3.31612557878923,1;3.49065850398866,1;3.66519142918809,1;3.83972435438753,1;4.01425727958696,1;4.18879020478639,1;4.36332312998582,1;4.53785605518526,1;4.71238898038469,1;4.88692190558412,0.980000000000000;5.06145483078356,0.960000000000000;5.23598775598299,0.930000000000000;5.41052068118242,0.910000000000000;5.58505360638185,0.890000000000000;5.75958653158129,0.870000000000000;5.93411945678072,0.840000000000000;6.10865238198015,0.820000000000000;0,0.800000000000000]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,139" id="srcline139">139</a></span><span class="line"><span class="mxinfo " id="T20:U98"><span class="var type1" id="S31T20U283">Ce3</span>=<span class="mxinfo " id="T20:U100">ones(<span class="mxinfo " id="T18:U101">size(<span class="var type1" id="S30T20U288">Ce0</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,140" id="srcline140">140</a></span><span class="line"><span class="mxinfo " id="T21:U103"><span class="mxinfo " id="T21:U104"><span class="var type1" id="S31T20U292">Ce3</span>(<span class="mxinfo " id="T22:U106">:</span>,<span class="mxinfo " id="T17:U107">1</span>)</span>=<span class="mxinfo " id="T21:U108"><span class="var type1" id="S30T20U296">Ce0</span>(:,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,141" id="srcline141">141</a></span><span class="line"><span class="mxinfo " id="T20:U110"><span class="var type1" id="S33T20U301">Ce2</span> = <span class="mxinfo " id="T20:U112">[<span class="mxinfo " id="T5:U113"><span class="mxinfo " id="T3:U114">0</span>,<span class="mxinfo " id="T3:U115">1</span></span>;<span class="mxinfo " id="T5:U116"><span class="mxinfo " id="T3:U117">0.174532925199433</span>,<span class="mxinfo " id="T3:U118">1</span></span>;<span class="mxinfo " id="T5:U119"><span class="mxinfo " id="T3:U120">0.349065850398866</span>,<span class="mxinfo " id="T3:U121">1</span></span>;<span class="mxinfo " id="T5:U122"><span class="mxinfo " id="T3:U123">0.523598775598299</span>,<span class="mxinfo " id="T3:U124">1</span></span>;<span class="mxinfo " id="T5:U125"><span class="mxinfo " id="T3:U126">0.698131700797732</span>,<span class="mxinfo " id="T3:U127">1</span></span>;<span class="mxinfo " id="T5:U128"><span class="mxinfo " id="T3:U129">0.872664625997165</span>,<span class="mxinfo " id="T3:U130">1</span></span>;<span class="mxinfo " id="T5:U131"><span class="mxinfo " id="T3:U132">1.04719755119660</span>,<span class="mxinfo " id="T3:U133">1</span></span>;<span class="mxinfo " id="T5:U134"><span class="mxinfo " id="T3:U135">1.22173047639603</span>,<span class="mxinfo " id="T3:U136">1</span></span>;<span class="mxinfo " id="T5:U137"><span class="mxinfo " id="T3:U138">1.39626340159546</span>,<span class="mxinfo " id="T3:U139">1</span></span>;<span class="mxinfo " id="T5:U140"><span class="mxinfo " id="T3:U141">1.57079632679490</span>,<span class="mxinfo " id="T3:U142">1</span></span>;<span class="mxinfo " id="T5:U143"><span class="mxinfo " id="T3:U144">1.74532925199433</span>,<span class="mxinfo " id="T3:U145">0.980000000000000</span></span>;<span class="mxinfo " id="T5:U146"><span class="mxinfo " id="T3:U147">1.91986217719376</span>,<span class="mxinfo " id="T3:U148">0.960000000000000</span></span>;<span class="mxinfo " id="T5:U149"><span class="mxinfo " id="T3:U150">2.09439510239320</span>,<span class="mxinfo " id="T3:U151">0.930000000000000</span></span>;<span class="mxinfo " id="T5:U152"><span class="mxinfo " id="T3:U153">2.26892802759263</span>,<span class="mxinfo " id="T3:U154">0.910000000000000</span></span>;<span class="mxinfo " id="T5:U155"><span class="mxinfo " id="T3:U156">2.44346095279206</span>,<span class="mxinfo " id="T3:U157">0.890000000000000</span></span>;<span class="mxinfo " id="T5:U158"><span class="mxinfo " id="T3:U159">2.61799387799149</span>,<span class="mxinfo " id="T3:U160">0.870000000000000</span></span>;<span class="mxinfo " id="T5:U161"><span class="mxinfo " id="T3:U162">2.79252680319093</span>,<span class="mxinfo " id="T3:U163">0.840000000000000</span></span>;<span class="mxinfo " id="T5:U164"><span class="mxinfo " id="T3:U165">2.96705972839036</span>,<span class="mxinfo " id="T3:U166">0.820000000000000</span></span>;<span class="mxinfo " id="T5:U167"><span class="mxinfo " id="T3:U168">3.14159265358979</span>,<span class="mxinfo " id="T3:U169">0.800000000000000</span></span>;<span class="mxinfo " id="T5:U170"><span class="mxinfo " id="T3:U171">3.31612557878923</span>,<span class="mxinfo " id="T3:U172">0.820000000000000</span></span>;<span class="mxinfo " id="T5:U173"><span class="mxinfo " id="T3:U174">3.49065850398866</span>,<span class="mxinfo " id="T3:U175">0.840000000000000</span></span>;<span class="mxinfo " id="T5:U176"><span class="mxinfo " id="T3:U177">3.66519142918809</span>,<span class="mxinfo " id="T3:U178">0.870000000000000</span></span>;<span class="mxinfo " id="T5:U179"><span class="mxinfo " id="T3:U180">3.83972435438753</span>,<span class="mxinfo " id="T3:U181">0.900000000000000</span></span>;<span class="mxinfo " id="T5:U182"><span class="mxinfo " id="T3:U183">4.01425727958696</span>,<span class="mxinfo " id="T3:U184">0.910000000000000</span></span>;<span class="mxinfo " id="T5:U185"><span class="mxinfo " id="T3:U186">4.18879020478639</span>,<span class="mxinfo " id="T3:U187">0.930000000000000</span></span>;<span class="mxinfo " id="T5:U188"><span class="mxinfo " id="T3:U189">4.36332312998582</span>,<span class="mxinfo " id="T3:U190">0.960000000000000</span></span>;<span class="mxinfo " id="T5:U191"><span class="mxinfo " id="T3:U192">4.53785605518526</span>,<span class="mxinfo " id="T3:U193">0.750000000000000</span></span>;<span class="mxinfo " id="T5:U194"><span class="mxinfo " id="T3:U195">4.71238898038469</span>,<span class="mxinfo " id="T3:U196">0.500000000000000</span></span>;<span class="mxinfo " id="T5:U197"><span class="mxinfo " id="T3:U198">4.88692190558412</span>,<span class="mxinfo " id="T3:U199">0.750000000000000</span></span>;<span class="mxinfo " id="T5:U200"><span class="mxinfo " id="T3:U201">5.06145483078356</span>,<span class="mxinfo " id="T3:U202">1</span></span>;<span class="mxinfo " id="T5:U203"><span class="mxinfo " id="T3:U204">5.23598775598299</span>,<span class="mxinfo " id="T3:U205">1</span></span>;<span class="mxinfo " id="T5:U206"><span class="mxinfo " id="T3:U207">5.41052068118242</span>,<span class="mxinfo " id="T3:U208">1</span></span>;<span class="mxinfo " id="T5:U209"><span class="mxinfo " id="T3:U210">5.58505360638185</span>,<span class="mxinfo " id="T3:U211">1</span></span>;<span class="mxinfo " id="T5:U212"><span class="mxinfo " id="T3:U213">5.75958653158129</span>,<span class="mxinfo " id="T3:U214">1</span></span>;<span class="mxinfo " id="T5:U215"><span class="mxinfo " id="T3:U216">5.93411945678072</span>,<span class="mxinfo " id="T3:U217">1</span></span>;<span class="mxinfo " id="T5:U218"><span class="mxinfo " id="T3:U219">6.10865238198015</span>,<span class="mxinfo " id="T3:U220">1</span></span>;<span class="mxinfo " id="T5:U221"><span class="mxinfo " id="T3:U222">0</span>,<span class="mxinfo " id="T3:U223">1</span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,142" id="srcline142">142</a></span><span class="line"><span class="mxinfo " id="T20:U224"><span class="var type1" id="S34T20U416">Ce1</span> = <span class="mxinfo " id="T20:U226">[<span class="mxinfo " id="T5:U227"><span class="mxinfo " id="T3:U228">0</span>,<span class="mxinfo " id="T3:U229">1</span></span>;<span class="mxinfo " id="T5:U230"><span class="mxinfo " id="T3:U231">0.174532925199436</span>,<span class="mxinfo " id="T3:U232">1</span></span>;<span class="mxinfo " id="T5:U233"><span class="mxinfo " id="T3:U234">0.349065850398866</span>,<span class="mxinfo " id="T3:U235">1</span></span>;<span class="mxinfo " id="T5:U236"><span class="mxinfo " id="T3:U237">0.523598775598297</span>,<span class="mxinfo " id="T3:U238">1</span></span>;<span class="mxinfo " id="T5:U239"><span class="mxinfo " id="T3:U240">0.698131700797736</span>,<span class="mxinfo " id="T3:U241">1</span></span>;<span class="mxinfo " id="T5:U242"><span class="mxinfo " id="T3:U243">0.872664625997166</span>,<span class="mxinfo " id="T3:U244">1</span></span>;<span class="mxinfo " id="T5:U245"><span class="mxinfo " id="T3:U246">1.04719755119660</span>,<span class="mxinfo " id="T3:U247">1</span></span>;<span class="mxinfo " id="T5:U248"><span class="mxinfo " id="T3:U249">1.22173047639603</span>,<span class="mxinfo " id="T3:U250">1</span></span>;<span class="mxinfo " id="T5:U251"><span class="mxinfo " id="T3:U252">1.39626340159547</span>,<span class="mxinfo " id="T3:U253">0.750000000000000</span></span>;<span class="mxinfo " id="T5:U254"><span class="mxinfo " id="T3:U255">1.57079632679490</span>,<span class="mxinfo " id="T3:U256">0.500000000000000</span></span>;<span class="mxinfo " id="T5:U257"><span class="mxinfo " id="T3:U258">1.74532925199433</span>,<span class="mxinfo " id="T3:U259">0.750000000000000</span></span>;<span class="mxinfo " id="T5:U260"><span class="mxinfo " id="T3:U261">1.91986217719377</span>,<span class="mxinfo " id="T3:U262">0.960000000000000</span></span>;<span class="mxinfo " id="T5:U263"><span class="mxinfo " id="T3:U264">2.09439510239320</span>,<span class="mxinfo " id="T3:U265">0.930000000000000</span></span>;<span class="mxinfo " id="T5:U266"><span class="mxinfo " id="T3:U267">2.26892802759263</span>,<span class="mxinfo " id="T3:U268">0.910000000000000</span></span>;<span class="mxinfo " id="T5:U269"><span class="mxinfo " id="T3:U270">2.44346095279206</span>,<span class="mxinfo " id="T3:U271">0.900000000000000</span></span>;<span class="mxinfo " id="T5:U272"><span class="mxinfo " id="T3:U273">2.61799387799150</span>,<span class="mxinfo " id="T3:U274">0.870000000000000</span></span>;<span class="mxinfo " id="T5:U275"><span class="mxinfo " id="T3:U276">2.79252680319093</span>,<span class="mxinfo " id="T3:U277">0.840000000000000</span></span>;<span class="mxinfo " id="T5:U278"><span class="mxinfo " id="T3:U279">2.96705972839036</span>,<span class="mxinfo " id="T3:U280">0.820000000000000</span></span>;<span class="mxinfo " id="T5:U281"><span class="mxinfo " id="T3:U282">3.14159265358980</span>,<span class="mxinfo " id="T3:U283">0.800000000000000</span></span>;<span class="mxinfo " id="T5:U284"><span class="mxinfo " id="T3:U285">3.31612557878923</span>,<span class="mxinfo " id="T3:U286">0.820000000000000</span></span>;<span class="mxinfo " id="T5:U287"><span class="mxinfo " id="T3:U288">3.49065850398866</span>,<span class="mxinfo " id="T3:U289">0.840000000000000</span></span>;<span class="mxinfo " id="T5:U290"><span class="mxinfo " id="T3:U291">3.66519142918810</span>,<span class="mxinfo " id="T3:U292">0.870000000000000</span></span>;<span class="mxinfo " id="T5:U293"><span class="mxinfo " id="T3:U294">3.83972435438753</span>,<span class="mxinfo " id="T3:U295">0.890000000000000</span></span>;<span class="mxinfo " id="T5:U296"><span class="mxinfo " id="T3:U297">4.01425727958696</span>,<span class="mxinfo " id="T3:U298">0.910000000000000</span></span>;<span class="mxinfo " id="T5:U299"><span class="mxinfo " id="T3:U300">4.18879020478639</span>,<span class="mxinfo " id="T3:U301">0.930000000000000</span></span>;<span class="mxinfo " id="T5:U302"><span class="mxinfo " id="T3:U303">4.36332312998583</span>,<span class="mxinfo " id="T3:U304">0.960000000000000</span></span>;<span class="mxinfo " id="T5:U305"><span class="mxinfo " id="T3:U306">4.53785605518526</span>,<span class="mxinfo " id="T3:U307">0.980000000000000</span></span>;<span class="mxinfo " id="T5:U308"><span class="mxinfo " id="T3:U309">4.71238898038469</span>,<span class="mxinfo " id="T3:U310">1</span></span>;<span class="mxinfo " id="T5:U311"><span class="mxinfo " id="T3:U312">4.88692190558413</span>,<span class="mxinfo " id="T3:U313">1</span></span>;<span class="mxinfo " id="T5:U314"><span class="mxinfo " id="T3:U315">5.06145483078356</span>,<span class="mxinfo " id="T3:U316">1</span></span>;<span class="mxinfo " id="T5:U317"><span class="mxinfo " id="T3:U318">5.23598775598299</span>,<span class="mxinfo " id="T3:U319">1</span></span>;<span class="mxinfo " id="T5:U320"><span class="mxinfo " id="T3:U321">5.41052068118242</span>,<span class="mxinfo " id="T3:U322">1</span></span>;<span class="mxinfo " id="T5:U323"><span class="mxinfo " id="T3:U324">5.58505360638185</span>,<span class="mxinfo " id="T3:U325">1</span></span>;<span class="mxinfo " id="T5:U326"><span class="mxinfo " id="T3:U327">5.75958653158129</span>,<span class="mxinfo " id="T3:U328">1</span></span>;<span class="mxinfo " id="T5:U329"><span class="mxinfo " id="T3:U330">5.93411945678072</span>,<span class="mxinfo " id="T3:U331">1</span></span>;<span class="mxinfo " id="T5:U332"><span class="mxinfo " id="T3:U333">6.10865238198015</span>,<span class="mxinfo " id="T3:U334">1</span></span>;<span class="mxinfo " id="T5:U335"><span class="mxinfo " id="T3:U336">0</span>,<span class="mxinfo " id="T3:U337">1</span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,143" id="srcline143">143</a></span><span class="line"><span class="mxinfo " id="T20:U338"><span class="var type1" id="S34T20U531">Ce1</span> = <span class="mxinfo " id="T20:U340">[<span class="mxinfo " id="T5:U341"><span class="mxinfo " id="T3:U342">0</span>,<span class="mxinfo " id="T3:U343">0.800000000000000</span></span>;<span class="mxinfo " id="T5:U344"><span class="mxinfo " id="T3:U345">0.174532925199433</span>,<span class="mxinfo " id="T3:U346">0.820000000000000</span></span>;<span class="mxinfo " id="T5:U347"><span class="mxinfo " id="T3:U348">0.349065850398866</span>,<span class="mxinfo " id="T3:U349">0.840000000000000</span></span>;<span class="mxinfo " id="T5:U350"><span class="mxinfo " id="T3:U351">0.523598775598299</span>,<span class="mxinfo " id="T3:U352">0.870000000000000</span></span>;<span class="mxinfo " id="T5:U353"><span class="mxinfo " id="T3:U354">0.698131700797732</span>,<span class="mxinfo " id="T3:U355">0.900000000000000</span></span>;<span class="mxinfo " id="T5:U356"><span class="mxinfo " id="T3:U357">0.872664625997165</span>,<span class="mxinfo " id="T3:U358">0.910000000000000</span></span>;<span class="mxinfo " id="T5:U359"><span class="mxinfo " id="T3:U360">1.04719755119660</span>,<span class="mxinfo " id="T3:U361">0.930000000000000</span></span>;<span class="mxinfo " id="T5:U362"><span class="mxinfo " id="T3:U363">1.22173047639603</span>,<span class="mxinfo " id="T3:U364">0.960000000000000</span></span>;<span class="mxinfo " id="T5:U365"><span class="mxinfo " id="T3:U366">1.39626340159546</span>,<span class="mxinfo " id="T3:U367">0.750000000000000</span></span>;<span class="mxinfo " id="T5:U368"><span class="mxinfo " id="T3:U369">1.57079632679490</span>,<span class="mxinfo " id="T3:U370">0.500000000000000</span></span>;<span class="mxinfo " id="T5:U371"><span class="mxinfo " id="T3:U372">1.74532925199433</span>,<span class="mxinfo " id="T3:U373">0.750000000000000</span></span>;<span class="mxinfo " id="T5:U374"><span class="mxinfo " id="T3:U375">1.91986217719376</span>,<span class="mxinfo " id="T3:U376">1</span></span>;<span class="mxinfo " id="T5:U377"><span class="mxinfo " id="T3:U378">2.09439510239320</span>,<span class="mxinfo " id="T3:U379">1</span></span>;<span class="mxinfo " id="T5:U380"><span class="mxinfo " id="T3:U381">2.26892802759263</span>,<span class="mxinfo " id="T3:U382">1</span></span>;<span class="mxinfo " id="T5:U383"><span class="mxinfo " id="T3:U384">2.44346095279206</span>,<span class="mxinfo " id="T3:U385">1</span></span>;<span class="mxinfo " id="T5:U386"><span class="mxinfo " id="T3:U387">2.61799387799149</span>,<span class="mxinfo " id="T3:U388">1</span></span>;<span class="mxinfo " id="T5:U389"><span class="mxinfo " id="T3:U390">2.79252680319093</span>,<span class="mxinfo " id="T3:U391">1</span></span>;<span class="mxinfo " id="T5:U392"><span class="mxinfo " id="T3:U393">2.96705972839036</span>,<span class="mxinfo " id="T3:U394">1</span></span>;<span class="mxinfo " id="T5:U395"><span class="mxinfo " id="T3:U396">3.14159265358979</span>,<span class="mxinfo " id="T3:U397">1</span></span>;<span class="mxinfo " id="T5:U398"><span class="mxinfo " id="T3:U399">3.31612557878923</span>,<span class="mxinfo " id="T3:U400">1</span></span>;<span class="mxinfo " id="T5:U401"><span class="mxinfo " id="T3:U402">3.49065850398866</span>,<span class="mxinfo " id="T3:U403">1</span></span>;<span class="mxinfo " id="T5:U404"><span class="mxinfo " id="T3:U405">3.66519142918809</span>,<span class="mxinfo " id="T3:U406">1</span></span>;<span class="mxinfo " id="T5:U407"><span class="mxinfo " id="T3:U408">3.83972435438753</span>,<span class="mxinfo " id="T3:U409">1</span></span>;<span class="mxinfo " id="T5:U410"><span class="mxinfo " id="T3:U411">4.01425727958696</span>,<span class="mxinfo " id="T3:U412">1</span></span>;<span class="mxinfo " id="T5:U413"><span class="mxinfo " id="T3:U414">4.18879020478639</span>,<span class="mxinfo " id="T3:U415">1</span></span>;<span class="mxinfo " id="T5:U416"><span class="mxinfo " id="T3:U417">4.36332312998582</span>,<span class="mxinfo " id="T3:U418">1</span></span>;<span class="mxinfo " id="T5:U419"><span class="mxinfo " id="T3:U420">4.53785605518526</span>,<span class="mxinfo " id="T3:U421">1</span></span>;<span class="mxinfo " id="T5:U422"><span class="mxinfo " id="T3:U423">4.71238898038469</span>,<span class="mxinfo " id="T3:U424">1</span></span>;<span class="mxinfo " id="T5:U425"><span class="mxinfo " id="T3:U426">4.88692190558412</span>,<span class="mxinfo " id="T3:U427">0.980000000000000</span></span>;<span class="mxinfo " id="T5:U428"><span class="mxinfo " id="T3:U429">5.06145483078356</span>,<span class="mxinfo " id="T3:U430">0.960000000000000</span></span>;<span class="mxinfo " id="T5:U431"><span class="mxinfo " id="T3:U432">5.23598775598299</span>,<span class="mxinfo " id="T3:U433">0.930000000000000</span></span>;<span class="mxinfo " id="T5:U434"><span class="mxinfo " id="T3:U435">5.41052068118242</span>,<span class="mxinfo " id="T3:U436">0.910000000000000</span></span>;<span class="mxinfo " id="T5:U437"><span class="mxinfo " id="T3:U438">5.58505360638185</span>,<span class="mxinfo " id="T3:U439">0.890000000000000</span></span>;<span class="mxinfo " id="T5:U440"><span class="mxinfo " id="T3:U441">5.75958653158129</span>,<span class="mxinfo " id="T3:U442">0.870000000000000</span></span>;<span class="mxinfo " id="T5:U443"><span class="mxinfo " id="T3:U444">5.93411945678072</span>,<span class="mxinfo " id="T3:U445">0.840000000000000</span></span>;<span class="mxinfo " id="T5:U446"><span class="mxinfo " id="T3:U447">6.10865238198015</span>,<span class="mxinfo " id="T3:U448">0.820000000000000</span></span>;<span class="mxinfo " id="T5:U449"><span class="mxinfo " id="T3:U450">0</span>,<span class="mxinfo " id="T3:U451">0.800000000000000</span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,144" id="srcline144">144</a></span><span class="line"><span class="comment">% Ce2 = Ce1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,145" id="srcline145">145</a></span><span class="line"><span class="comment">% Ce3 = Ce1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,146" id="srcline146">146</a></span><span class="line"><span class="mxinfo " id="T20:U452"><span class="var type1" id="S34T20U646">Ce1</span> = <span class="var type1" id="S31T20U647">Ce3</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,147" id="srcline147">147</a></span><span class="line"><span class="mxinfo " id="T20:U455"><span class="var type1" id="S33T20U650">Ce2</span> = <span class="var type1" id="S31T20U651">Ce3</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,148" id="srcline148">148</a></span><span class="line"><span class="mxinfo " id="T23:U458"><span class="var type1" id="S35T23U654">Ce</span> = <span class="mxinfo " id="T23:U460">struct(<span class="string">'label'</span>,<span class="mxinfo " id="T24:U461">{1,2,3,4,5,6,7,8}</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,149" id="srcline149">149</a></span><span class="line">    <span class="string">'reserve'</span>,<span class="mxinfo " id="T3:U462">0</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,150" id="srcline150">150</a></span><span class="line">    <span class="string">'value'</span>,<span class="mxinfo " id="T25:U463">{<span class="var type1" id="S34T20U673">Ce1</span>,<span class="var type1" id="S33T20U674">Ce2</span>,<span class="var type1" id="S31T20U675">Ce3</span>,<span class="var type1" id="S31T20U676">Ce3</span>,<span class="var type1" id="S31T20U677">Ce3</span>,<span class="var type1" id="S31T20U678">Ce3</span>,<span class="var type1" id="S31T20U679">Ce3</span>,<span class="var type1" id="S31T20U680">Ce3</span>}</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,151" id="srcline151">151</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,152" id="srcline152">152</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,153" id="srcline153">153</a></span><span class="line"><span class="mxinfo " id="T3:U472"><span class="var type1" id="S36T3U683">dt</span> = <span class="mxinfo " id="T3:U474"><span class="mxinfo " id="T26:U475"><span class="var type1" id="S4T4U686">thruster_data</span>(<span class="mxinfo " id="T3:U477">1</span>)</span>.dt</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,154" id="srcline154">154</a></span><span class="line"><span class="mxinfo " id="T1:U478"><span class="var type1" id="S2T1U691">solution</span> = <span class="mxinfo " id="T1:U480">zeros(<span class="mxinfo " id="T3:U481"><span class="mxinfo " id="T3:U482"><span class="var type1" id="S8T3U696">N_enabled_thruster</span> * <span class="mxinfo " id="T3:U484">2</span></span> + <span class="mxinfo " id="T3:U485">3</span></span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,155" id="srcline155">155</a></span><span class="line"><span class="mxinfo " id="T12:U486"><span class="var type1" id="S37T12U702">phi_0</span> = <span class="mxinfo " id="T12:U488">zeros(<span class="mxinfo " id="T3:U489">8</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,156" id="srcline156">156</a></span><span class="line"><span class="comment">% phi_reserve = zeros(8,1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,157" id="srcline157">157</a></span><span class="line"><span class="comment">% T_reserve = zeros(8,1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,158" id="srcline158">158</a></span><span class="line"><span class="mxinfo " id="T12:U490"><span class="var type1" id="S38T12U709">phiPlus0</span> = <span class="mxinfo " id="T12:U492">zeros(<span class="mxinfo " id="T3:U493">8</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,159" id="srcline159">159</a></span><span class="line"><span class="mxinfo " id="T12:U494"><span class="var type1" id="S39T12U716">inside_fz</span> = <span class="mxinfo " id="T12:U496">zeros(<span class="mxinfo " id="T3:U497">8</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,160" id="srcline160">160</a></span><span class="line"><span class="mxinfo " id="T12:U498"><span class="var type1" id="S40T12U723">alloc_out_T</span> = <span class="mxinfo " id="T12:U500">zeros(<span class="mxinfo " id="T3:U501">8</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,161" id="srcline161">161</a></span><span class="line"><span class="mxinfo " id="T12:U502"><span class="var type1" id="S41T12U730">alloc_out_phi</span> = <span class="mxinfo " id="T12:U504">zeros(<span class="mxinfo " id="T3:U505">8</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,162" id="srcline162">162</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,163" id="srcline163">163</a></span><span class="line"><span class="mxinfo " id="T3:U506"><span class="var type1" id="S42T3U737">tol</span> = <span class="mxinfo " id="T3:U508">1e-6</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,164" id="srcline164">164</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,165" id="srcline165">165</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,166" id="srcline166">166</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,167" id="srcline167">167</a></span><span class="line"><span class="mxinfo " id="T3:U509"><span class="var type1" id="S43T3U741">diff_phi</span> = <span class="mxinfo " id="T3:U511">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,168" id="srcline168">168</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S44T3U745">step</span> = <span class="mxinfo " id="T27:U513"><span class="mxinfo " id="T3:U514">1</span>:<span class="mxinfo " id="T3:U515">2</span></span> <span class="comment">%step 1: global solution, step 2: local solution</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,169" id="srcline169">169</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,170" id="srcline170">170</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S45T3U751">i</span> = <span class="mxinfo " id="T1:U517"><span class="mxinfo " id="T3:U518">1</span>:<span class="var type1" id="S8T3U754">N_enabled_thruster</span></span> <span class="comment">%added v1.09</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,171" id="srcline171">171</a></span><span class="line">        <span class="comment">% 0 no angle constraint no thrust constraint</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,172" id="srcline172">172</a></span><span class="line">        <span class="comment">% 2 only angle constraint</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,173" id="srcline173">173</a></span><span class="line">        <span class="comment">% 1 only thrust constraint</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,174" id="srcline174">174</a></span><span class="line">        <span class="comment">% 3 means angle must be fixed because solution is inside fb zone</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,175" id="srcline175">175</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo " id="T7:U520"><span class="var type1" id="S44T3U758">step</span> == <span class="mxinfo " id="T3:U522">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,176" id="srcline176">176</a></span><span class="line">            <span class="mxinfo " id="T3:U523"><span class="mxinfo " id="T3:U524"><span class="mxinfo " id="T26:U525"><span class="var type1" id="S4T4U764">thruster_data</span>(<span class="var type1" id="S45T3U765">i</span>)</span>.constr</span> = <span class="mxinfo " id="T3:U528">0</span></span>;<span class="comment">%no constraint at all</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,177" id="srcline177">177</a></span><span class="line">        <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,178" id="srcline178">178</a></span><span class="line">            <span class="mxinfo " id="T3:U529"><span class="mxinfo " id="T3:U530"><span class="mxinfo " id="T26:U531"><span class="var type1" id="S4T4U773">thruster_data</span>(<span class="var type1" id="S45T3U774">i</span>)</span>.constr</span> = <span class="mxinfo " id="T3:U534">2</span></span>;<span class="comment">%no constraint at all</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,179" id="srcline179">179</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,180" id="srcline180">180</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,181" id="srcline181">181</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,182" id="srcline182">182</a></span><span class="line">    <span class="mxinfo " id="T3:U535"><span class="var type1" id="S5T3U779">status</span> = <span class="mxinfo " id="T3:U537">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,183" id="srcline183">183</a></span><span class="line">    <span class="mxinfo " id="T3:U538"><span class="var type1" id="S46T3U783">counter</span> = <span class="mxinfo " id="T3:U540">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,184" id="srcline184">184</a></span><span class="line">    <span class="mxinfo " id="T12:U541"><span class="var type1" id="S47T12U787">phi0</span> = <span class="mxinfo " id="T12:U543">zeros(<span class="mxinfo " id="T3:U544">8</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,185" id="srcline185">185</a></span><span class="line">    <span class="mxinfo " id="T7:U545"><span class="var type1" id="S48T7U794">run</span> = <span class="mxinfo " id="T7:U547">true</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,186" id="srcline186">186</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,187" id="srcline187">187</a></span><span class="line">    <span class="keyword">while</span> <span class="var type1" id="S48T7U798">run</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,188" id="srcline188">188</a></span><span class="line">        <span class="mxinfo " id="T3:U549"><span class="var type1" id="S46T3U801">counter</span> = <span class="mxinfo " id="T3:U551"><span class="var type1" id="S46T3U803">counter</span> + <span class="mxinfo " id="T3:U553">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,189" id="srcline189">189</a></span><span class="line">        <span class="mxinfo " id="T3:U554"><span class="var type1" id="S50T3U807">flag_run</span> = <span class="mxinfo " id="T3:U556">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,190" id="srcline190">190</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,191" id="srcline191">191</a></span><span class="line">        <span class="mxinfo " id="T3:U557"><span class="var type1" id="S51T3U811">count_run</span> = <span class="mxinfo " id="T3:U559">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,192" id="srcline192">192</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,193" id="srcline193">193</a></span><span class="line">        <span class="keyword">while</span> <span class="var type1" id="S50T3U814">flag_run</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,194" id="srcline194">194</a></span><span class="line">            <span class="mxinfo " id="T3:U561"><span class="var type1" id="S50T3U817">flag_run</span> = <span class="mxinfo " id="T3:U563">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,195" id="srcline195">195</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,196" id="srcline196">196</a></span><span class="line">            <span class="mxinfo " id="T3:U564"><span class="var type1" id="S51T3U821">count_run</span> = <span class="mxinfo " id="T3:U566"><span class="var type1" id="S51T3U823">count_run</span> + <span class="mxinfo " id="T3:U568">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,197" id="srcline197">197</a></span><span class="line">            [<span class="var type1" id="S4T4U828">thruster_data</span>,<span class="var type1" id="S52T3U829">Nvar</span>,<span class="var type1" id="S53T28U830">H</span>,<span class="var type1" id="S54T1U831">f</span>,<span class="var type1" id="S55T28U832">A</span>,<span class="var type1" id="S56T1U833">b</span>,<span class="var type1" id="S57T28U834">Aeq</span>,<span class="var type1" id="S58T1U835">beq</span>,<span class="var type1" id="S59T1U836">x0</span>] = <span class="fcn" id="F260N14:B838">pre_qp</span>(<span class="var type1" id="S6T7U839">init</span>,<span class="var type1" id="S4T4U840">thruster_data</span>,<span class="var type1" id="S7T8U841">T_r</span>,<span class="var type1" id="S8T3U842">N_enabled_thruster</span>,<span class="var type1" id="S35T23U843">Ce</span>,<span class="var type1" id="S27T3U844">NA_fpp</span>,<span class="var type1" id="S13T10U845">rudder_table</span>,<span class="var type1" id="S14T11U846">Rangle_T</span>,<span class="var type1" id="S15T11U847">Rangle_Fangle</span>,<span class="var type1" id="S10T3U848">no_azi_angle_constr</span>,<span class="var type1" id="S11T3U849">method</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,198" id="srcline198">198</a></span><span class="line">            <span class="mxinfo " id="T7:U589"><span class="var type1" id="S6T7U852">init</span> = <span class="mxinfo " id="T7:U591">false</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,199" id="srcline199">199</a></span><span class="line">            <span class="mxinfo " id="T3:U592"><span class="var type1" id="S61T3U857">MaxIter</span>=<span class="mxinfo " id="T3:U594">100</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,200" id="srcline200">200</a></span><span class="line">            <span class="mxinfo " id="T3:U595"><span class="var type1" id="S62T3U861">FeasibilityTol</span>=<span class="mxinfo " id="T3:U597">1e-8</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,201" id="srcline201">201</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,202" id="srcline202">202</a></span><span class="line">            [<span class="var type1" id="S63T28U866">L</span>,<span class="var type1" id="S64T3U867">p</span>] = <span class="fcn" id="F366N2:B869">Chol_fc</span>(<span class="var type1" id="S53T28U870">H</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,203" id="srcline203">203</a></span><span class="line">            <span class="comment">% before chol</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,204" id="srcline204">204</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo " id="T7:U601"><span class="var type1" id="S64T3U874">p</span>==<span class="mxinfo " id="T3:U603">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,205" id="srcline205">205</a></span><span class="line">                <span class="keyword">switch</span> <span class="var type1" id="S11T3U877">method</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,206" id="srcline206">206</a></span><span class="line">                    <span class="keyword">case</span> <span class="mxinfo " id="T3:U605">1</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,207" id="srcline207">207</a></span><span class="line">                        <span class="mxinfo " id="T28:U606"><span class="var type1" id="S66T28U882">Linv</span> = <span class="mxinfo " id="T28:U608">inv(<span class="var type1" id="S63T28U885">L</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,208" id="srcline208">208</a></span><span class="line">                        <span class="mxinfo " id="T29:U610"><span class="var type1" id="S68T29U888">opt</span> = <span class="mxinfo " id="T29:U612">mpcqpsolverOptions</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,209" id="srcline209">209</a></span><span class="line">                        <span class="mxinfo " id="T3:U613"><span class="mxinfo " id="T3:U614"><span class="var type1" id="S68T29U894">opt</span>.MaxIter</span> = <span class="var type1" id="S61T3U896">MaxIter</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,210" id="srcline210">210</a></span><span class="line">                        <span class="mxinfo " id="T7:U617"><span class="mxinfo " id="T7:U618"><span class="var type1" id="S68T29U900">opt</span>.IntegrityChecks</span> = <span class="mxinfo " id="T7:U620">false</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,211" id="srcline211">211</a></span><span class="line">                        <span class="mxinfo " id="T3:U621"><span class="mxinfo " id="T3:U622"><span class="var type1" id="S68T29U907">opt</span>.FeasibilityTol</span> = <span class="var type1" id="S62T3U909">FeasibilityTol</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,212" id="srcline212">212</a></span><span class="line">                        <span class="mxinfo " id="T31:U625"><span class="var type1" id="S70T31U912">iA0</span> = <span class="mxinfo " id="T31:U627"><span class="mxinfo " id="T7:U628">false</span>(<span class="mxinfo " id="T3:U629">size(<span class="var type1" id="S56T1U917">b</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,213" id="srcline213">213</a></span><span class="line">                        <span class="comment">%                         if isempty(iA)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,214" id="srcline214">214</a></span><span class="line">                        <span class="comment">%                             iA = iA0;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,215" id="srcline215">215</a></span><span class="line">                        <span class="comment">%                         end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,216" id="srcline216">216</a></span><span class="line">                        [<span class="var type1" id="S2T1U921">solution</span>,<span class="var type1" id="S5T3U922">status</span>,<span class="mxinfo " id="T31:U633">~</span>] = <span class="fcn" id="F485N3:B925">Mpcqpsolver</span>(<span class="var type1" id="S66T28U926">Linv</span>,<span class="var type1" id="S54T1U927">f</span>,<span class="var type1" id="S55T28U928">A</span>,<span class="var type1" id="S56T1U929">b</span>,<span class="var type1" id="S57T28U930">Aeq</span>,<span class="var type1" id="S58T1U931">beq</span>,<span class="var type1" id="S70T31U932">iA0</span>,<span class="var type1" id="S68T29U933">opt</span>);<span class="comment">%faster to use iA instead of iA0</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,217" id="srcline217">217</a></span><span class="line">                        <span class="comment">%     [solution1,fval,exitflag] = quadprog(H,f,A,b,Aeq,beq)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,218" id="srcline218">218</a></span><span class="line">                    <span class="keyword">case</span> <span class="mxinfo " id="T3:U642">2</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,219" id="srcline219">219</a></span><span class="line">                        <span class="comment">%     x0=[x0;0;0;0];</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,220" id="srcline220">220</a></span><span class="line">                        <span class="mxinfo " id="T3:U643"><span class="var type1" id="S72T3U938">col_Aeq</span>=<span class="mxinfo " id="T3:U645">size(<span class="var type1" id="S57T28U941">Aeq</span>,2)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,221" id="srcline221">221</a></span><span class="line">                        <span class="comment">%     ????????????????ux,uy,?????????s1?s2?s3???</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,222" id="srcline222">222</a></span><span class="line">                        <span class="mxinfo " id="T32:U647"><span class="mxinfo " id="T32:U648"><span class="var type1" id="S59T1U946">x0</span>(<span class="mxinfo " id="T32:U650"><span class="mxinfo " id="T3:U651"><span class="var type1" id="S72T3U949">col_Aeq</span> - <span class="mxinfo " id="T3:U653">2</span></span> :end</span>)</span> = <span class="mxinfo " id="T1:U654"><span class="mxinfo " id="T33:U655"><span class="var type1" id="S57T28U955">Aeq</span>(<span class="mxinfo " id="T11:U657"><span class="mxinfo " id="T3:U658">1</span>:<span class="mxinfo " id="T3:U659">3</span></span>,<span class="mxinfo " id="T32:U660"><span class="mxinfo " id="T3:U661"><span class="var type1" id="S72T3U961">col_Aeq</span> - <span class="mxinfo " id="T3:U663">2</span></span> :end</span>)</span>\(<span class="mxinfo " id="T6:U664"><span class="mxinfo " id="T6:U665"><span class="var type1" id="S58T1U968">beq</span>(<span class="mxinfo " id="T11:U667"><span class="mxinfo " id="T3:U668">1</span>:<span class="mxinfo " id="T3:U669">3</span></span>)</span> - <span class="mxinfo " id="T6:U670"><span class="mxinfo " id="T33:U671"><span class="var type1" id="S57T28U974">Aeq</span>(<span class="mxinfo " id="T11:U673"><span class="mxinfo " id="T3:U674">1</span>:<span class="mxinfo " id="T3:U675">3</span></span>,<span class="mxinfo " id="T32:U676"><span class="mxinfo " id="T3:U677">1</span>:<span class="mxinfo " id="T3:U678"><span class="var type1" id="S72T3U981">col_Aeq</span> - <span class="mxinfo " id="T3:U680">3</span></span></span>)</span> * <span class="mxinfo " id="T1:U681"><span class="var type1" id="S59T1U984">x0</span>(<span class="mxinfo " id="T32:U683"><span class="mxinfo " id="T3:U684">1</span>:<span class="mxinfo " id="T3:U685"><span class="var type1" id="S72T3U988">col_Aeq</span> - <span class="mxinfo " id="T3:U687">3</span></span></span>)</span></span></span>)</span></span>;<span class="comment">%does not work if there is tunnel!!!!!!!!!</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,223" id="srcline223">223</a></span><span class="line">                        </span></span>
<span class="srcline"><span class="lineno"><a href="1,224" id="srcline224">224</a></span><span class="line">                        [<span class="var type1" id="S2T1U993">solution</span>,<span class="var type1" id="S5T3U994">status</span>] = <span class="fcn" id="F758N5:B996">QPACM</span>(<span class="var type1" id="S53T28U997">H</span>,<span class="mxinfo " id="T1:U691">-<span class="var type1" id="S54T1U999">f</span></span>,<span class="var type1" id="S57T28U1000">Aeq</span>,<span class="var type1" id="S58T1U1001">beq</span>,<span class="mxinfo " id="T28:U695">-<span class="var type1" id="S55T28U1003">A</span></span>,<span class="mxinfo " id="T1:U697">-<span class="var type1" id="S56T1U1005">b</span></span>,<span class="var type1" id="S59T1U1006">x0</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,225" id="srcline225">225</a></span><span class="line">                        <span class="comment">% x = quadprog(H,f,A,b,Aeq,beq);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,226" id="srcline226">226</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,227" id="srcline227">227</a></span><span class="line">            <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,228" id="srcline228">228</a></span><span class="line">                <span class="mxinfo " id="T1:U700"><span class="var type1" id="S2T1U1010">solution</span> = <span class="mxinfo " id="T1:U702">zeros(<span class="var type1" id="S52T3U1013">Nvar</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,229" id="srcline229">229</a></span><span class="line">                <span class="mxinfo " id="T3:U704"><span class="var type1" id="S5T3U1017">status</span> = <span class="mxinfo " id="T3:U706">-<span class="mxinfo " id="T3:U707">2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,230" id="srcline230">230</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,231" id="srcline231">231</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,232" id="srcline232">232</a></span><span class="line">            <span class="comment">%             solution = solution.*(abs(solution)&gt;=FeasibilityTol);%!!!!!avoid nuemrical problem</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,233" id="srcline233">233</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,234" id="srcline234">234</a></span><span class="line">            <span class="comment">% output</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,235" id="srcline235">235</a></span><span class="line">            <span class="mxinfo " id="T3:U708"><span class="var type1" id="S75T3U1022">numOfTunnel</span> = <span class="mxinfo " id="T3:U710">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,236" id="srcline236">236</a></span><span class="line">            <span class="mxinfo " id="T3:U711"><span class="var type1" id="S76T3U1026">numOfAzi</span> = <span class="mxinfo " id="T3:U713">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,237" id="srcline237">237</a></span><span class="line">            <span class="mxinfo " id="T3:U714"><span class="var type1" id="S77T3U1030">numOfFpp</span> = <span class="mxinfo " id="T3:U716">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,238" id="srcline238">238</a></span><span class="line">            <span class="mxinfo " id="T3:U717"><span class="var type1" id="S78T3U1034">count_target_thr</span> = <span class="mxinfo " id="T3:U719">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,239" id="srcline239">239</a></span><span class="line">            <span class="keyword">for</span> <span class="var type1" id="S45T3U1038">i</span>=<span class="mxinfo " id="T1:U721"><span class="mxinfo " id="T3:U722">1</span>:<span class="var type1" id="S8T3U1041">N_enabled_thruster</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,240" id="srcline240">240</a></span><span class="line">                <span class="mxinfo " id="T3:U724"><span class="mxinfo " id="T3:U725"><span class="mxinfo " id="T34:U726"><span class="var type1" id="S3T2U1046">alloc_out</span>(<span class="var type1" id="S45T3U1047">i</span>)</span>.label</span> = <span class="mxinfo " id="T3:U729"><span class="mxinfo " id="T26:U730"><span class="var type1" id="S4T4U1051">thruster_data</span>(<span class="var type1" id="S45T3U1052">i</span>)</span>.label</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,241" id="srcline241">241</a></span><span class="line">                <span class="mxinfo " id="T3:U733"><span class="mxinfo " id="T3:U734"><span class="mxinfo " id="T34:U735"><span class="var type1" id="S3T2U1058">alloc_out</span>(<span class="var type1" id="S45T3U1059">i</span>)</span>.enable</span> = <span class="mxinfo " id="T3:U738"><span class="mxinfo " id="T26:U739"><span class="var type1" id="S4T4U1063">thruster_data</span>(<span class="var type1" id="S45T3U1064">i</span>)</span>.enable</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,242" id="srcline242">242</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="1,243" id="srcline243">243</a></span><span class="line">                <span class="keyword">switch</span> <span class="mxinfo " id="T3:U742"><span class="mxinfo " id="T26:U743"><span class="var type1" id="S4T4U1069">thruster_data</span>(<span class="var type1" id="S45T3U1070">i</span>)</span>.type</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,244" id="srcline244">244</a></span><span class="line">                    <span class="keyword">case</span> <span class="mxinfo " id="T3:U746">4</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,245" id="srcline245">245</a></span><span class="line">                        <span class="mxinfo " id="T3:U747"><span class="var type1" id="S79T3U1076">temp</span> = <span class="mxinfo " id="T3:U749"><span class="mxinfo " id="T3:U750"><span class="mxinfo " id="T3:U751"><span class="var type1" id="S75T3U1080">numOfTunnel</span> * <span class="mxinfo " id="T3:U753">2</span></span> + <span class="mxinfo " id="T3:U754"><span class="var type1" id="S76T3U1083">numOfAzi</span> * <span class="mxinfo " id="T3:U756">2</span></span></span> + <span class="mxinfo " id="T3:U757"><span class="var type1" id="S77T3U1086">numOfFpp</span> * <span class="mxinfo " id="T3:U759">2</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,246" id="srcline246">246</a></span><span class="line">                        <span class="mxinfo " id="T3:U760"><span class="mxinfo " id="T3:U761"><span class="mxinfo " id="T34:U762"><span class="var type1" id="S3T2U1092">alloc_out</span>(<span class="var type1" id="S45T3U1093">i</span>)</span>.Tx</span> = <span class="mxinfo " id="T3:U765"><span class="mxinfo " id="T3:U766"><span class="var type1" id="S2T1U1097">solution</span>(<span class="mxinfo " id="T3:U768"><span class="var type1" id="S79T3U1099">temp</span> + <span class="mxinfo " id="T3:U770">1</span></span>)</span> * <span class="mxinfo " id="T3:U771"><span class="mxinfo " id="T3:U772"><span class="mxinfo " id="T26:U773"><span class="var type1" id="S4T4U1104">thruster_data</span>(<span class="var type1" id="S45T3U1105">i</span>)</span>.Tmax</span>^2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,247" id="srcline247">247</a></span><span class="line">                        <span class="mxinfo " id="T3:U776"><span class="mxinfo " id="T3:U777"><span class="mxinfo " id="T34:U778"><span class="var type1" id="S3T2U1112">alloc_out</span>(<span class="var type1" id="S45T3U1113">i</span>)</span>.Ty</span> = <span class="mxinfo " id="T3:U781"><span class="mxinfo " id="T3:U782"><span class="var type1" id="S2T1U1117">solution</span>(<span class="mxinfo " id="T3:U784"><span class="var type1" id="S79T3U1119">temp</span> + <span class="mxinfo " id="T3:U786">2</span></span>)</span> * <span class="mxinfo " id="T3:U787"><span class="mxinfo " id="T3:U788"><span class="mxinfo " id="T26:U789"><span class="var type1" id="S4T4U1124">thruster_data</span>(<span class="var type1" id="S45T3U1125">i</span>)</span>.Tmax</span>^2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,248" id="srcline248">248</a></span><span class="line">                        <span class="mxinfo " id="T3:U792"><span class="mxinfo " id="T3:U793"><span class="mxinfo " id="T34:U794"><span class="var type1" id="S3T2U1132">alloc_out</span>(<span class="var type1" id="S45T3U1133">i</span>)</span>.T</span> = <span class="mxinfo " id="T3:U797"><span class="mxinfo " id="T34:U798"><span class="var type1" id="S3T2U1137">alloc_out</span>(<span class="var type1" id="S45T3U1138">i</span>)</span>.Ty</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,249" id="srcline249">249</a></span><span class="line">                        <span class="comment">%                 alloc_out(i).phi = atan2(solution(numOfTunnel * 2 + numOfAzi * 2 + numOfFpp * 2 + 2), <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,250" id="srcline250">250</a></span><span class="line">                        <span class="comment">%                     solution(numOfTunnel * 2 + numOfAzi * 2 + numOfFpp * 2 + 1));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,251" id="srcline251">251</a></span><span class="line">                        <span class="mxinfo " id="T3:U801"><span class="mxinfo " id="T3:U802"><span class="mxinfo " id="T34:U803"><span class="var type1" id="S3T2U1144">alloc_out</span>(<span class="var type1" id="S45T3U1145">i</span>)</span>.phi</span> = <span class="mxinfo " id="T3:U806"><span class="mxinfo " id="T26:U807"><span class="var type1" id="S4T4U1149">thruster_data</span>(<span class="var type1" id="S45T3U1150">i</span>)</span>.phi</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,252" id="srcline252">252</a></span><span class="line">                        <span class="mxinfo " id="T3:U810"><span class="mxinfo " id="T3:U811"><span class="mxinfo " id="T34:U812"><span class="var type1" id="S3T2U1156">alloc_out</span>(<span class="var type1" id="S45T3U1157">i</span>)</span>.phi</span> = <span class="mxinfo " id="T3:U815"><span class="mxinfo " id="T3:U816"><span class="mxinfo " id="T3:U817"><span class="mxinfo " id="T26:U818"><span class="var type1" id="S4T4U1163">thruster_data</span>(<span class="var type1" id="S45T3U1164">i</span>)</span>.phi</span> * (<span class="mxinfo " id="T7:U821"><span class="mxinfo " id="T3:U822">abs(<span class="mxinfo " id="T3:U823">[<span class="mxinfo " id="T34:U824"><span class="var type1" id="S3T2U1174">alloc_out</span>(<span class="var type1" id="S45T3U1175">i</span>)</span>.T]</span>)</span> &lt;= <span class="var type1" id="S62T3U1177">FeasibilityTol</span></span>)</span> <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,253" id="srcline253">253</a></span><span class="line">                            + <span class="mxinfo " id="T3:U828"><span class="mxinfo " id="T3:U829"><span class="mxinfo " id="T34:U830"><span class="var type1" id="S3T2U1181">alloc_out</span>(<span class="var type1" id="S45T3U1182">i</span>)</span>.phi</span> .* (<span class="mxinfo " id="T7:U833"><span class="mxinfo " id="T3:U834">abs(<span class="mxinfo " id="T3:U835"><span class="mxinfo " id="T34:U836"><span class="var type1" id="S3T2U1190">alloc_out</span>(<span class="var type1" id="S45T3U1191">i</span>)</span>.T</span>)</span> &gt; <span class="var type1" id="S62T3U1193">FeasibilityTol</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,254" id="srcline254">254</a></span><span class="line">                        <span class="mxinfo " id="T3:U840"><span class="mxinfo " id="T3:U841"><span class="mxinfo " id="T34:U842"><span class="var type1" id="S3T2U1198">alloc_out</span>(<span class="var type1" id="S45T3U1199">i</span>)</span>.Tm</span> = <span class="mxinfo " id="T3:U845"><span class="mxinfo " id="T3:U846"><span class="mxinfo " id="T3:U847"><span class="mxinfo " id="T34:U848"><span class="var type1" id="S3T2U1205">alloc_out</span>(<span class="var type1" id="S45T3U1206">i</span>)</span>.Ty</span> * (<span class="mxinfo " id="T3:U851"><span class="mxinfo " id="T3:U852"><span class="mxinfo " id="T26:U853"><span class="var type1" id="S4T4U1212">thruster_data</span>(<span class="var type1" id="S45T3U1213">i</span>)</span>.x</span> <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,255" id="srcline255">255</a></span><span class="line">                            - <span class="mxinfo " id="T3:U856"><span class="mxinfo " id="T26:U857"><span class="var type1" id="S4T4U1217">thruster_data</span>(<span class="var type1" id="S45T3U1218">i</span>)</span>. x0</span></span>)</span> + <span class="mxinfo " id="T3:U860"><span class="mxinfo " id="T3:U861"><span class="mxinfo " id="T34:U862"><span class="var type1" id="S3T2U1223">alloc_out</span>(<span class="var type1" id="S45T3U1224">i</span>)</span>.Tx</span> <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,256" id="srcline256">256</a></span><span class="line">                            * (<span class="mxinfo " id="T3:U865"><span class="mxinfo " id="T3:U866"><span class="mxinfo " id="T26:U867"><span class="var type1" id="S4T4U1230">thruster_data</span>(<span class="var type1" id="S45T3U1231">i</span>)</span>.y0</span> - <span class="mxinfo " id="T3:U870"><span class="mxinfo " id="T26:U871"><span class="var type1" id="S4T4U1235">thruster_data</span>(<span class="var type1" id="S45T3U1236">i</span>)</span>.y</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,257" id="srcline257">257</a></span><span class="line">                        </span></span>
<span class="srcline"><span class="lineno"><a href="1,258" id="srcline258">258</a></span><span class="line">                        <span class="mxinfo " id="T3:U874"><span class="var type1" id="S75T3U1240">numOfTunnel</span> = <span class="mxinfo " id="T3:U876"><span class="var type1" id="S75T3U1242">numOfTunnel</span> + <span class="mxinfo " id="T3:U878">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,259" id="srcline259">259</a></span><span class="line">                    <span class="keyword">case</span> <span class="mxinfo " id="T3:U879">3</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,260" id="srcline260">260</a></span><span class="line">                        <span class="mxinfo " id="T3:U880"><span class="var type1" id="S79T3U1248">temp</span> = <span class="mxinfo " id="T3:U882"><span class="mxinfo " id="T3:U883"><span class="mxinfo " id="T3:U884"><span class="var type1" id="S75T3U1252">numOfTunnel</span> * <span class="mxinfo " id="T3:U886">2</span></span> + <span class="mxinfo " id="T3:U887"><span class="var type1" id="S76T3U1255">numOfAzi</span> * <span class="mxinfo " id="T3:U889">2</span></span></span> + <span class="mxinfo " id="T3:U890"><span class="var type1" id="S77T3U1258">numOfFpp</span> * <span class="mxinfo " id="T3:U892">2</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,261" id="srcline261">261</a></span><span class="line">                        <span class="mxinfo " id="T3:U893"><span class="mxinfo " id="T3:U894"><span class="mxinfo " id="T34:U895"><span class="var type1" id="S3T2U1264">alloc_out</span>(<span class="var type1" id="S45T3U1265">i</span>)</span>.Tx</span> = <span class="mxinfo " id="T3:U898"><span class="mxinfo " id="T3:U899"><span class="var type1" id="S2T1U1269">solution</span>(<span class="mxinfo " id="T3:U901"><span class="var type1" id="S79T3U1271">temp</span> + <span class="mxinfo " id="T3:U903">1</span></span>)</span> * <span class="mxinfo " id="T3:U904"><span class="mxinfo " id="T3:U905"><span class="mxinfo " id="T26:U906"><span class="var type1" id="S4T4U1276">thruster_data</span>(<span class="var type1" id="S45T3U1277">i</span>)</span>.Tmax</span>^2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,262" id="srcline262">262</a></span><span class="line">                        <span class="mxinfo " id="T3:U909"><span class="mxinfo " id="T3:U910"><span class="mxinfo " id="T34:U911"><span class="var type1" id="S3T2U1284">alloc_out</span>(<span class="var type1" id="S45T3U1285">i</span>)</span>.Ty</span> = <span class="mxinfo " id="T3:U914"><span class="mxinfo " id="T3:U915"><span class="var type1" id="S2T1U1289">solution</span>(<span class="mxinfo " id="T3:U917"><span class="var type1" id="S79T3U1291">temp</span> + <span class="mxinfo " id="T3:U919">2</span></span>)</span> * <span class="mxinfo " id="T3:U920"><span class="mxinfo " id="T3:U921"><span class="mxinfo " id="T26:U922"><span class="var type1" id="S4T4U1296">thruster_data</span>(<span class="var type1" id="S45T3U1297">i</span>)</span>.Tmax</span>^2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,263" id="srcline263">263</a></span><span class="line">                        <span class="mxinfo " id="T3:U925"><span class="mxinfo " id="T3:U926"><span class="mxinfo " id="T34:U927"><span class="var type1" id="S3T2U1304">alloc_out</span>(<span class="var type1" id="S45T3U1305">i</span>)</span>.T</span> = <span class="mxinfo " id="T3:U930">sqrt(<span class="mxinfo " id="T3:U931"><span class="mxinfo " id="T3:U932"><span class="mxinfo " id="T3:U933"><span class="mxinfo " id="T34:U934"><span class="var type1" id="S3T2U1313">alloc_out</span>(<span class="var type1" id="S45T3U1314">i</span>)</span>.Tx</span>^2</span> + <span class="mxinfo " id="T3:U937"><span class="mxinfo " id="T3:U938"><span class="mxinfo " id="T34:U939"><span class="var type1" id="S3T2U1320">alloc_out</span>(<span class="var type1" id="S45T3U1321">i</span>)</span>.Ty</span>^2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,264" id="srcline264">264</a></span><span class="line">                        <span class="mxinfo " id="T3:U942"><span class="mxinfo " id="T3:U943"><span class="mxinfo " id="T34:U944"><span class="var type1" id="S3T2U1328">alloc_out</span>(<span class="var type1" id="S45T3U1329">i</span>)</span>.phi</span> = <span class="mxinfo " id="T3:U947">atan2(<span class="mxinfo " id="T3:U948"><span class="mxinfo " id="T34:U949"><span class="var type1" id="S3T2U1335">alloc_out</span>(<span class="var type1" id="S45T3U1336">i</span>)</span>.Ty</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,265" id="srcline265">265</a></span><span class="line">                            <span class="mxinfo " id="T3:U952"><span class="mxinfo " id="T34:U953"><span class="var type1" id="S3T2U1340">alloc_out</span>(<span class="var type1" id="S45T3U1341">i</span>)</span>.Tx</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,266" id="srcline266">266</a></span><span class="line">                        <span class="mxinfo " id="T3:U956"><span class="mxinfo " id="T3:U957"><span class="mxinfo " id="T34:U958"><span class="var type1" id="S3T2U1347">alloc_out</span>(<span class="var type1" id="S45T3U1348">i</span>)</span>.phi</span> = <span class="mxinfo " id="T3:U961"><span class="mxinfo " id="T3:U962"><span class="mxinfo " id="T3:U963"><span class="mxinfo " id="T26:U964"><span class="var type1" id="S4T4U1354">thruster_data</span>(<span class="var type1" id="S45T3U1355">i</span>)</span>.phi</span> * (<span class="mxinfo " id="T7:U967"><span class="mxinfo " id="T3:U968">abs(<span class="mxinfo " id="T3:U969">[<span class="mxinfo " id="T34:U970"><span class="var type1" id="S3T2U1365">alloc_out</span>(<span class="var type1" id="S45T3U1366">i</span>)</span>.T]</span>)</span> &lt;= <span class="var type1" id="S62T3U1368">FeasibilityTol</span></span>)</span> <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,267" id="srcline267">267</a></span><span class="line">                            + <span class="mxinfo " id="T3:U974"><span class="mxinfo " id="T3:U975"><span class="mxinfo " id="T34:U976"><span class="var type1" id="S3T2U1372">alloc_out</span>(<span class="var type1" id="S45T3U1373">i</span>)</span>.phi</span> .* (<span class="mxinfo " id="T7:U979"><span class="mxinfo " id="T3:U980">abs(<span class="mxinfo " id="T3:U981"><span class="mxinfo " id="T34:U982"><span class="var type1" id="S3T2U1381">alloc_out</span>(<span class="var type1" id="S45T3U1382">i</span>)</span>.T</span>)</span> &gt; <span class="var type1" id="S62T3U1384">FeasibilityTol</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,268" id="srcline268">268</a></span><span class="line">                        <span class="mxinfo " id="T3:U986"><span class="mxinfo " id="T3:U987"><span class="mxinfo " id="T34:U988"><span class="var type1" id="S3T2U1389">alloc_out</span>(<span class="var type1" id="S45T3U1390">i</span>)</span>.Tm</span> = <span class="mxinfo " id="T3:U991"><span class="mxinfo " id="T3:U992"><span class="mxinfo " id="T3:U993"><span class="mxinfo " id="T34:U994"><span class="var type1" id="S3T2U1396">alloc_out</span>(<span class="var type1" id="S45T3U1397">i</span>)</span>.Ty</span> * (<span class="mxinfo " id="T3:U997"><span class="mxinfo " id="T3:U998"><span class="mxinfo " id="T26:U999"><span class="var type1" id="S4T4U1403">thruster_data</span>(<span class="var type1" id="S45T3U1404">i</span>)</span>.x</span> <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,269" id="srcline269">269</a></span><span class="line">                            - <span class="mxinfo " id="T3:U1002"><span class="mxinfo " id="T26:U1003"><span class="var type1" id="S4T4U1408">thruster_data</span>(<span class="var type1" id="S45T3U1409">i</span>)</span>. x0</span></span>)</span> + <span class="mxinfo " id="T3:U1006"><span class="mxinfo " id="T3:U1007"><span class="mxinfo " id="T34:U1008"><span class="var type1" id="S3T2U1414">alloc_out</span>(<span class="var type1" id="S45T3U1415">i</span>)</span>.Tx</span> <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,270" id="srcline270">270</a></span><span class="line">                            * (<span class="mxinfo " id="T3:U1011"><span class="mxinfo " id="T3:U1012"><span class="mxinfo " id="T26:U1013"><span class="var type1" id="S4T4U1421">thruster_data</span>(<span class="var type1" id="S45T3U1422">i</span>)</span>.y0</span> - <span class="mxinfo " id="T3:U1016"><span class="mxinfo " id="T26:U1017"><span class="var type1" id="S4T4U1426">thruster_data</span>(<span class="var type1" id="S45T3U1427">i</span>)</span>.y</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,271" id="srcline271">271</a></span><span class="line">                        </span></span>
<span class="srcline"><span class="lineno"><a href="1,272" id="srcline272">272</a></span><span class="line">                       <span class="keyword">if</span> <span class="mxinfo " id="T7:U1020"><span class="var type1" id="S44T3U1433">step</span> == <span class="mxinfo " id="T3:U1022">1</span></span> <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,273" id="srcline273">273</a></span><span class="line">                               &amp;&amp; <span class="mxinfo " id="T7:U1023"><span class="mxinfo " id="T3:U1024">abs(<span class="mxinfo " id="T3:U1025"><span class="mxinfo " id="T3:U1026"><span class="mxinfo " id="T26:U1027"><span class="var type1" id="S4T4U1441">thruster_data</span>(<span class="var type1" id="S45T3U1442">i</span>)</span>.phi_max</span> - <span class="mxinfo " id="T3:U1030"><span class="mxinfo " id="T26:U1031"><span class="var type1" id="S4T4U1446">thruster_data</span>(<span class="var type1" id="S45T3U1447">i</span>)</span>.phi_min</span></span>)</span>&gt; <span class="var type1" id="S62T3U1449">FeasibilityTol</span></span><span class="comment">%means there is forbidden zone</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,274" id="srcline274">274</a></span><span class="line">                        <span class="keyword">if</span> <span class="mxinfo " id="T7:U1035"><span class="mxinfo " id="T3:U1036"><span class="fcn" id="F300N8:B1454">angle_dist</span>(<span class="mxinfo " id="T3:U1037"><span class="mxinfo " id="T26:U1038"><span class="var type1" id="S4T4U1457">thruster_data</span>(<span class="var type1" id="S45T3U1458">i</span>)</span>.phi_min</span>,<span class="mxinfo " id="T3:U1041"><span class="mxinfo " id="T34:U1042"><span class="var type1" id="S3T2U1462">alloc_out</span>(<span class="var type1" id="S45T3U1463">i</span>)</span>.phi</span>)</span> <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,275" id="srcline275">275</a></span><span class="line">                                &gt; <span class="mxinfo " id="T3:U1045"><span class="mxinfo " id="T3:U1046"><span class="fcn" id="F300N8:B1467">angle_dist</span>(<span class="mxinfo " id="T3:U1047"><span class="mxinfo " id="T26:U1048"><span class="var type1" id="S4T4U1470">thruster_data</span>(<span class="var type1" id="S45T3U1471">i</span>)</span>.phi_min</span>,<span class="mxinfo " id="T3:U1051"><span class="mxinfo " id="T26:U1052"><span class="var type1" id="S4T4U1475">thruster_data</span>(<span class="var type1" id="S45T3U1476">i</span>)</span>.phi_max</span>)</span> <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,276" id="srcline276">276</a></span><span class="line">                                + <span class="var type1" id="S62T3U1478">FeasibilityTol</span></span></span>                  <span class="comment">% if solution is inside fb zone</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,277" id="srcline277">277</a></span><span class="line">                            </span></span>
<span class="srcline"><span class="lineno"><a href="1,278" id="srcline278">278</a></span><span class="line"><span class="comment">%                             thruster_data(i).constr = 3;%means angle is fixed and  solution is inside fb zone</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,279" id="srcline279">279</a></span><span class="line">                            <span class="mxinfo " id="T3:U1056"><span class="mxinfo " id="T3:U1057"><span class="mxinfo " id="T26:U1058"><span class="var type1" id="S4T4U1483">thruster_data</span>(<span class="var type1" id="S45T3U1484">i</span>)</span>.constr</span> = <span class="mxinfo " id="T3:U1061">2</span></span>;<span class="comment">%added v4.00!!!!!!!!!!!!!!!</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,280" id="srcline280">280</a></span><span class="line">                            <span class="keyword">if</span> <span class="mxinfo " id="T7:U1062"><span class="mxinfo " id="T3:U1063"><span class="var type1" id="S18T12U1491">on_border</span>(<span class="var type1" id="S45T3U1492">i</span>)</span> == <span class="mxinfo " id="T3:U1066">0</span></span> <span class="comment">%esle use previous phi, phi_ and phiPlus</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,281" id="srcline281">281</a></span><span class="line">                                <span class="keyword">if</span> <span class="mxinfo " id="T7:U1067"><span class="mxinfo " id="T3:U1068"><span class="fcn" id="F300N8:B1498">angle_dist</span>(<span class="mxinfo " id="T3:U1069"><span class="mxinfo " id="T26:U1070"><span class="var type1" id="S4T4U1501">thruster_data</span>(<span class="var type1" id="S45T3U1502">i</span>)</span>.phi_max</span>,<span class="mxinfo " id="T3:U1073"><span class="mxinfo " id="T34:U1074"><span class="var type1" id="S3T2U1506">alloc_out</span>(<span class="var type1" id="S45T3U1507">i</span>)</span>.phi</span>)</span> <span class="keyword">...</span><span class="comment"><span class="comment">%phi closer to min</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,282" id="srcline282">282</a></span><span class="line">                                        &gt; <span class="mxinfo " id="T3:U1077"><span class="fcn" id="F300N8:B1510">angle_dist</span>(<span class="mxinfo " id="T3:U1078"><span class="mxinfo " id="T34:U1079"><span class="var type1" id="S3T2U1513">alloc_out</span>(<span class="var type1" id="S45T3U1514">i</span>)</span>.phi</span>,<span class="mxinfo " id="T3:U1082"><span class="mxinfo " id="T26:U1083"><span class="var type1" id="S4T4U1518">thruster_data</span>(<span class="var type1" id="S45T3U1519">i</span>)</span>.phi_min</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,283" id="srcline283">283</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,284" id="srcline284">284</a></span><span class="line">                                    <span class="mxinfo " id="T3:U1086"><span class="mxinfo " id="T3:U1087"><span class="mxinfo " id="T26:U1088"><span class="var type1" id="S4T4U1525">thruster_data</span>(<span class="var type1" id="S45T3U1526">i</span>)</span>.phi_</span> = <span class="mxinfo " id="T3:U1091"><span class="mxinfo " id="T26:U1092"><span class="var type1" id="S4T4U1530">thruster_data</span>(<span class="var type1" id="S45T3U1531">i</span>)</span>.phi_min</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,285" id="srcline285">285</a></span><span class="line">                                    <span class="mxinfo " id="T3:U1095"><span class="mxinfo " id="T3:U1096"><span class="mxinfo " id="T26:U1097"><span class="var type1" id="S4T4U1537">thruster_data</span>(<span class="var type1" id="S45T3U1538">i</span>)</span>.phiPlus</span> = <span class="mxinfo " id="T3:U1100"><span class="mxinfo " id="T3:U1101"><span class="mxinfo " id="T26:U1102"><span class="var type1" id="S4T4U1543">thruster_data</span>(<span class="var type1" id="S45T3U1544">i</span>)</span>.phi_min</span> <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,286" id="srcline286">286</a></span><span class="line">                                        + <span class="mxinfo " id="T3:U1105"><span class="mxinfo " id="T3:U1106"><span class="mxinfo " id="T3:U1107">2</span> * <span class="var type1" id="S36T3U1549">dt</span></span> * <span class="mxinfo " id="T3:U1109"><span class="mxinfo " id="T26:U1110"><span class="var type1" id="S4T4U1552">thruster_data</span>(<span class="var type1" id="S45T3U1553">i</span>)</span>.dphi_max</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,287" id="srcline287">287</a></span><span class="line">                                    <span class="mxinfo " id="T3:U1113"><span class="mxinfo " id="T3:U1114"><span class="mxinfo " id="T26:U1115"><span class="var type1" id="S4T4U1559">thruster_data</span>(<span class="var type1" id="S45T3U1560">i</span>)</span>.phi</span> = <span class="mxinfo " id="T3:U1118"><span class="mxinfo " id="T3:U1119"><span class="mxinfo " id="T26:U1120"><span class="var type1" id="S4T4U1565">thruster_data</span>(<span class="var type1" id="S45T3U1566">i</span>)</span>.phi_min</span> <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,288" id="srcline288">288</a></span><span class="line">                                        + <span class="mxinfo " id="T3:U1123"><span class="var type1" id="S36T3U1569">dt</span> * <span class="mxinfo " id="T3:U1125"><span class="mxinfo " id="T26:U1126"><span class="var type1" id="S4T4U1572">thruster_data</span>(<span class="var type1" id="S45T3U1573">i</span>)</span>.dphi_max</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,289" id="srcline289">289</a></span><span class="line">                                <span class="keyword">else</span> <span class="comment">%phi closer to max</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,290" id="srcline290">290</a></span><span class="line">                                    <span class="mxinfo " id="T3:U1129"><span class="mxinfo " id="T3:U1130"><span class="mxinfo " id="T26:U1131"><span class="var type1" id="S4T4U1580">thruster_data</span>(<span class="var type1" id="S45T3U1581">i</span>)</span>.phi_</span> = <span class="mxinfo " id="T3:U1134"><span class="mxinfo " id="T3:U1135"><span class="mxinfo " id="T26:U1136"><span class="var type1" id="S4T4U1586">thruster_data</span>(<span class="var type1" id="S45T3U1587">i</span>)</span>.phi_max</span> <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,291" id="srcline291">291</a></span><span class="line">                                        - <span class="mxinfo " id="T3:U1139"><span class="mxinfo " id="T3:U1140"><span class="mxinfo " id="T3:U1141">2</span> * <span class="var type1" id="S36T3U1592">dt</span></span> * <span class="mxinfo " id="T3:U1143"><span class="mxinfo " id="T26:U1144"><span class="var type1" id="S4T4U1595">thruster_data</span>(<span class="var type1" id="S45T3U1596">i</span>)</span>.dphi_max</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,292" id="srcline292">292</a></span><span class="line">                                    <span class="mxinfo " id="T3:U1147"><span class="mxinfo " id="T3:U1148"><span class="mxinfo " id="T26:U1149"><span class="var type1" id="S4T4U1602">thruster_data</span>(<span class="var type1" id="S45T3U1603">i</span>)</span>.phiPlus</span> = <span class="mxinfo " id="T3:U1152"><span class="mxinfo " id="T26:U1153"><span class="var type1" id="S4T4U1607">thruster_data</span>(<span class="var type1" id="S45T3U1608">i</span>)</span>.phi_max</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,293" id="srcline293">293</a></span><span class="line">                                    <span class="mxinfo " id="T3:U1156"><span class="mxinfo " id="T3:U1157"><span class="mxinfo " id="T26:U1158"><span class="var type1" id="S4T4U1614">thruster_data</span>(<span class="var type1" id="S45T3U1615">i</span>)</span>.phi</span> = <span class="mxinfo " id="T3:U1161"><span class="mxinfo " id="T3:U1162"><span class="mxinfo " id="T26:U1163"><span class="var type1" id="S4T4U1620">thruster_data</span>(<span class="var type1" id="S45T3U1621">i</span>)</span>.phi_max</span> <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,294" id="srcline294">294</a></span><span class="line">                                        - <span class="mxinfo " id="T3:U1166"><span class="var type1" id="S36T3U1624">dt</span> * <span class="mxinfo " id="T3:U1168"><span class="mxinfo " id="T26:U1169"><span class="var type1" id="S4T4U1627">thruster_data</span>(<span class="var type1" id="S45T3U1628">i</span>)</span>.dphi_max</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,295" id="srcline295">295</a></span><span class="line">                                <span class="keyword">end</span>                                </span></span>
<span class="srcline"><span class="lineno"><a href="1,296" id="srcline296">296</a></span><span class="line">                            <span class="keyword">end</span>                                                                </span></span>
<span class="srcline"><span class="lineno"><a href="1,297" id="srcline297">297</a></span><span class="line">                            <span class="mxinfo " id="T3:U1172"><span class="mxinfo " id="T3:U1173"><span class="mxinfo " id="T26:U1174"><span class="var type1" id="S4T4U1634">thruster_data</span>(<span class="var type1" id="S45T3U1635">i</span>)</span>.T_</span> = <span class="mxinfo " id="T3:U1177"><span class="mxinfo " id="T26:U1178"><span class="var type1" id="S4T4U1639">thruster_data</span>(<span class="var type1" id="S45T3U1640">i</span>)</span>.Tmin</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,298" id="srcline298">298</a></span><span class="line">                            <span class="mxinfo " id="T3:U1181"><span class="mxinfo " id="T3:U1182"><span class="mxinfo " id="T26:U1183"><span class="var type1" id="S4T4U1646">thruster_data</span>(<span class="var type1" id="S45T3U1647">i</span>)</span>.Tplus</span> = <span class="mxinfo " id="T3:U1186"><span class="mxinfo " id="T26:U1187"><span class="var type1" id="S4T4U1651">thruster_data</span>(<span class="var type1" id="S45T3U1652">i</span>)</span>.Tmax</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,299" id="srcline299">299</a></span><span class="line">                            </span></span>
<span class="srcline"><span class="lineno"><a href="1,300" id="srcline300">300</a></span><span class="line">                            <span class="mxinfo " id="T3:U1190"><span class="var type1" id="S50T3U1656">flag_run</span> = <span class="mxinfo " id="T3:U1192">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,301" id="srcline301">301</a></span><span class="line">                            </span></span>
<span class="srcline"><span class="lineno"><a href="1,302" id="srcline302">302</a></span><span class="line">                        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,303" id="srcline303">303</a></span><span class="line">                        <span class="keyword">if</span> <span class="mxinfo " id="T7:U1193"><span class="mxinfo " id="T3:U1194"><span class="var type1" id="S18T12U1662">on_border</span>(<span class="var type1" id="S45T3U1663">i</span>)</span> == <span class="mxinfo " id="T3:U1197">1</span></span> </span></span>
<span class="srcline"><span class="lineno"><a href="1,304" id="srcline304">304</a></span><span class="line">                            <span class="keyword">if</span> <span class="mxinfo " id="T7:U1198"><span class="mxinfo " id="T3:U1199">abs(<span class="mxinfo " id="T3:U1200"><span class="mxinfo " id="T3:U1201"><span class="mxinfo " id="T26:U1202"><span class="var type1" id="S4T4U1673">thruster_data</span>(<span class="var type1" id="S45T3U1674">i</span>)</span>.phi</span> - <span class="mxinfo " id="T3:U1205"><span class="var type1" id="S19T12U1677">phi_guider_old</span>(<span class="var type1" id="S45T3U1678">i</span>)</span></span>)</span>&gt;<span class="var type1" id="S62T3U1679">FeasibilityTol</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,305" id="srcline305">305</a></span><span class="line">                                <span class="mxinfo " id="T3:U1209"><span class="mxinfo " id="T3:U1210"><span class="mxinfo " id="T26:U1211"><span class="var type1" id="S4T4U1684">thruster_data</span>(<span class="var type1" id="S45T3U1685">i</span>)</span>.phi</span> = <span class="mxinfo " id="T3:U1214"><span class="var type1" id="S19T12U1688">phi_guider_old</span>(<span class="var type1" id="S45T3U1689">i</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,306" id="srcline306">306</a></span><span class="line">                                <span class="mxinfo " id="T3:U1217"><span class="mxinfo " id="T3:U1218"><span class="mxinfo " id="T26:U1219"><span class="var type1" id="S4T4U1694">thruster_data</span>(<span class="var type1" id="S45T3U1695">i</span>)</span>.phi_</span> = <span class="mxinfo " id="T3:U1222"><span class="mxinfo " id="T3:U1223"><span class="mxinfo " id="T26:U1224"><span class="var type1" id="S4T4U1700">thruster_data</span>(<span class="var type1" id="S45T3U1701">i</span>)</span>.phi</span> <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,307" id="srcline307">307</a></span><span class="line">                                    - <span class="mxinfo " id="T3:U1227">1e-4</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,308" id="srcline308">308</a></span><span class="line">                                <span class="mxinfo " id="T3:U1228"><span class="mxinfo " id="T3:U1229"><span class="mxinfo " id="T26:U1230"><span class="var type1" id="S4T4U1708">thruster_data</span>(<span class="var type1" id="S45T3U1709">i</span>)</span>.phiPlus</span> = <span class="mxinfo " id="T3:U1233"><span class="mxinfo " id="T3:U1234"><span class="mxinfo " id="T26:U1235"><span class="var type1" id="S4T4U1714">thruster_data</span>(<span class="var type1" id="S45T3U1715">i</span>)</span>.phi</span> <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,309" id="srcline309">309</a></span><span class="line">                                    + <span class="mxinfo " id="T3:U1238">1e-4</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,310" id="srcline310">310</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,311" id="srcline311">311</a></span><span class="line">                                <span class="mxinfo " id="T3:U1239"><span class="var type1" id="S50T3U1720">flag_run</span> = <span class="mxinfo " id="T3:U1241">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,312" id="srcline312">312</a></span><span class="line">                            <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,313" id="srcline313">313</a></span><span class="line">                                <span class="mxinfo " id="T3:U1242"><span class="mxinfo " id="T3:U1243"><span class="mxinfo " id="T26:U1244"><span class="var type1" id="S4T4U1727">thruster_data</span>(<span class="var type1" id="S45T3U1728">i</span>)</span>.phi_</span> = <span class="mxinfo " id="T3:U1247"><span class="mxinfo " id="T3:U1248"><span class="mxinfo " id="T26:U1249"><span class="var type1" id="S4T4U1733">thruster_data</span>(<span class="var type1" id="S45T3U1734">i</span>)</span>.phi</span> <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,314" id="srcline314">314</a></span><span class="line">                                - <span class="mxinfo " id="T3:U1252">1e-4</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,315" id="srcline315">315</a></span><span class="line">                                <span class="mxinfo " id="T3:U1253"><span class="mxinfo " id="T3:U1254"><span class="mxinfo " id="T26:U1255"><span class="var type1" id="S4T4U1741">thruster_data</span>(<span class="var type1" id="S45T3U1742">i</span>)</span>.phiPlus</span> = <span class="mxinfo " id="T3:U1258"><span class="mxinfo " id="T3:U1259"><span class="mxinfo " id="T26:U1260"><span class="var type1" id="S4T4U1747">thruster_data</span>(<span class="var type1" id="S45T3U1748">i</span>)</span>.phi</span> <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,316" id="srcline316">316</a></span><span class="line">                                + <span class="mxinfo " id="T3:U1263">1e-4</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,317" id="srcline317">317</a></span><span class="line">                            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,318" id="srcline318">318</a></span><span class="line">                        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,319" id="srcline319">319</a></span><span class="line">                       <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,320" id="srcline320">320</a></span><span class="line">                       </span></span>
<span class="srcline"><span class="lineno"><a href="1,321" id="srcline321">321</a></span><span class="line">                        </span></span>
<span class="srcline"><span class="lineno"><a href="1,322" id="srcline322">322</a></span><span class="line">                        </span></span>
<span class="srcline"><span class="lineno"><a href="1,323" id="srcline323">323</a></span><span class="line">                        <span class="mxinfo " id="T3:U1264"><span class="var type1" id="S76T3U1753">numOfAzi</span> = <span class="mxinfo " id="T3:U1266"><span class="var type1" id="S76T3U1755">numOfAzi</span> + <span class="mxinfo " id="T3:U1268">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,324" id="srcline324">324</a></span><span class="line">                        </span></span>
<span class="srcline"><span class="lineno"><a href="1,325" id="srcline325">325</a></span><span class="line">                        </span></span>
<span class="srcline"><span class="lineno"><a href="1,326" id="srcline326">326</a></span><span class="line">                    <span class="keyword">case</span> <span class="mxinfo " id="T3:U1269">2</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,327" id="srcline327">327</a></span><span class="line">                        <span class="mxinfo " id="T3:U1270"><span class="var type1" id="S79T3U1761">temp</span> = <span class="mxinfo " id="T3:U1272"><span class="mxinfo " id="T3:U1273"><span class="mxinfo " id="T3:U1274"><span class="var type1" id="S75T3U1765">numOfTunnel</span> * <span class="mxinfo " id="T3:U1276">2</span></span> + <span class="mxinfo " id="T3:U1277"><span class="var type1" id="S76T3U1768">numOfAzi</span> * <span class="mxinfo " id="T3:U1279">2</span></span></span> + <span class="mxinfo " id="T3:U1280"><span class="var type1" id="S77T3U1771">numOfFpp</span> * <span class="mxinfo " id="T3:U1282">2</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,328" id="srcline328">328</a></span><span class="line">                        <span class="mxinfo " id="T3:U1283"><span class="mxinfo " id="T3:U1284"><span class="mxinfo " id="T34:U1285"><span class="var type1" id="S3T2U1777">alloc_out</span>(<span class="var type1" id="S45T3U1778">i</span>)</span>.Tx</span> = <span class="mxinfo " id="T3:U1288"><span class="mxinfo " id="T3:U1289"><span class="var type1" id="S2T1U1782">solution</span>(<span class="mxinfo " id="T3:U1291"><span class="var type1" id="S79T3U1784">temp</span> + <span class="mxinfo " id="T3:U1293">1</span></span>)</span> * <span class="mxinfo " id="T3:U1294"><span class="mxinfo " id="T3:U1295"><span class="mxinfo " id="T26:U1296"><span class="var type1" id="S4T4U1789">thruster_data</span>(<span class="var type1" id="S45T3U1790">i</span>)</span>.Tmax</span>^2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,329" id="srcline329">329</a></span><span class="line">                        <span class="mxinfo " id="T3:U1299"><span class="mxinfo " id="T3:U1300"><span class="mxinfo " id="T34:U1301"><span class="var type1" id="S3T2U1797">alloc_out</span>(<span class="var type1" id="S45T3U1798">i</span>)</span>.Ty</span> = <span class="mxinfo " id="T3:U1304"><span class="mxinfo " id="T3:U1305"><span class="var type1" id="S2T1U1802">solution</span>(<span class="mxinfo " id="T3:U1307"><span class="var type1" id="S79T3U1804">temp</span> + <span class="mxinfo " id="T3:U1309">2</span></span>)</span> * <span class="mxinfo " id="T3:U1310"><span class="mxinfo " id="T3:U1311"><span class="mxinfo " id="T26:U1312"><span class="var type1" id="S4T4U1809">thruster_data</span>(<span class="var type1" id="S45T3U1810">i</span>)</span>.Tmax</span>^2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,330" id="srcline330">330</a></span><span class="line">                        <span class="mxinfo " id="T3:U1315"><span class="mxinfo " id="T3:U1316"><span class="mxinfo " id="T34:U1317"><span class="var type1" id="S3T2U1817">alloc_out</span>(<span class="var type1" id="S45T3U1818">i</span>)</span>.T</span> = <span class="mxinfo " id="T3:U1320">sqrt(<span class="mxinfo " id="T3:U1321"><span class="mxinfo " id="T3:U1322"><span class="mxinfo " id="T3:U1323"><span class="mxinfo " id="T34:U1324"><span class="var type1" id="S3T2U1826">alloc_out</span>(<span class="var type1" id="S45T3U1827">i</span>)</span>.Tx</span>^2</span> + <span class="mxinfo " id="T3:U1327"><span class="mxinfo " id="T3:U1328"><span class="mxinfo " id="T34:U1329"><span class="var type1" id="S3T2U1833">alloc_out</span>(<span class="var type1" id="S45T3U1834">i</span>)</span>.Ty</span>^2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,331" id="srcline331">331</a></span><span class="line">                        <span class="mxinfo " id="T3:U1332"><span class="mxinfo " id="T3:U1333"><span class="mxinfo " id="T34:U1334"><span class="var type1" id="S3T2U1841">alloc_out</span>(<span class="var type1" id="S45T3U1842">i</span>)</span>.phi</span> = <span class="mxinfo " id="T3:U1337">atan2(<span class="mxinfo " id="T3:U1338"><span class="mxinfo " id="T34:U1339"><span class="var type1" id="S3T2U1848">alloc_out</span>(<span class="var type1" id="S45T3U1849">i</span>)</span>.Ty</span> , <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,332" id="srcline332">332</a></span><span class="line">                            <span class="mxinfo " id="T3:U1342"><span class="mxinfo " id="T34:U1343"><span class="var type1" id="S3T2U1853">alloc_out</span>(<span class="var type1" id="S45T3U1854">i</span>)</span>.Tx</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,333" id="srcline333">333</a></span><span class="line">                        <span class="mxinfo " id="T3:U1346"><span class="mxinfo " id="T3:U1347"><span class="mxinfo " id="T34:U1348"><span class="var type1" id="S3T2U1860">alloc_out</span>(<span class="var type1" id="S45T3U1861">i</span>)</span>.phi</span> = <span class="mxinfo " id="T3:U1351"><span class="mxinfo " id="T3:U1352"><span class="mxinfo " id="T3:U1353"><span class="mxinfo " id="T26:U1354"><span class="var type1" id="S4T4U1867">thruster_data</span>(<span class="var type1" id="S45T3U1868">i</span>)</span>.phi</span> * (<span class="mxinfo " id="T7:U1357"><span class="mxinfo " id="T3:U1358">abs(<span class="mxinfo " id="T3:U1359">[<span class="mxinfo " id="T34:U1360"><span class="var type1" id="S3T2U1878">alloc_out</span>(<span class="var type1" id="S45T3U1879">i</span>)</span>.T]</span>)</span> &lt;= <span class="var type1" id="S62T3U1881">FeasibilityTol</span></span>)</span> <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,334" id="srcline334">334</a></span><span class="line">                            + <span class="mxinfo " id="T3:U1364"><span class="mxinfo " id="T3:U1365"><span class="mxinfo " id="T34:U1366"><span class="var type1" id="S3T2U1885">alloc_out</span>(<span class="var type1" id="S45T3U1886">i</span>)</span>.phi</span> .* (<span class="mxinfo " id="T7:U1369"><span class="mxinfo " id="T3:U1370">abs(<span class="mxinfo " id="T3:U1371"><span class="mxinfo " id="T34:U1372"><span class="var type1" id="S3T2U1894">alloc_out</span>(<span class="var type1" id="S45T3U1895">i</span>)</span>.T</span>)</span> &gt; <span class="var type1" id="S62T3U1897">FeasibilityTol</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,335" id="srcline335">335</a></span><span class="line">                        <span class="mxinfo " id="T3:U1376"><span class="mxinfo " id="T3:U1377"><span class="mxinfo " id="T34:U1378"><span class="var type1" id="S3T2U1902">alloc_out</span>(<span class="var type1" id="S45T3U1903">i</span>)</span>.phi</span> = <span class="mxinfo " id="T3:U1381"><span class="mxinfo " id="T3:U1382">sign(<span class="mxinfo " id="T3:U1383"><span class="mxinfo " id="T34:U1384"><span class="var type1" id="S3T2U1910">alloc_out</span>(<span class="var type1" id="S45T3U1911">i</span>)</span>.phi</span>)</span> * <span class="mxinfo " id="T3:U1387">polyval(<span class="var type1" id="S16T11U1915">Fangle_Rangle</span>,<span class="mxinfo " id="T3:U1389">abs(<span class="mxinfo " id="T3:U1390"><span class="mxinfo " id="T34:U1391"><span class="var type1" id="S3T2U1920">alloc_out</span>(<span class="var type1" id="S45T3U1921">i</span>)</span>.phi</span>)</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,336" id="srcline336">336</a></span><span class="line">                        <span class="mxinfo " id="T3:U1394"><span class="mxinfo " id="T3:U1395"><span class="mxinfo " id="T34:U1396"><span class="var type1" id="S3T2U1927">alloc_out</span>(<span class="var type1" id="S45T3U1928">i</span>)</span>.Tm</span> = <span class="mxinfo " id="T3:U1399"><span class="mxinfo " id="T3:U1400"><span class="mxinfo " id="T3:U1401"><span class="mxinfo " id="T34:U1402"><span class="var type1" id="S3T2U1934">alloc_out</span>(<span class="var type1" id="S45T3U1935">i</span>)</span>.Ty</span> * (<span class="mxinfo " id="T3:U1405"><span class="mxinfo " id="T3:U1406"><span class="mxinfo " id="T26:U1407"><span class="var type1" id="S4T4U1941">thruster_data</span>(<span class="var type1" id="S45T3U1942">i</span>)</span>.x</span> <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,337" id="srcline337">337</a></span><span class="line">                            - <span class="mxinfo " id="T3:U1410"><span class="mxinfo " id="T26:U1411"><span class="var type1" id="S4T4U1946">thruster_data</span>(<span class="var type1" id="S45T3U1947">i</span>)</span>. x0</span></span>)</span> + <span class="mxinfo " id="T3:U1414"><span class="mxinfo " id="T3:U1415"><span class="mxinfo " id="T34:U1416"><span class="var type1" id="S3T2U1952">alloc_out</span>(<span class="var type1" id="S45T3U1953">i</span>)</span>.Tx</span> <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,338" id="srcline338">338</a></span><span class="line">                            * (<span class="mxinfo " id="T3:U1419"><span class="mxinfo " id="T3:U1420"><span class="mxinfo " id="T26:U1421"><span class="var type1" id="S4T4U1959">thruster_data</span>(<span class="var type1" id="S45T3U1960">i</span>)</span>.y0</span> - <span class="mxinfo " id="T3:U1424"><span class="mxinfo " id="T26:U1425"><span class="var type1" id="S4T4U1964">thruster_data</span>(<span class="var type1" id="S45T3U1965">i</span>)</span>.y</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,339" id="srcline339">339</a></span><span class="line">                        <span class="mxinfo " id="T3:U1428"><span class="var type1" id="S77T3U1969">numOfFpp</span> = <span class="mxinfo " id="T3:U1430"><span class="var type1" id="S77T3U1971">numOfFpp</span> + <span class="mxinfo " id="T3:U1432">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,340" id="srcline340">340</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,341" id="srcline341">341</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,342" id="srcline342">342</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo " id="T7:U1433"><span class="var type1" id="S5T3U1976">status</span> &lt; <span class="mxinfo " id="T3:U1435">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,343" id="srcline343">343</a></span><span class="line">                <span class="keyword">break</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,344" id="srcline344">344</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,345" id="srcline345">345</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,346" id="srcline346">346</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo " id="T7:U1436"><span class="var type1" id="S51T3U1982">count_run</span> &gt; <span class="mxinfo " id="T3:U1438">50</span></span><span class="comment">%avoid too many loops</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,347" id="srcline347">347</a></span><span class="line">                <span class="keyword">break</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,348" id="srcline348">348</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,349" id="srcline349">349</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,350" id="srcline350">350</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,351" id="srcline351">351</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo " id="T7:U1439"><span class="var type1" id="S44T3U1988">step</span> == <span class="mxinfo " id="T3:U1441">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,352" id="srcline352">352</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,353" id="srcline353">353</a></span><span class="line">            <span class="mxinfo " id="T3:U1442"><span class="var type1" id="S43T3U1992">diff_phi</span> = <span class="mxinfo " id="T3:U1444">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,354" id="srcline354">354</a></span><span class="line">            <span class="keyword">for</span> <span class="var type1" id="S45T3U1996">i</span>=<span class="mxinfo " id="T1:U1446"><span class="mxinfo " id="T3:U1447">1</span>:<span class="var type1" id="S8T3U1999">N_enabled_thruster</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,355" id="srcline355">355</a></span><span class="line">                <span class="comment">%         thruster_data(i).T = alloc_out(i).T;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,356" id="srcline356">356</a></span><span class="line">                <span class="keyword">if</span> <span class="mxinfo " id="T7:U1449"><span class="mxinfo " id="T3:U1450"><span class="mxinfo " id="T26:U1451"><span class="var type1" id="S4T4U2005">thruster_data</span>(<span class="var type1" id="S45T3U2006">i</span>)</span>.type</span> == <span class="mxinfo " id="T3:U1454">3</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,357" id="srcline357">357</a></span><span class="line">                    <span class="mxinfo " id="T3:U1455"><span class="mxinfo " id="T3:U1456"><span class="mxinfo " id="T26:U1457"><span class="var type1" id="S4T4U2013">thruster_data</span>(<span class="var type1" id="S45T3U2014">i</span>)</span>.phi</span> = <span class="mxinfo " id="T3:U1460"><span class="mxinfo " id="T34:U1461"><span class="var type1" id="S3T2U2018">alloc_out</span>(<span class="var type1" id="S45T3U2019">i</span>)</span>.phi</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,358" id="srcline358">358</a></span><span class="line">                    <span class="mxinfo " id="T3:U1464"><span class="var type1" id="S43T3U2023">diff_phi</span> = <span class="mxinfo " id="T3:U1466"><span class="var type1" id="S43T3U2025">diff_phi</span> + <span class="mxinfo " id="T3:U1468">mod(<span class="mxinfo " id="T3:U1469">abs(<span class="mxinfo " id="T3:U1470"><span class="mxinfo " id="T3:U1471"><span class="var type1" id="S47T12U2032">phi0</span>(<span class="var type1" id="S45T3U2033">i</span>)</span> - <span class="mxinfo " id="T3:U1474"><span class="mxinfo " id="T26:U1475"><span class="var type1" id="S4T4U2036">thruster_data</span>(<span class="var type1" id="S45T3U2037">i</span>)</span>.phi</span></span>)</span>,<span class="mxinfo " id="T3:U1478">pi</span>)</span></span></span>;<span class="comment">%check!!!!!!!!!</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,359" id="srcline359">359</a></span><span class="line">                    <span class="mxinfo " id="T3:U1479"><span class="mxinfo " id="T3:U1480"><span class="var type1" id="S47T12U2044">phi0</span>(<span class="var type1" id="S45T3U2045">i</span>)</span> = <span class="mxinfo " id="T3:U1483"><span class="mxinfo " id="T26:U1484"><span class="var type1" id="S4T4U2048">thruster_data</span>(<span class="var type1" id="S45T3U2049">i</span>)</span>.phi</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,360" id="srcline360">360</a></span><span class="line">                    </span></span>
<span class="srcline"><span class="lineno"><a href="1,361" id="srcline361">361</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,362" id="srcline362">362</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,363" id="srcline363">363</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,364" id="srcline364">364</a></span><span class="line">            <span class="mxinfo " id="T3:U1487"><span class="var type1" id="S87T3U2053">error</span> = (<span class="mxinfo " id="T3:U1489">norm(<span class="mxinfo " id="T6:U1490"><span class="var type1" id="S2T1U2058">solution</span>(<span class="mxinfo " id="T6:U1492"><span class="mxinfo " id="T3:U1493"><span class="mxinfo " id="T3:U1494">end</span>-2</span>:end</span>)</span>)</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,365" id="srcline365">365</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo " id="T7:U1495"><span class="var type1" id="S43T3U2070">diff_phi</span> &lt; <span class="mxinfo " id="T3:U1497">0.01</span></span> || <span class="mxinfo " id="T7:U1498"><span class="var type1" id="S46T3U2073">counter</span> &gt; <span class="mxinfo " id="T3:U1500">10</span></span> <span class="comment">%this is the last loop in step one</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,366" id="srcline366">366</a></span><span class="line">                <span class="mxinfo " id="T7:U1501"><span class="var type1" id="S48T7U2077">run</span> = <span class="mxinfo " id="T7:U1503">false</span></span>;<span class="comment">%break the while loop</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,367" id="srcline367">367</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="1,368" id="srcline368">368</a></span><span class="line">                <span class="mxinfo " id="T7:U1504"><span class="var type1" id="S89T7U2082">use_base</span> = <span class="mxinfo " id="T7:U1506">false</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,369" id="srcline369">369</a></span><span class="line">                <span class="keyword">for</span> <span class="var type1" id="S45T3U2087">i</span>=<span class="mxinfo " id="T1:U1508"><span class="mxinfo " id="T3:U1509">1</span>:<span class="var type1" id="S8T3U2090">N_enabled_thruster</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,370" id="srcline370">370</a></span><span class="line">                    <span class="keyword">if</span> <span class="mxinfo " id="T7:U1511"><span class="mxinfo " id="T3:U1512"><span class="mxinfo " id="T26:U1513"><span class="var type1" id="S4T4U2097">thruster_data</span>(<span class="var type1" id="S45T3U2098">i</span>)</span>.type</span> == <span class="mxinfo " id="T3:U1516">3</span></span> <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,371" id="srcline371">371</a></span><span class="line">                            &amp;&amp; <span class="mxinfo " id="T7:U1517"><span class="mxinfo " id="T3:U1518"><span class="mxinfo " id="T34:U1519"><span class="var type1" id="S3T2U2104">alloc_out</span>(<span class="var type1" id="S45T3U2105">i</span>)</span>.T</span> &lt; <span class="mxinfo " id="T3:U1522"><span class="mxinfo " id="T3:U1523"><span class="mxinfo " id="T5:U1524"><span class="mxinfo " id="T26:U1525"><span class="var type1" id="S4T4U2111">thruster_data</span>(<span class="var type1" id="S45T3U2112">i</span>)</span>.base</span>(<span class="mxinfo " id="T17:U1528">1</span>)</span>/<span class="mxinfo " id="T3:U1529">2</span></span></span><span class="comment">%smaller than half base T</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,372" id="srcline372">372</a></span><span class="line">                        <span class="mxinfo " id="T7:U1530"><span class="var type1" id="S89T7U2118">use_base</span> = <span class="mxinfo " id="T7:U1532">true</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,373" id="srcline373">373</a></span><span class="line">                    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,374" id="srcline374">374</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,375" id="srcline375">375</a></span><span class="line"><span class="comment">%                 use_base = true;%use base will increase error when base leads phi in fbzone</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,376" id="srcline376">376</a></span><span class="line">                <span class="keyword">if</span> <span class="var type1" id="S89T7U2123">use_base</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,377" id="srcline377">377</a></span><span class="line">                    <span class="mxinfo " id="T3:U1534"><span class="var type1" id="S90T3U2126">check_base_infb</span> = <span class="mxinfo " id="T3:U1536">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,378" id="srcline378">378</a></span><span class="line">                    <span class="keyword">for</span> <span class="var type1" id="S45T3U2130">i</span>=<span class="mxinfo " id="T1:U1538"><span class="mxinfo " id="T3:U1539">1</span>:<span class="var type1" id="S8T3U2133">N_enabled_thruster</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,379" id="srcline379">379</a></span><span class="line">                        <span class="keyword">if</span> <span class="mxinfo " id="T7:U1541"><span class="mxinfo " id="T3:U1542"><span class="mxinfo " id="T26:U1543"><span class="var type1" id="S4T4U2139">thruster_data</span>(<span class="var type1" id="S45T3U2140">i</span>)</span>.type</span> == <span class="mxinfo " id="T3:U1546">3</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,380" id="srcline380">380</a></span><span class="line">                            [<span class="mxinfo " id="T3:U1547"><span class="var type1" id="S40T12U2147">alloc_out_T</span>(<span class="var type1" id="S45T3U2148">i</span>)</span>,<span class="mxinfo " id="T3:U1550"><span class="var type1" id="S41T12U2150">alloc_out_phi</span>(<span class="var type1" id="S45T3U2151">i</span>)</span>,<span class="var type1" id="S91T3U2152">base_infb</span>] = <span class="fcn" id="F923N19:B2154">baseThrust</span>(<span class="mxinfo " id="T3:U1554"><span class="mxinfo " id="T34:U1555"><span class="var type1" id="S3T2U2157">alloc_out</span>(<span class="var type1" id="S45T3U2158">i</span>)</span>.T</span>,<span class="mxinfo " id="T3:U1558"><span class="mxinfo " id="T34:U1559"><span class="var type1" id="S3T2U2162">alloc_out</span>(<span class="var type1" id="S45T3U2163">i</span>)</span>.phi</span> <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,381" id="srcline381">381</a></span><span class="line">                                ,<span class="mxinfo " id="T3:U1562"><span class="mxinfo " id="T5:U1563"><span class="mxinfo " id="T26:U1564"><span class="var type1" id="S4T4U2168">thruster_data</span>(<span class="var type1" id="S45T3U2169">i</span>)</span>.base</span>(<span class="mxinfo " id="T17:U1567">1</span>)</span>, <span class="mxinfo " id="T3:U1568"><span class="mxinfo " id="T5:U1569"><span class="mxinfo " id="T26:U1570"><span class="var type1" id="S4T4U2175">thruster_data</span>(<span class="var type1" id="S45T3U2176">i</span>)</span>.base</span>(<span class="mxinfo " id="T17:U1573">2</span>)</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,382" id="srcline382">382</a></span><span class="line">                                <span class="mxinfo " id="T3:U1574"><span class="mxinfo " id="T26:U1575"><span class="var type1" id="S4T4U2181">thruster_data</span>(<span class="var type1" id="S45T3U2182">i</span>)</span>.phi_min</span>, <span class="mxinfo " id="T3:U1578"><span class="mxinfo " id="T26:U1579"><span class="var type1" id="S4T4U2186">thruster_data</span>(<span class="var type1" id="S45T3U2187">i</span>)</span>.phi_max</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,383" id="srcline383">383</a></span><span class="line">                            <span class="mxinfo " id="T3:U1582"><span class="var type1" id="S90T3U2191">check_base_infb</span> = <span class="mxinfo " id="T3:U1584"><span class="var type1" id="S90T3U2193">check_base_infb</span> + <span class="var type1" id="S91T3U2194">base_infb</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,384" id="srcline384">384</a></span><span class="line">                        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,385" id="srcline385">385</a></span><span class="line">                    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,386" id="srcline386">386</a></span><span class="line">                    <span class="comment">% the drawback is that when in step</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,387" id="srcline387">387</a></span><span class="line">                    <span class="comment">% 1 check_base_infb == 1, the result will</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,388" id="srcline388">388</a></span><span class="line">                    <span class="comment">% not be accurate because phi</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,389" id="srcline389">389</a></span><span class="line">                    <span class="comment">% in fbzone from step 1 will guide phi in step 2 to the</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,390" id="srcline390">390</a></span><span class="line">                    <span class="comment">% fbzone border. If phi in step 2 is guided to fbzone,</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,391" id="srcline391">391</a></span><span class="line">                    <span class="comment">% the result is accurate. However it is not allowed</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,392" id="srcline392">392</a></span><span class="line">                    <span class="keyword">if</span> <span class="mxinfo " id="T7:U1587"><span class="var type1" id="S90T3U2198">check_base_infb</span> == <span class="mxinfo " id="T3:U1589">0</span></span> <span class="comment">%only use base when it does not bring phi to fbzone</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,393" id="srcline393">393</a></span><span class="line">                        <span class="keyword">for</span> <span class="var type1" id="S45T3U2202">i</span>=<span class="mxinfo " id="T1:U1591"><span class="mxinfo " id="T3:U1592">1</span>:<span class="var type1" id="S8T3U2205">N_enabled_thruster</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,394" id="srcline394">394</a></span><span class="line">                            <span class="keyword">if</span> <span class="mxinfo " id="T7:U1594"><span class="mxinfo " id="T3:U1595"><span class="mxinfo " id="T26:U1596"><span class="var type1" id="S4T4U2211">thruster_data</span>(<span class="var type1" id="S45T3U2212">i</span>)</span>.type</span> == <span class="mxinfo " id="T3:U1599">3</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,395" id="srcline395">395</a></span><span class="line">                                <span class="mxinfo " id="T3:U1600"><span class="mxinfo " id="T3:U1601"><span class="mxinfo " id="T34:U1602"><span class="var type1" id="S3T2U2219">alloc_out</span>(<span class="var type1" id="S45T3U2220">i</span>)</span>.T</span> = <span class="mxinfo " id="T3:U1605"><span class="var type1" id="S40T12U2223">alloc_out_T</span>(<span class="var type1" id="S45T3U2224">i</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,396" id="srcline396">396</a></span><span class="line">                                <span class="mxinfo " id="T3:U1608"><span class="mxinfo " id="T3:U1609"><span class="mxinfo " id="T34:U1610"><span class="var type1" id="S3T2U2229">alloc_out</span>(<span class="var type1" id="S45T3U2230">i</span>)</span>.phi</span> = <span class="mxinfo " id="T3:U1613"><span class="var type1" id="S41T12U2233">alloc_out_phi</span>(<span class="var type1" id="S45T3U2234">i</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,397" id="srcline397">397</a></span><span class="line">                            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,398" id="srcline398">398</a></span><span class="line">                        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,399" id="srcline399">399</a></span><span class="line">                    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,400" id="srcline400">400</a></span><span class="line">                    </span></span>
<span class="srcline"><span class="lineno"><a href="1,401" id="srcline401">401</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,402" id="srcline402">402</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="1,403" id="srcline403">403</a></span><span class="line">                <span class="keyword">for</span> <span class="var type1" id="S45T3U2237">i</span>=<span class="mxinfo " id="T1:U1617"><span class="mxinfo " id="T3:U1618">1</span>:<span class="var type1" id="S8T3U2240">N_enabled_thruster</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,404" id="srcline404">404</a></span><span class="line">                    <span class="keyword">if</span> <span class="mxinfo " id="T7:U1620"><span class="mxinfo " id="T3:U1621"><span class="mxinfo " id="T26:U1622"><span class="var type1" id="S4T4U2246">thruster_data</span>(<span class="var type1" id="S45T3U2247">i</span>)</span>.type</span> == <span class="mxinfo " id="T3:U1625">3</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,405" id="srcline405">405</a></span><span class="line">                        [<span class="mxinfo " id="T3:U1626"><span class="var type1" id="S37T12U2254">phi_0</span>(<span class="var type1" id="S45T3U2255">i</span>)</span>,<span class="mxinfo " id="T3:U1629"><span class="var type1" id="S38T12U2257">phiPlus0</span>(<span class="var type1" id="S45T3U2258">i</span>)</span>,<span class="mxinfo " id="T3:U1632"><span class="var type1" id="S39T12U2260">inside_fz</span>(<span class="var type1" id="S45T3U2261">i</span>)</span>] = <span class="fcn" id="F928N18:B2263">angle_point_to</span>(<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,406" id="srcline406">406</a></span><span class="line">                            <span class="mxinfo " id="T3:U1635"><span class="mxinfo " id="T34:U1636"><span class="var type1" id="S3T2U2266">alloc_out</span>(<span class="var type1" id="S45T3U2267">i</span>)</span>.phi</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,407" id="srcline407">407</a></span><span class="line">                            <span class="mxinfo " id="T3:U1639"><span class="mxinfo " id="T26:U1640"><span class="var type1" id="S4T4U2271">thruster_data</span>(<span class="var type1" id="S45T3U2272">i</span>)</span>.phi_reserve</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,408" id="srcline408">408</a></span><span class="line">                            <span class="mxinfo " id="T3:U1643"><span class="mxinfo " id="T26:U1644"><span class="var type1" id="S4T4U2276">thruster_data</span>(<span class="var type1" id="S45T3U2277">i</span>)</span>.dphi_max</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,409" id="srcline409">409</a></span><span class="line">                            <span class="var type1" id="S36T3U2279">dt</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,410" id="srcline410">410</a></span><span class="line">                            <span class="mxinfo " id="T3:U1648"><span class="mxinfo " id="T26:U1649"><span class="var type1" id="S4T4U2282">thruster_data</span>(<span class="var type1" id="S45T3U2283">i</span>)</span>.phi_min</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,411" id="srcline411">411</a></span><span class="line">                            <span class="mxinfo " id="T3:U1652"><span class="mxinfo " id="T26:U1653"><span class="var type1" id="S4T4U2287">thruster_data</span>(<span class="var type1" id="S45T3U2288">i</span>)</span>.phi_max</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,412" id="srcline412">412</a></span><span class="line">                        <span class="mxinfo " id="T3:U1656"><span class="mxinfo " id="T3:U1657"><span class="var type1" id="S18T12U2293">on_border</span>(<span class="var type1" id="S45T3U2294">i</span>)</span> = <span class="mxinfo " id="T3:U1660"><span class="var type1" id="S39T12U2296">inside_fz</span>(<span class="var type1" id="S45T3U2297">i</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,413" id="srcline413">413</a></span><span class="line">                        <span class="keyword">if</span> <span class="mxinfo " id="T7:U1663"><span class="mxinfo " id="T3:U1664"><span class="var type1" id="S39T12U2302">inside_fz</span>(<span class="var type1" id="S45T3U2303">i</span>)</span> == <span class="mxinfo " id="T3:U1667">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,414" id="srcline414">414</a></span><span class="line">                            <span class="mxinfo " id="T3:U1668"><span class="mxinfo " id="T3:U1669"><span class="var type1" id="S19T12U2308">phi_guider_old</span>(<span class="var type1" id="S45T3U2309">i</span>)</span> = <span class="mxinfo " id="T3:U1672"><span class="mxinfo " id="T34:U1673"><span class="var type1" id="S3T2U2312">alloc_out</span>(<span class="var type1" id="S45T3U2313">i</span>)</span>.phi</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,415" id="srcline415">415</a></span><span class="line">                            <span class="keyword">if</span> <span class="mxinfo " id="T7:U1676"><span class="var type1" id="S45T3U2318">i</span> == <span class="mxinfo " id="T3:U1678">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,416" id="srcline416">416</a></span><span class="line">                                <span class="message error" id="M1F1C">save(<span class="mxinfo " id="T35:U1679"><span class="string">'phi_guider_old.txt'</span></span>,<span class="mxinfo " id="T36:U1680"><span class="string">'phi_guider_old'</span></span>,<span class="mxinfo " id="T30:U1681"><span class="string">'-ASCII'</span></span>,<span class="mxinfo " id="T37:U1682"><span class="string">'-append'</span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,417" id="srcline417">417</a></span><span class="line">                            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,418" id="srcline418">418</a></span><span class="line">                        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,419" id="srcline419">419</a></span><span class="line">                        <span class="keyword">if</span> <span class="mxinfo " id="T7:U1683"><span class="mxinfo " id="T3:U1684"><span class="var type1" id="S39T12U2331">inside_fz</span>(<span class="var type1" id="S45T3U2332">i</span>)</span> == <span class="mxinfo " id="T3:U1687">0</span></span><span class="comment">%phi is outside forbidden zone</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,420" id="srcline420">420</a></span><span class="line">                            [<span class="mxinfo " id="T3:U1688"><span class="mxinfo " id="T26:U1689"><span class="var type1" id="S4T4U2339">thruster_data</span>(<span class="var type1" id="S45T3U2340">i</span>)</span>.phi_</span>,<span class="mxinfo " id="T3:U1692"><span class="mxinfo " id="T26:U1693"><span class="var type1" id="S4T4U2344">thruster_data</span>(<span class="var type1" id="S45T3U2345">i</span>)</span>.phiPlus</span>]= <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,421" id="srcline421">421</a></span><span class="line">                                <span class="fcn" id="F293N7:B2348">angleMaxMin</span>(<span class="mxinfo " id="T3:U1696"><span class="mxinfo " id="T26:U1697"><span class="var type1" id="S4T4U2351">thruster_data</span>(<span class="var type1" id="S45T3U2352">i</span>)</span>.phi_min</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,422" id="srcline422">422</a></span><span class="line">                                <span class="mxinfo " id="T3:U1700"><span class="mxinfo " id="T26:U1701"><span class="var type1" id="S4T4U2356">thruster_data</span>(<span class="var type1" id="S45T3U2357">i</span>)</span>.phi_max</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,423" id="srcline423">423</a></span><span class="line">                                <span class="mxinfo " id="T3:U1704"><span class="mxinfo " id="T26:U1705"><span class="var type1" id="S4T4U2361">thruster_data</span>(<span class="var type1" id="S45T3U2362">i</span>)</span>.phi_reserve</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,424" id="srcline424">424</a></span><span class="line">                                <span class="mxinfo " id="T3:U1708"><span class="var type1" id="S37T12U2365">phi_0</span>(<span class="var type1" id="S45T3U2366">i</span>)</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,425" id="srcline425">425</a></span><span class="line">                                <span class="mxinfo " id="T3:U1711"><span class="var type1" id="S38T12U2368">phiPlus0</span>(<span class="var type1" id="S45T3U2369">i</span>)</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,426" id="srcline426">426</a></span><span class="line">                            <span class="mxinfo " id="T3:U1714"><span class="mxinfo " id="T3:U1715"><span class="mxinfo " id="T26:U1716"><span class="var type1" id="S4T4U2374">thruster_data</span>(<span class="var type1" id="S45T3U2375">i</span>)</span>.T_</span> = <span class="mxinfo " id="T3:U1719">max(<span class="mxinfo " id="T3:U1720"><span class="mxinfo " id="T3:U1721"><span class="mxinfo " id="T26:U1722"><span class="var type1" id="S4T4U2382">thruster_data</span>(<span class="var type1" id="S45T3U2383">i</span>)</span>.T_reserve</span> - <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,427" id="srcline427">427</a></span><span class="line">                                <span class="mxinfo " id="T3:U1725"><span class="var type1" id="S36T3U2386">dt</span> * <span class="mxinfo " id="T3:U1727"><span class="mxinfo " id="T26:U1728"><span class="var type1" id="S4T4U2389">thruster_data</span>(<span class="var type1" id="S45T3U2390">i</span>)</span>.dTmax</span></span></span>, <span class="mxinfo " id="T3:U1731"><span class="mxinfo " id="T26:U1732"><span class="var type1" id="S4T4U2394">thruster_data</span>(<span class="var type1" id="S45T3U2395">i</span>)</span>.Tmin</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,428" id="srcline428">428</a></span><span class="line">                            <span class="mxinfo " id="T3:U1735"><span class="mxinfo " id="T3:U1736"><span class="mxinfo " id="T26:U1737"><span class="var type1" id="S4T4U2401">thruster_data</span>(<span class="var type1" id="S45T3U2402">i</span>)</span>.Tplus</span> = <span class="mxinfo " id="T3:U1740">min(<span class="mxinfo " id="T3:U1741"><span class="mxinfo " id="T3:U1742"><span class="mxinfo " id="T26:U1743"><span class="var type1" id="S4T4U2409">thruster_data</span>(<span class="var type1" id="S45T3U2410">i</span>)</span>.T_reserve</span> + <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,429" id="srcline429">429</a></span><span class="line">                                <span class="mxinfo " id="T3:U1746"><span class="var type1" id="S36T3U2413">dt</span> * <span class="mxinfo " id="T3:U1748"><span class="mxinfo " id="T26:U1749"><span class="var type1" id="S4T4U2416">thruster_data</span>(<span class="var type1" id="S45T3U2417">i</span>)</span>.dTmax</span></span></span>, <span class="mxinfo " id="T3:U1752"><span class="mxinfo " id="T26:U1753"><span class="var type1" id="S4T4U2421">thruster_data</span>(<span class="var type1" id="S45T3U2422">i</span>)</span>.Tmax</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,430" id="srcline430">430</a></span><span class="line">                        <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,431" id="srcline431">431</a></span><span class="line">                            <span class="mxinfo " id="T3:U1756"><span class="mxinfo " id="T3:U1757"><span class="mxinfo " id="T26:U1758"><span class="var type1" id="S4T4U2429">thruster_data</span>(<span class="var type1" id="S45T3U2430">i</span>)</span>.phi_</span> = <span class="mxinfo " id="T3:U1761"><span class="var type1" id="S37T12U2433">phi_0</span>(<span class="var type1" id="S45T3U2434">i</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,432" id="srcline432">432</a></span><span class="line">                            <span class="mxinfo " id="T3:U1764"><span class="mxinfo " id="T3:U1765"><span class="mxinfo " id="T26:U1766"><span class="var type1" id="S4T4U2439">thruster_data</span>(<span class="var type1" id="S45T3U2440">i</span>)</span>.phiPlus</span> = <span class="mxinfo " id="T3:U1769"><span class="var type1" id="S38T12U2443">phiPlus0</span>(<span class="var type1" id="S45T3U2444">i</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,433" id="srcline433">433</a></span><span class="line">                            <span class="mxinfo " id="T3:U1772"><span class="mxinfo " id="T3:U1773"><span class="mxinfo " id="T26:U1774"><span class="var type1" id="S4T4U2449">thruster_data</span>(<span class="var type1" id="S45T3U2450">i</span>)</span>.T_</span> = <span class="mxinfo " id="T3:U1777"><span class="mxinfo " id="T26:U1778"><span class="var type1" id="S4T4U2454">thruster_data</span>(<span class="var type1" id="S45T3U2455">i</span>)</span>.Tmin</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,434" id="srcline434">434</a></span><span class="line">                            <span class="mxinfo " id="T3:U1781"><span class="mxinfo " id="T3:U1782"><span class="mxinfo " id="T26:U1783"><span class="var type1" id="S4T4U2461">thruster_data</span>(<span class="var type1" id="S45T3U2462">i</span>)</span>.Tplus</span> = <span class="mxinfo " id="T3:U1786"><span class="mxinfo " id="T3:U1787"><span class="mxinfo " id="T26:U1788"><span class="var type1" id="S4T4U2467">thruster_data</span>(<span class="var type1" id="S45T3U2468">i</span>)</span>.Tmin</span> + <span class="mxinfo " id="T3:U1791">10</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,435" id="srcline435">435</a></span><span class="line">                            </span></span>
<span class="srcline"><span class="lineno"><a href="1,436" id="srcline436">436</a></span><span class="line">                        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,437" id="srcline437">437</a></span><span class="line">                        <span class="mxinfo " id="T3:U1792"><span class="mxinfo " id="T3:U1793"><span class="mxinfo " id="T26:U1794"><span class="var type1" id="S4T4U2475">thruster_data</span>(<span class="var type1" id="S45T3U2476">i</span>)</span>.phi</span> = <span class="mxinfo " id="T3:U1797"><span class="mxinfo " id="T3:U1798"><span class="mxinfo " id="T26:U1799"><span class="var type1" id="S4T4U2481">thruster_data</span>(<span class="var type1" id="S45T3U2482">i</span>)</span>.phi_</span> <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,438" id="srcline438">438</a></span><span class="line">                            + <span class="mxinfo " id="T3:U1802"><span class="mxinfo " id="T3:U1803"><span class="fcn" id="F300N8:B2486">angle_dist</span>(<span class="mxinfo " id="T3:U1804"><span class="mxinfo " id="T26:U1805"><span class="var type1" id="S4T4U2489">thruster_data</span>(<span class="var type1" id="S45T3U2490">i</span>)</span>.phi_</span>,<span class="mxinfo " id="T3:U1808"><span class="mxinfo " id="T26:U1809"><span class="var type1" id="S4T4U2494">thruster_data</span>(<span class="var type1" id="S45T3U2495">i</span>)</span>.phiPlus</span>)</span> / <span class="mxinfo " id="T3:U1812">2</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,439" id="srcline439">439</a></span><span class="line">                        </span></span>
<span class="srcline"><span class="lineno"><a href="1,440" id="srcline440">440</a></span><span class="line">                        <span class="mxinfo " id="T3:U1813"><span class="mxinfo " id="T3:U1814"><span class="mxinfo " id="T26:U1815"><span class="var type1" id="S4T4U2502">thruster_data</span>(<span class="var type1" id="S45T3U2503">i</span>)</span>.T</span> = <span class="mxinfo " id="T3:U1818"><span class="mxinfo " id="T26:U1819"><span class="var type1" id="S4T4U2507">thruster_data</span>(<span class="var type1" id="S45T3U2508">i</span>)</span>.T_reserve</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,441" id="srcline441">441</a></span><span class="line">                        </span></span>
<span class="srcline"><span class="lineno"><a href="1,442" id="srcline442">442</a></span><span class="line">                        </span></span>
<span class="srcline"><span class="lineno"><a href="1,443" id="srcline443">443</a></span><span class="line"><span class="comment">%                         if abs(thruster_data(i).phi_max - thruster_data(i).phi_min)&gt; FeasibilityTol%means there is forbidden zone</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,444" id="srcline444">444</a></span><span class="line"><span class="comment">%                         </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,445" id="srcline445">445</a></span><span class="line"><span class="comment">%                            if min([angle_dist(alloc_out(i).phi,thruster_data(i).phi_min)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,446" id="srcline446">446</a></span><span class="line"><span class="comment">%                                    angle_dist(thruster_data(i).phi_min,alloc_out(i).phi)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,447" id="srcline447">447</a></span><span class="line"><span class="comment">%                                    angle_dist(alloc_out(i).phi,thruster_data(i).phi_max)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,448" id="srcline448">448</a></span><span class="line"><span class="comment">%                                    angle_dist(thruster_data(i).phi_max,alloc_out(i).phi)]) <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,449" id="srcline449">449</a></span><span class="line"><span class="comment">%                                    &lt;= FeasibilityTol</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,450" id="srcline450">450</a></span><span class="line"><span class="comment">%                                on_border(i) = 1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,451" id="srcline451">451</a></span><span class="line"><span class="comment">%                            else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,452" id="srcline452">452</a></span><span class="line"><span class="comment">%                                on_border(i) = 0;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,453" id="srcline453">453</a></span><span class="line"><span class="comment">%                            end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,454" id="srcline454">454</a></span><span class="line"><span class="comment">%                            </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,455" id="srcline455">455</a></span><span class="line"><span class="comment">%                         </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,456" id="srcline456">456</a></span><span class="line"><span class="comment">%                         end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,457" id="srcline457">457</a></span><span class="line">                        </span></span>
<span class="srcline"><span class="lineno"><a href="1,458" id="srcline458">458</a></span><span class="line">                        </span></span>
<span class="srcline"><span class="lineno"><a href="1,459" id="srcline459">459</a></span><span class="line">                    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,460" id="srcline460">460</a></span><span class="line">                        <span class="mxinfo " id="T3:U1822"><span class="mxinfo " id="T3:U1823"><span class="mxinfo " id="T26:U1824"><span class="var type1" id="S4T4U2515">thruster_data</span>(<span class="var type1" id="S45T3U2516">i</span>)</span>.phi</span> = <span class="mxinfo " id="T3:U1827"><span class="mxinfo " id="T26:U1828"><span class="var type1" id="S4T4U2520">thruster_data</span>(<span class="var type1" id="S45T3U2521">i</span>)</span>.phi_reserve</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,461" id="srcline461">461</a></span><span class="line">                        <span class="mxinfo " id="T3:U1831"><span class="mxinfo " id="T3:U1832"><span class="mxinfo " id="T26:U1833"><span class="var type1" id="S4T4U2527">thruster_data</span>(<span class="var type1" id="S45T3U2528">i</span>)</span>.T</span> = <span class="mxinfo " id="T3:U1836"><span class="mxinfo " id="T26:U1837"><span class="var type1" id="S4T4U2532">thruster_data</span>(<span class="var type1" id="S45T3U2533">i</span>)</span>.T_reserve</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,462" id="srcline462">462</a></span><span class="line">                    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,463" id="srcline463">463</a></span><span class="line">                    </span></span>
<span class="srcline"><span class="lineno"><a href="1,464" id="srcline464">464</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,465" id="srcline465">465</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,466" id="srcline466">466</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,467" id="srcline467">467</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,468" id="srcline468">468</a></span><span class="line">        <span class="keyword">else</span>  <span class="comment">%if step == 2</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,469" id="srcline469">469</a></span><span class="line">            <span class="keyword">for</span> <span class="var type1" id="S45T3U2538">i</span>=<span class="mxinfo " id="T1:U1841"><span class="mxinfo " id="T3:U1842">1</span>:<span class="var type1" id="S8T3U2541">N_enabled_thruster</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,470" id="srcline470">470</a></span><span class="line">                <span class="mxinfo " id="T3:U1844"><span class="mxinfo " id="T3:U1845"><span class="mxinfo " id="T26:U1846"><span class="var type1" id="S4T4U2546">thruster_data</span>(<span class="var type1" id="S45T3U2547">i</span>)</span>.phi_reserve</span> = <span class="mxinfo " id="T3:U1849"><span class="mxinfo " id="T34:U1850"><span class="var type1" id="S3T2U2551">alloc_out</span>(<span class="var type1" id="S45T3U2552">i</span>)</span>.phi</span></span>;<span class="comment">%previous phi</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,471" id="srcline471">471</a></span><span class="line">                <span class="mxinfo " id="T3:U1853"><span class="mxinfo " id="T3:U1854"><span class="mxinfo " id="T26:U1855"><span class="var type1" id="S4T4U2558">thruster_data</span>(<span class="var type1" id="S45T3U2559">i</span>)</span>.T_reserve</span> = <span class="mxinfo " id="T3:U1858"><span class="mxinfo " id="T34:U1859"><span class="var type1" id="S3T2U2563">alloc_out</span>(<span class="var type1" id="S45T3U2564">i</span>)</span>.T</span></span>;<span class="comment">%previous T</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,472" id="srcline472">472</a></span><span class="line">                <span class="mxinfo " id="T3:U1862"><span class="mxinfo " id="T3:U1863"><span class="mxinfo " id="T26:U1864"><span class="var type1" id="S4T4U2570">thruster_data</span>(<span class="var type1" id="S45T3U2571">i</span>)</span>.phi</span> = <span class="mxinfo " id="T3:U1867"><span class="mxinfo " id="T34:U1868"><span class="var type1" id="S3T2U2575">alloc_out</span>(<span class="var type1" id="S45T3U2576">i</span>)</span>.phi</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,473" id="srcline473">473</a></span><span class="line">                <span class="mxinfo " id="T3:U1871"><span class="mxinfo " id="T3:U1872"><span class="mxinfo " id="T26:U1873"><span class="var type1" id="S4T4U2582">thruster_data</span>(<span class="var type1" id="S45T3U2583">i</span>)</span>.T</span> = <span class="mxinfo " id="T3:U1876"><span class="mxinfo " id="T34:U1877"><span class="var type1" id="S3T2U2587">alloc_out</span>(<span class="var type1" id="S45T3U2588">i</span>)</span>.T</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,474" id="srcline474">474</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,475" id="srcline475">475</a></span><span class="line">            <span class="mxinfo " id="T7:U1880"><span class="var type1" id="S48T7U2592">run</span> = <span class="mxinfo " id="T7:U1882">false</span></span>;<span class="comment">%break the while loop</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,476" id="srcline476">476</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,477" id="srcline477">477</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,478" id="srcline478">478</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,479" id="srcline479">479</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,480" id="srcline480">480</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,481" id="srcline481">481</a></span><span class="line"><span class="comment">% status</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,482" id="srcline482">482</a></span><span class="line"><span class="comment">% chck_sol = [[thruster_data(:).phi_min]' [thruster_data(:).phi_]' [alloc_out.phi]' [thruster_data.phiPlus]' [thruster_data(:).phi_max]'];</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,483" id="srcline483">483</a></span><span class="line"><span class="comment">% check_angle(chck_sol(:,1),chck_sol(:,2),chck_sol(:,3),chck_sol(:,4),chck_sol(:,5))</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,484" id="srcline484">484</a></span><span class="line"><span class="comment">% solution</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,485" id="srcline485">485</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,486" id="srcline486">486</a></span><span class="line"></span></span>
</pre>
<div class="dead">
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,487" id="srcline487">487</a></span><span class="line">function [T,new,in_fb] = baseThrust(T,phi,T_base,phi_base,phi_min,phi_max)</span></span>
<span class="srcline"><span class="lineno"><a href="1,488" id="srcline488">488</a></span><span class="line">tol = 1e-6;</span></span>
<span class="srcline"><span class="lineno"><a href="1,489" id="srcline489">489</a></span><span class="line">x = T * cos(phi) + T_base * cos(phi_base);</span></span>
<span class="srcline"><span class="lineno"><a href="1,490" id="srcline490">490</a></span><span class="line">y = T * sin(phi) + T_base * sin(phi_base);</span></span>
<span class="srcline"><span class="lineno"><a href="1,491" id="srcline491">491</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,492" id="srcline492">492</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,493" id="srcline493">493</a></span><span class="line">T = norm([x y]);</span></span>
<span class="srcline"><span class="lineno"><a href="1,494" id="srcline494">494</a></span><span class="line">new = atan2(y,x);</span></span>
<span class="srcline"><span class="lineno"><a href="1,495" id="srcline495">495</a></span><span class="line">in_fb = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="1,496" id="srcline496">496</a></span><span class="line">if abs(phi_max - phi_min)&gt; tol<span class="comment">%means there is forbidden zone</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,497" id="srcline497">497</a></span><span class="line">if angle_dist(phi_min,new) &gt; angle_dist(phi_min,phi_max) <span class="comment">%inside fbzone</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,498" id="srcline498">498</a></span><span class="line">    in_fb = 1;</span></span>
<span class="srcline"><span class="lineno"><a href="1,499" id="srcline499">499</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="1,500" id="srcline500">500</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="1,501" id="srcline501">501</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="1,502" id="srcline502">502</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,503" id="srcline503">503</a></span><span class="line">function [phi_0,phiPlus0,inside_fz] = angle_point_to(s,phi,dphi_max,dt,phi_min,phi_max)</span></span>
<span class="srcline"><span class="lineno"><a href="1,504" id="srcline504">504</a></span><span class="line">tol = 1e-6;</span></span>
<span class="srcline"><span class="lineno"><a href="1,505" id="srcline505">505</a></span><span class="line"><span class="comment">%s: setpoint from global solution</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,506" id="srcline506">506</a></span><span class="line">inside_fz = 0;<span class="comment">%phi, phi_0 and phiPlus0 is outside forbidden zone</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,507" id="srcline507">507</a></span><span class="line">if min(angle_dist(phi,s),angle_dist(s,phi)) &gt; dphi_max * dt</span></span>
<span class="srcline"><span class="lineno"><a href="1,508" id="srcline508">508</a></span><span class="line">    move = dphi_max * dt / 2;</span></span>
<span class="srcline"><span class="lineno"><a href="1,509" id="srcline509">509</a></span><span class="line">else</span></span>
<span class="srcline"><span class="lineno"><a href="1,510" id="srcline510">510</a></span><span class="line">    move = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="1,511" id="srcline511">511</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="1,512" id="srcline512">512</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,513" id="srcline513">513</a></span><span class="line"><span class="comment">% find out if phi, phi_0 or phiPlus0 is inside fb zone</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,514" id="srcline514">514</a></span><span class="line">if angle_dist(phi,s) &lt; pi</span></span>
<span class="srcline"><span class="lineno"><a href="1,515" id="srcline515">515</a></span><span class="line">    phi_0 = phi + move;</span></span>
<span class="srcline"><span class="lineno"><a href="1,516" id="srcline516">516</a></span><span class="line">    phiPlus0 = phi + dphi_max * dt;</span></span>
<span class="srcline"><span class="lineno"><a href="1,517" id="srcline517">517</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,518" id="srcline518">518</a></span><span class="line">else</span></span>
<span class="srcline"><span class="lineno"><a href="1,519" id="srcline519">519</a></span><span class="line">    phiPlus0 = phi - move;</span></span>
<span class="srcline"><span class="lineno"><a href="1,520" id="srcline520">520</a></span><span class="line">    phi_0 = phi - dphi_max * dt;</span></span>
<span class="srcline"><span class="lineno"><a href="1,521" id="srcline521">521</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="1,522" id="srcline522">522</a></span><span class="line">if abs(phi_max - phi_min)&gt; tol<span class="comment">%means there is forbidden zone</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,523" id="srcline523">523</a></span><span class="line">if angle_dist(phi_min,phi) &gt;= angle_dist(phi_min,phi_max) ...</span></span>
<span class="srcline"><span class="lineno"><a href="1,524" id="srcline524">524</a></span><span class="line">        || angle_dist(phi_min,phi_0) &gt;= angle_dist(phi_min,phi_max) ...</span></span>
<span class="srcline"><span class="lineno"><a href="1,525" id="srcline525">525</a></span><span class="line">        || angle_dist(phi_min,phiPlus0) &gt;= angle_dist(phi_min,phi_max)</span></span>
<span class="srcline"><span class="lineno"><a href="1,526" id="srcline526">526</a></span><span class="line">    inside_fz = 1;<span class="comment">%phi, phi_0 or phiPlus0 is inside forbidden zone</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,527" id="srcline527">527</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="1,528" id="srcline528">528</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="1,529" id="srcline529">529</a></span><span class="line"><span class="comment">% % % % % % % % %</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,530" id="srcline530">530</a></span><span class="line">if abs(phi_max - phi_min)&gt; tol<span class="comment">%means there is forbidden zone</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,531" id="srcline531">531</a></span><span class="line">    if inside_fz == 0 <span class="comment">%phi is outside forbidden zone</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,532" id="srcline532">532</a></span><span class="line">        if angle_dist(phi,s) &lt; pi</span></span>
<span class="srcline"><span class="lineno"><a href="1,533" id="srcline533">533</a></span><span class="line">            phi_0 = phi + move;</span></span>
<span class="srcline"><span class="lineno"><a href="1,534" id="srcline534">534</a></span><span class="line">            phiPlus0 = phi + dphi_max * dt;</span></span>
<span class="srcline"><span class="lineno"><a href="1,535" id="srcline535">535</a></span><span class="line">        else</span></span>
<span class="srcline"><span class="lineno"><a href="1,536" id="srcline536">536</a></span><span class="line">            phiPlus0 = phi - move;</span></span>
<span class="srcline"><span class="lineno"><a href="1,537" id="srcline537">537</a></span><span class="line">            phi_0 = phi - dphi_max * dt;</span></span>
<span class="srcline"><span class="lineno"><a href="1,538" id="srcline538">538</a></span><span class="line">        end</span></span>
<span class="srcline"><span class="lineno"><a href="1,539" id="srcline539">539</a></span><span class="line">    else<span class="comment">%phi is inside forbidden zone</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,540" id="srcline540">540</a></span><span class="line">        if angle_dist(phi_min,s) &lt;= angle_dist(phi_min,phi_max)<span class="comment">%s is outside forbidden zone</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,541" id="srcline541">541</a></span><span class="line">            if angle_dist(phi,s) &lt; pi</span></span>
<span class="srcline"><span class="lineno"><a href="1,542" id="srcline542">542</a></span><span class="line">                phi_0 = phi + move;</span></span>
<span class="srcline"><span class="lineno"><a href="1,543" id="srcline543">543</a></span><span class="line">                phiPlus0 = phi + dphi_max * dt;</span></span>
<span class="srcline"><span class="lineno"><a href="1,544" id="srcline544">544</a></span><span class="line">            else</span></span>
<span class="srcline"><span class="lineno"><a href="1,545" id="srcline545">545</a></span><span class="line">                phiPlus0 = phi - move;</span></span>
<span class="srcline"><span class="lineno"><a href="1,546" id="srcline546">546</a></span><span class="line">                phi_0 = phi - dphi_max * dt;</span></span>
<span class="srcline"><span class="lineno"><a href="1,547" id="srcline547">547</a></span><span class="line">            end</span></span>
<span class="srcline"><span class="lineno"><a href="1,548" id="srcline548">548</a></span><span class="line">        else<span class="comment">% s is inside forbidden zone</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,549" id="srcline549">549</a></span><span class="line">            if angle_dist(phi_max,phi) &lt; angle_dist(phi,phi_min) <span class="comment">%phi is closer to phi_max</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,550" id="srcline550">550</a></span><span class="line">                phiPlus0 = phi - dphi_max * dt / 2;</span></span>
<span class="srcline"><span class="lineno"><a href="1,551" id="srcline551">551</a></span><span class="line">                phi_0 = phi - dphi_max * dt;</span></span>
<span class="srcline"><span class="lineno"><a href="1,552" id="srcline552">552</a></span><span class="line">            else<span class="comment">%phi is closer to phi_min</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,553" id="srcline553">553</a></span><span class="line">                phi_0 = phi + dphi_max * dt / 2;</span></span>
<span class="srcline"><span class="lineno"><a href="1,554" id="srcline554">554</a></span><span class="line">                phiPlus0 = phi + dphi_max * dt;</span></span>
<span class="srcline"><span class="lineno"><a href="1,555" id="srcline555">555</a></span><span class="line">            end</span></span>
<span class="srcline"><span class="lineno"><a href="1,556" id="srcline556">556</a></span><span class="line">        end</span></span>
<span class="srcline"><span class="lineno"><a href="1,557" id="srcline557">557</a></span><span class="line">    end</span></span>
<span class="srcline"><span class="lineno"><a href="1,558" id="srcline558">558</a></span><span class="line">else<span class="comment">%there is no forbidden zone</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,559" id="srcline559">559</a></span><span class="line">    if angle_dist(phi,s) &lt; pi</span></span>
<span class="srcline"><span class="lineno"><a href="1,560" id="srcline560">560</a></span><span class="line">        phi_0 = phi + move;</span></span>
<span class="srcline"><span class="lineno"><a href="1,561" id="srcline561">561</a></span><span class="line">        phiPlus0 = phi + dphi_max * dt;</span></span>
<span class="srcline"><span class="lineno"><a href="1,562" id="srcline562">562</a></span><span class="line">    else</span></span>
<span class="srcline"><span class="lineno"><a href="1,563" id="srcline563">563</a></span><span class="line">        phiPlus0 = phi - move;</span></span>
<span class="srcline"><span class="lineno"><a href="1,564" id="srcline564">564</a></span><span class="line">        phi_0 = phi - dphi_max * dt;</span></span>
<span class="srcline"><span class="lineno"><a href="1,565" id="srcline565">565</a></span><span class="line">    end</span></span>
<span class="srcline"><span class="lineno"><a href="1,566" id="srcline566">566</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="1,567" id="srcline567">567</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="1,568" id="srcline568">568</a></span><span class="line"> </span></span>
</pre>
</div>
