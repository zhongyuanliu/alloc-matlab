<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="86,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T4U3">thruster_data</span>,<span class="var type1" id="S3T3U4">Nvar</span>,<span class="var type1" id="S4T28U5">Ho</span>,<span class="var type1" id="S5T1U6">fo</span>,<span class="var type1" id="S6T28U7">Ao</span>,<span class="var type1" id="S7T1U8">bo</span>,<span class="var type1" id="S8T28U9">Aeqo</span>,<span class="var type1" id="S9T1U10">beqo</span>,<span class="var type1" id="S10T1U11">x0</span>] = pre_qp(<span class="var type1" id="S11T7U14">init</span>,<span class="var type1" id="S2T4U15">thruster_data</span>,<span class="var type1" id="S12T8U16">T_r</span>,<span class="var type1" id="S13T3U17">N_enabled_thruster</span>,<span class="var type1" id="S14T23U18">Ce</span>,<span class="var type2" id="S15T3V1U19">NA_fpp</span>,<span class="var type1" id="S16T10U20">rudder_table</span>,<span class="var type1" id="S17T11U21">Rangle_T</span>,<span class="var type1" id="S18T11U22">Rangle_Fangle</span>,<span class="var type1" id="S19T3U23">no_azi_angle_constr</span>,<span class="var type1" id="S20T3U24">method</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="86,2" id="srcline2">  2</a></span><span class="line"><span class="comment">%  1.04 thruster_data(i).phi is replaced by thruster_data(i).phi_min for tunnel thruster</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,3" id="srcline3">  3</a></span><span class="line"><span class="comment">%  1.06 guarantee initial x feasible</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,4" id="srcline4">  4</a></span><span class="line"><span class="comment">%  4.06 u is scaled. c_scale * Tmax^2 == 1 |13-03-2017 by Liu</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,5" id="srcline5">  5</a></span><span class="line"><span class="comment">%% ---------------precalculation------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,6" id="srcline6">  6</a></span><span class="line"><span class="keyword">persistent</span> <span class="var type1" id="S21T99U26">A_azi</span> <span class="var type1" id="S22T3U27">NA_azi</span> <span class="var type1" id="S23T100U28">A_fpp</span> <span class="var type1" id="S24T101U29">b_fpp</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,7" id="srcline7">  7</a></span><span class="line"><span class="mxinfo " id="T3:U25"><span class="var type1" id="S25T3U32">tol</span> = <span class="mxinfo " id="T3:U27">1e-6</span></span>;<span class="comment">%!!!avoid numerical problem</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,8" id="srcline8">  8</a></span><span class="line"><span class="mxinfo " id="T3:U28"><span class="var type1" id="S26T3U36">Ntunnel</span>=<span class="mxinfo " id="T3:U30">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,9" id="srcline9">  9</a></span><span class="line"><span class="mxinfo " id="T3:U31"><span class="var type1" id="S27T3U40">Nazi</span>=<span class="mxinfo " id="T3:U33">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,10" id="srcline10"> 10</a></span><span class="line"><span class="mxinfo " id="T3:U34"><span class="var type1" id="S28T3U44">Nfpp</span>=<span class="mxinfo " id="T3:U36">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,11" id="srcline11"> 11</a></span><span class="line"><span class="mxinfo " id="T3:U37"><span class="var type1" id="S29T3U48">dt</span> = <span class="mxinfo " id="T3:U39"><span class="mxinfo " id="T26:U40"><span class="var type1" id="S2T4U51">thruster_data</span>(<span class="mxinfo " id="T3:U42">1</span>)</span>.dt</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,12" id="srcline12"> 12</a></span><span class="line"><span class="mxinfo " id="T3:U43"><span class="var type1" id="S30T3U56">c2</span> = <span class="mxinfo " id="T3:U45"><span class="mxinfo " id="T3:U46">0.001</span>*<span class="mxinfo " id="T3:U47">0</span></span></span>;<span class="comment">%!!!!!!!!!!!!!!!!!!!!!!!!!!</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,13" id="srcline13"> 13</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="86,14" id="srcline14"> 14</a></span><span class="line"><span class="mxinfo " id="T3:U48"><span class="var type1" id="S31T3U62">error_linearization</span> = <span class="mxinfo " id="T3:U50">0.05</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,15" id="srcline15"> 15</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T7:U51">isempty(<span class="var type0" id="S21T0U70">A_azi</span>)</span> || <span class="mxinfo " id="T7:U52">isempty(<span class="var type0" id="S22T0U73">NA_azi</span>)</span> || <span class="mxinfo " id="T7:U53"><span class="var type1" id="S11T7U75">init</span> == <span class="mxinfo " id="T7:U55">true</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="86,16" id="srcline16"> 16</a></span><span class="line">    <span class="mxinfo " id="T99:U56">[<span class="var type1" id="S21T99U81">A_azi</span>,<span class="var type1" id="S22T3U82">NA_azi</span>] = <span class="fcn" id="F261N15:B84">N_sided_linear</span>(<span class="var type1" id="S31T3U85">error_linearization</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,17" id="srcline17"> 17</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,18" id="srcline18"> 18</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="86,19" id="srcline19"> 19</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T7:U60">isempty(<span class="var type0" id="S23T0U92">A_fpp</span>)</span> || <span class="mxinfo " id="T7:U61">isempty(<span class="var type0" id="S24T0U95">b_fpp</span>)</span> || <span class="mxinfo " id="T7:U62"><span class="var type1" id="S11T7U97">init</span> == <span class="mxinfo " id="T7:U64">true</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="86,20" id="srcline20"> 20</a></span><span class="line">    <span class="mxinfo " id="T3:U65">[<span class="var type1" id="S23T100U103">A_fpp</span>,<span class="var type1" id="S24T101U104">b_fpp</span>,<span class="mxinfo " id="T3:U68">~</span>] = <span class="fcn" id="F276N16:B107">N_sided_rudder</span>(<span class="mxinfo " id="T102:U69"><span class="mxinfo " id="T3:U70">1e5</span> * <span class="mxinfo " id="T102:U71"><span class="var type1" id="S16T10U111">rudder_table</span>(<span class="mxinfo " id="T16:U73">:</span>,<span class="mxinfo " id="T18:U74">2:3</span>)</span></span>)</span>;<span class="comment">%%!!what if there is no fpp!!!!!!!!!!</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,21" id="srcline21"> 21</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,22" id="srcline22"> 22</a></span><span class="line"><span class="comment">% NA_azi = 0;%not used at the moment!!!!!!!!!!!!!!!!</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,23" id="srcline23"> 23</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="86,24" id="srcline24"> 24</a></span><span class="line"><span class="comment">% init = true;</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,25" id="srcline25"> 25</a></span><span class="line"><span class="mxinfo " id="T1:U75"><span class="var type1" id="S10T1U118">x0</span>=<span class="mxinfo " id="T1:U77">zeros(<span class="mxinfo " id="T3:U78"><span class="mxinfo " id="T3:U79"><span class="var type1" id="S13T3U123">N_enabled_thruster</span> * <span class="mxinfo " id="T3:U81">2</span></span> + <span class="mxinfo " id="T3:U82">3</span></span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,26" id="srcline26"> 26</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="86,27" id="srcline27"> 27</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S37T3U129">j</span>=<span class="mxinfo " id="T1:U84"><span class="mxinfo " id="T3:U85">1</span>:<span class="var type1" id="S13T3U132">N_enabled_thruster</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="86,28" id="srcline28"> 28</a></span><span class="line"><span class="comment">%     check if phi meets constraint, if check_phi == 0, phi is not between</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,29" id="srcline29"> 29</a></span><span class="line"><span class="comment">%     max and min, then it should be changed. VERY IMPORTANT</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,30" id="srcline30"> 30</a></span><span class="line"><span class="comment">%     check_phi = check_angle(thruster_data(j).phi_min,thruster_data(j).phi_min, <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="86,31" id="srcline31"> 31</a></span><span class="line"><span class="comment">%         thruster_data(j).phi,thruster_data(j).phi_max,thruster_data(j).phi_max);</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,32" id="srcline32"> 32</a></span><span class="line"><span class="comment">%     </span></span></span>
<span class="srcline"><span class="lineno"><a href="86,33" id="srcline33"> 33</a></span><span class="line"><span class="comment">%     if check_phi == 0 % guarantee initial phi feasible</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,34" id="srcline34"> 34</a></span><span class="line"><span class="comment">%         thruster_data(j).phi = <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="86,35" id="srcline35"> 35</a></span><span class="line"><span class="comment">%             thruster_data(j).phi_min + <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="86,36" id="srcline36"> 36</a></span><span class="line"><span class="comment">%             angle_dist(thruster_data(j).phi_min, thruster_data(j).phi_max) / 2;</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,37" id="srcline37"> 37</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="86,38" id="srcline38"> 38</a></span><span class="line"><span class="comment">%         thruster_data(j).phi = Pi_toPi(thruster_data(j).phi);</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,39" id="srcline39"> 39</a></span><span class="line"><span class="comment">%     end</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,40" id="srcline40"> 40</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="86,41" id="srcline41"> 41</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo " id="T7:U87"><span class="mxinfo " id="T3:U88"><span class="mxinfo " id="T26:U89"><span class="var type1" id="S2T4U138">thruster_data</span>(<span class="var type1" id="S37T3U139">j</span>)</span>.type</span> == <span class="mxinfo " id="T3:U92">4</span></span><span class="comment">%added, avoid tunnel infeasible angle input, v1.07</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,42" id="srcline42"> 42</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo " id="T7:U93"><span class="mxinfo " id="T3:U94">abs(<span class="mxinfo " id="T3:U95"><span class="mxinfo " id="T3:U96"><span class="mxinfo " id="T26:U97"><span class="var type1" id="S2T4U150">thruster_data</span>(<span class="var type1" id="S37T3U151">j</span>)</span>.phi_min</span> - <span class="mxinfo " id="T3:U100"><span class="mxinfo " id="T26:U101"><span class="var type1" id="S2T4U155">thruster_data</span>(<span class="var type1" id="S37T3U156">j</span>)</span>.phi</span></span>)</span> &gt; <span class="var type1" id="S25T3U158">tol</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="86,43" id="srcline43"> 43</a></span><span class="line">            <span class="mxinfo " id="T3:U105"><span class="mxinfo " id="T3:U106"><span class="mxinfo " id="T26:U107"><span class="var type1" id="S2T4U163">thruster_data</span>(<span class="var type1" id="S37T3U164">j</span>)</span>.phi</span> = <span class="mxinfo " id="T3:U110"><span class="mxinfo " id="T26:U111"><span class="var type1" id="S2T4U168">thruster_data</span>(<span class="var type1" id="S37T3U169">j</span>)</span>.phi_min</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,44" id="srcline44"> 44</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,45" id="srcline45"> 45</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="86,46" id="srcline46"> 46</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,47" id="srcline47"> 47</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="86,48" id="srcline48"> 48</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo " id="T7:U114"><span class="mxinfo " id="T3:U115">abs(<span class="mxinfo " id="T3:U116"><span class="mxinfo " id="T3:U117"><span class="mxinfo " id="T26:U118"><span class="var type1" id="S2T4U179">thruster_data</span>(<span class="var type1" id="S37T3U180">j</span>)</span>.Tmax</span> - <span class="mxinfo " id="T3:U121"><span class="mxinfo " id="T26:U122"><span class="var type1" id="S2T4U184">thruster_data</span>(<span class="var type1" id="S37T3U185">j</span>)</span>.Tmin</span></span>)</span> &lt; <span class="var type1" id="S25T3U187">tol</span></span><span class="comment">%avoid Tmax == Tmin</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,49" id="srcline49"> 49</a></span><span class="line">        <span class="mxinfo " id="T3:U126"><span class="mxinfo " id="T3:U127"><span class="mxinfo " id="T26:U128"><span class="var type1" id="S2T4U192">thruster_data</span>(<span class="var type1" id="S37T3U193">j</span>)</span>.Tmax</span> = <span class="mxinfo " id="T3:U131">1e7</span></span>;<span class="comment">%big enough</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,50" id="srcline50"> 50</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo " id="T7:U132"><span class="mxinfo " id="T3:U133"><span class="mxinfo " id="T26:U134"><span class="var type1" id="S2T4U201">thruster_data</span>(<span class="var type1" id="S37T3U202">j</span>)</span>.type</span> == <span class="mxinfo " id="T3:U137">4</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="86,51" id="srcline51"> 51</a></span><span class="line">            <span class="mxinfo " id="T3:U138"><span class="mxinfo " id="T3:U139"><span class="mxinfo " id="T26:U140"><span class="var type1" id="S2T4U209">thruster_data</span>(<span class="var type1" id="S37T3U210">j</span>)</span>.Tmin</span> = <span class="mxinfo " id="T3:U143">-<span class="mxinfo " id="T3:U144">1e7</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,52" id="srcline52"> 52</a></span><span class="line">        <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,53" id="srcline53"> 53</a></span><span class="line">            <span class="mxinfo " id="T3:U145"><span class="mxinfo " id="T3:U146"><span class="mxinfo " id="T26:U147"><span class="var type1" id="S2T4U219">thruster_data</span>(<span class="var type1" id="S37T3U220">j</span>)</span>.Tmin</span> = <span class="mxinfo " id="T3:U150">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,54" id="srcline54"> 54</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,55" id="srcline55"> 55</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="86,56" id="srcline56"> 56</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,57" id="srcline57"> 57</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="86,58" id="srcline58"> 58</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo " id="T7:U151"><span class="mxinfo " id="T3:U152"><span class="mxinfo " id="T26:U153"><span class="var type1" id="S2T4U229">thruster_data</span>(<span class="var type1" id="S37T3U230">j</span>)</span>.T</span> &gt; <span class="mxinfo " id="T3:U156"><span class="mxinfo " id="T26:U157"><span class="var type1" id="S2T4U234">thruster_data</span>(<span class="var type1" id="S37T3U235">j</span>)</span>.Tmax</span></span> <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,59" id="srcline59"> 59</a></span><span class="line">            || <span class="mxinfo " id="T7:U160"><span class="mxinfo " id="T3:U161"><span class="mxinfo " id="T26:U162"><span class="var type1" id="S2T4U240">thruster_data</span>(<span class="var type1" id="S37T3U241">j</span>)</span>.T</span> &lt; <span class="mxinfo " id="T3:U165"><span class="mxinfo " id="T26:U166"><span class="var type1" id="S2T4U245">thruster_data</span>(<span class="var type1" id="S37T3U246">j</span>)</span>.Tmin</span></span><span class="comment">% guarantee initial T feasible </span></span></span>
<span class="srcline"><span class="lineno"><a href="86,60" id="srcline60"> 60</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo " id="T7:U169"><span class="mxinfo " id="T3:U170"><span class="mxinfo " id="T26:U171"><span class="var type1" id="S2T4U253">thruster_data</span>(<span class="var type1" id="S37T3U254">j</span>)</span>.type</span> == <span class="mxinfo " id="T3:U174">4</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="86,61" id="srcline61"> 61</a></span><span class="line">            <span class="mxinfo " id="T3:U175"><span class="mxinfo " id="T3:U176"><span class="mxinfo " id="T26:U177"><span class="var type1" id="S2T4U261">thruster_data</span>(<span class="var type1" id="S37T3U262">j</span>)</span>.T</span> = <span class="mxinfo " id="T3:U180">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,62" id="srcline62"> 62</a></span><span class="line">        <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,63" id="srcline63"> 63</a></span><span class="line">            <span class="mxinfo " id="T3:U181"><span class="mxinfo " id="T3:U182"><span class="mxinfo " id="T26:U183"><span class="var type1" id="S2T4U270">thruster_data</span>(<span class="var type1" id="S37T3U271">j</span>)</span>.T</span> = <span class="mxinfo " id="T3:U186"><span class="mxinfo " id="T26:U187"><span class="var type1" id="S2T4U275">thruster_data</span>(<span class="var type1" id="S37T3U276">j</span>)</span>.Tmin</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,64" id="srcline64"> 64</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,65" id="srcline65"> 65</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,66" id="srcline66"> 66</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="86,67" id="srcline67"> 67</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo " id="T7:U190"><span class="mxinfo " id="T3:U191"><span class="mxinfo " id="T26:U192"><span class="var type1" id="S2T4U284">thruster_data</span>(<span class="var type1" id="S37T3U285">j</span>)</span>.T_reserve</span> &gt; <span class="mxinfo " id="T3:U195"><span class="mxinfo " id="T26:U196"><span class="var type1" id="S2T4U289">thruster_data</span>(<span class="var type1" id="S37T3U290">j</span>)</span>.Tmax</span></span> <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,68" id="srcline68"> 68</a></span><span class="line">            || <span class="mxinfo " id="T7:U199"><span class="mxinfo " id="T3:U200"><span class="mxinfo " id="T26:U201"><span class="var type1" id="S2T4U295">thruster_data</span>(<span class="var type1" id="S37T3U296">j</span>)</span>.T_reserve</span> &lt; <span class="mxinfo " id="T3:U204"><span class="mxinfo " id="T26:U205"><span class="var type1" id="S2T4U300">thruster_data</span>(<span class="var type1" id="S37T3U301">j</span>)</span>.Tmin</span></span><span class="comment">% guarantee initial T feasible </span></span></span>
<span class="srcline"><span class="lineno"><a href="86,69" id="srcline69"> 69</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo " id="T7:U208"><span class="mxinfo " id="T3:U209"><span class="mxinfo " id="T26:U210"><span class="var type1" id="S2T4U308">thruster_data</span>(<span class="var type1" id="S37T3U309">j</span>)</span>.type</span> == <span class="mxinfo " id="T3:U213">4</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="86,70" id="srcline70"> 70</a></span><span class="line">            <span class="mxinfo " id="T3:U214"><span class="mxinfo " id="T3:U215"><span class="mxinfo " id="T26:U216"><span class="var type1" id="S2T4U316">thruster_data</span>(<span class="var type1" id="S37T3U317">j</span>)</span>.T_reserve</span> = <span class="mxinfo " id="T3:U219">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,71" id="srcline71"> 71</a></span><span class="line">        <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,72" id="srcline72"> 72</a></span><span class="line">            <span class="mxinfo " id="T3:U220"><span class="mxinfo " id="T3:U221"><span class="mxinfo " id="T26:U222"><span class="var type1" id="S2T4U325">thruster_data</span>(<span class="var type1" id="S37T3U326">j</span>)</span>.T_reserve</span> = <span class="mxinfo " id="T3:U225"><span class="mxinfo " id="T26:U226"><span class="var type1" id="S2T4U330">thruster_data</span>(<span class="var type1" id="S37T3U331">j</span>)</span>.Tmin</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,73" id="srcline73"> 73</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,74" id="srcline74"> 74</a></span><span class="line">    <span class="keyword">end</span>    </span></span>
<span class="srcline"><span class="lineno"><a href="86,75" id="srcline75"> 75</a></span><span class="line"><span class="comment">% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %     </span></span></span>
<span class="srcline"><span class="lineno"><a href="86,76" id="srcline76"> 76</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="86,77" id="srcline77"> 77</a></span><span class="line">    <span class="mxinfo " id="T3:U229"><span class="mxinfo " id="T3:U230"><span class="var type1" id="S10T1U336">x0</span>(<span class="mxinfo " id="T3:U232"><span class="mxinfo " id="T3:U233"><span class="mxinfo " id="T3:U234">2</span> * <span class="var type1" id="S37T3U340">j</span></span> - <span class="mxinfo " id="T3:U236">1</span></span>)</span>=<span class="mxinfo " id="T3:U237"><span class="mxinfo " id="T3:U238"><span class="mxinfo " id="T26:U239"><span class="var type1" id="S2T4U345">thruster_data</span>(<span class="var type1" id="S37T3U346">j</span>)</span>.T</span>*<span class="mxinfo " id="T3:U242">cos(<span class="mxinfo " id="T3:U243"><span class="mxinfo " id="T26:U244"><span class="var type1" id="S2T4U352">thruster_data</span>(<span class="var type1" id="S37T3U353">j</span>)</span>.phi</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,78" id="srcline78"> 78</a></span><span class="line">    <span class="mxinfo " id="T3:U247"><span class="mxinfo " id="T3:U248"><span class="var type1" id="S10T1U358">x0</span>(<span class="mxinfo " id="T3:U250"><span class="mxinfo " id="T3:U251">2</span> * <span class="var type1" id="S37T3U361">j</span></span>)</span>=<span class="mxinfo " id="T3:U253"><span class="mxinfo " id="T3:U254"><span class="mxinfo " id="T26:U255"><span class="var type1" id="S2T4U365">thruster_data</span>(<span class="var type1" id="S37T3U366">j</span>)</span>.T</span>*<span class="mxinfo " id="T3:U258">sin(<span class="mxinfo " id="T3:U259"><span class="mxinfo " id="T26:U260"><span class="var type1" id="S2T4U372">thruster_data</span>(<span class="var type1" id="S37T3U373">j</span>)</span>.phi</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,79" id="srcline79"> 79</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="86,80" id="srcline80"> 80</a></span><span class="line">    <span class="keyword">switch</span> <span class="mxinfo " id="T3:U263"><span class="mxinfo " id="T26:U264"><span class="var type1" id="S2T4U378">thruster_data</span>(<span class="var type1" id="S37T3U379">j</span>)</span>.type</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,81" id="srcline81"> 81</a></span><span class="line">        <span class="keyword">case</span> <span class="mxinfo " id="T3:U267">4</span><span class="comment">%tunnel</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,82" id="srcline82"> 82</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="86,83" id="srcline83"> 83</a></span><span class="line">            <span class="mxinfo " id="T3:U268"><span class="mxinfo " id="T3:U269"><span class="mxinfo " id="T26:U270"><span class="var type1" id="S2T4U387">thruster_data</span>(<span class="var type1" id="S37T3U388">j</span>)</span>.Tplus</span> = <span class="mxinfo " id="T3:U273">min(<span class="mxinfo " id="T3:U274"><span class="mxinfo " id="T3:U275"><span class="mxinfo " id="T26:U276"><span class="var type1" id="S2T4U395">thruster_data</span>(<span class="var type1" id="S37T3U396">j</span>)</span>.T</span> + <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,84" id="srcline84"> 84</a></span><span class="line">                <span class="mxinfo " id="T3:U279"><span class="var type1" id="S29T3U399">dt</span> * <span class="mxinfo " id="T3:U281"><span class="mxinfo " id="T26:U282"><span class="var type1" id="S2T4U402">thruster_data</span>(<span class="var type1" id="S37T3U403">j</span>)</span>.dTmax</span></span></span>, <span class="mxinfo " id="T3:U285"><span class="mxinfo " id="T26:U286"><span class="var type1" id="S2T4U407">thruster_data</span>(<span class="var type1" id="S37T3U408">j</span>)</span>.Tmax</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,85" id="srcline85"> 85</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="86,86" id="srcline86"> 86</a></span><span class="line">            <span class="mxinfo " id="T3:U289"><span class="mxinfo " id="T3:U290"><span class="mxinfo " id="T26:U291"><span class="var type1" id="S2T4U414">thruster_data</span>(<span class="var type1" id="S37T3U415">j</span>)</span>.T_</span> = <span class="mxinfo " id="T3:U294">max(<span class="mxinfo " id="T3:U295"><span class="mxinfo " id="T3:U296"><span class="mxinfo " id="T26:U297"><span class="var type1" id="S2T4U422">thruster_data</span>(<span class="var type1" id="S37T3U423">j</span>)</span>.T</span> - <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,87" id="srcline87"> 87</a></span><span class="line">                <span class="mxinfo " id="T3:U300"><span class="var type1" id="S29T3U426">dt</span> * <span class="mxinfo " id="T3:U302"><span class="mxinfo " id="T26:U303"><span class="var type1" id="S2T4U429">thruster_data</span>(<span class="var type1" id="S37T3U430">j</span>)</span>.dTmax</span></span></span>, <span class="mxinfo " id="T3:U306"><span class="mxinfo " id="T26:U307"><span class="var type1" id="S2T4U434">thruster_data</span>(<span class="var type1" id="S37T3U435">j</span>)</span>.Tmin</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,88" id="srcline88"> 88</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="86,89" id="srcline89"> 89</a></span><span class="line">            <span class="mxinfo " id="T3:U310"><span class="var type1" id="S26T3U439">Ntunnel</span> = <span class="mxinfo " id="T3:U312"><span class="var type1" id="S26T3U441">Ntunnel</span> + <span class="mxinfo " id="T3:U314">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,90" id="srcline90"> 90</a></span><span class="line">        <span class="keyword">case</span> <span class="mxinfo " id="T3:U315">3</span><span class="comment">%azi</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,91" id="srcline91"> 91</a></span><span class="line"><span class="comment">%             thruster_data(j).Tplus = min(thruster_data(j).T + <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="86,92" id="srcline92"> 92</a></span><span class="line"><span class="comment">%                 dt * thruster_data(j).dTmax, thruster_data(j).Tmax);</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,93" id="srcline93"> 93</a></span><span class="line"><span class="comment">%             </span></span></span>
<span class="srcline"><span class="lineno"><a href="86,94" id="srcline94"> 94</a></span><span class="line"><span class="comment">%             thruster_data(j).T_ = max(thruster_data(j).T - <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="86,95" id="srcline95"> 95</a></span><span class="line"><span class="comment">%                 dt * thruster_data(j).dTmax, thruster_data(j).Tmin);</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,96" id="srcline96"> 96</a></span><span class="line"><span class="comment">%             -----------------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,97" id="srcline97"> 97</a></span><span class="line"><span class="comment">%             if thruster_data(j).constr == 2 </span></span></span>
<span class="srcline"><span class="lineno"><a href="86,98" id="srcline98"> 98</a></span><span class="line"><span class="comment">%                 thruster_data(j).phi_ = thruster_data(j).phi;%!!!!!!add -tol or not</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,99" id="srcline99"> 99</a></span><span class="line"><span class="comment">%                 thruster_data(j).phiPlus = thruster_data(j).phi;%!!!!!add +tol or not</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,100" id="srcline100">100</a></span><span class="line"><span class="comment">%             elseif thruster_data(j).constr == 3 </span></span></span>
<span class="srcline"><span class="lineno"><a href="86,101" id="srcline101">101</a></span><span class="line"><span class="comment">%                 </span></span></span>
<span class="srcline"><span class="lineno"><a href="86,102" id="srcline102">102</a></span><span class="line"><span class="comment">%             end</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,103" id="srcline103">103</a></span><span class="line"><span class="comment">%             thruster_data(j).phi_ = thruster_data(j).phi - dt * thruster_data(j).dphi_max;</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,104" id="srcline104">104</a></span><span class="line"><span class="comment">%                 thruster_data(j).phiPlus = thruster_data(j).phi + dt * thruster_data(j).dphi_max;</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,105" id="srcline105">105</a></span><span class="line"><span class="comment">%             -----------------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,106" id="srcline106">106</a></span><span class="line">            <span class="comment">%             thruster_data(j).phiPlus = min(thruster_data(j).phi + <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="86,107" id="srcline107">107</a></span><span class="line">            <span class="comment">%                 dt * thruster_data(j).dphi_max, thruster_data(j).phi_max);</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,108" id="srcline108">108</a></span><span class="line">            <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,109" id="srcline109">109</a></span><span class="line">            <span class="comment">%             thruster_data(j).phi_ = max(thruster_data(j).phi - <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="86,110" id="srcline110">110</a></span><span class="line">            <span class="comment">%                 dt * thruster_data(j).dphi_max, thruster_data(j).phi_min);</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,111" id="srcline111">111</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="86,112" id="srcline112">112</a></span><span class="line">            <span class="mxinfo " id="T3:U316"><span class="var type1" id="S27T3U447">Nazi</span> = <span class="mxinfo " id="T3:U318"><span class="var type1" id="S27T3U449">Nazi</span> + <span class="mxinfo " id="T3:U320">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,113" id="srcline113">113</a></span><span class="line">        <span class="keyword">case</span> <span class="mxinfo " id="T3:U321">2</span><span class="comment">%fpp</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,114" id="srcline114">114</a></span><span class="line">            <span class="mxinfo " id="T3:U322"><span class="mxinfo " id="T3:U323"><span class="mxinfo " id="T26:U324"><span class="var type1" id="S2T4U457">thruster_data</span>(<span class="var type1" id="S37T3U458">j</span>)</span>.Tplus</span> = <span class="mxinfo " id="T3:U327"><span class="mxinfo " id="T3:U328">min((<span class="mxinfo " id="T3:U329"><span class="mxinfo " id="T3:U330"><span class="mxinfo " id="T26:U331"><span class="var type1" id="S2T4U467">thruster_data</span>(<span class="var type1" id="S37T3U468">j</span>)</span>.T</span> + <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,115" id="srcline115">115</a></span><span class="line">                <span class="mxinfo " id="T3:U334"><span class="var type1" id="S29T3U471">dt</span> * <span class="mxinfo " id="T3:U336"><span class="mxinfo " id="T26:U337"><span class="var type1" id="S2T4U474">thruster_data</span>(<span class="var type1" id="S37T3U475">j</span>)</span>.dTmax</span></span></span>) , <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,116" id="srcline116">116</a></span><span class="line">                <span class="mxinfo " id="T3:U340"><span class="mxinfo " id="T26:U341"><span class="var type1" id="S2T4U479">thruster_data</span>(<span class="var type1" id="S37T3U480">j</span>)</span>.Tmax</span>)</span> * <span class="mxinfo " id="T3:U344">polyval(<span class="var type1" id="S17T11U484">Rangle_T</span>,<span class="mxinfo " id="T3:U346">abs(<span class="mxinfo " id="T3:U347"><span class="mxinfo " id="T26:U348"><span class="var type1" id="S2T4U489">thruster_data</span>(<span class="var type1" id="S37T3U490">j</span>)</span>.phi</span>)</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,117" id="srcline117">117</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="86,118" id="srcline118">118</a></span><span class="line">            <span class="mxinfo " id="T3:U351"><span class="mxinfo " id="T3:U352"><span class="mxinfo " id="T26:U353"><span class="var type1" id="S2T4U496">thruster_data</span>(<span class="var type1" id="S37T3U497">j</span>)</span>.T_</span> = <span class="mxinfo " id="T3:U356"><span class="mxinfo " id="T3:U357">max(<span class="mxinfo " id="T3:U358"><span class="mxinfo " id="T3:U359"><span class="mxinfo " id="T26:U360"><span class="var type1" id="S2T4U505">thruster_data</span>(<span class="var type1" id="S37T3U506">j</span>)</span>.T</span> - <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,119" id="srcline119">119</a></span><span class="line">                <span class="mxinfo " id="T3:U363"><span class="var type1" id="S29T3U509">dt</span> * <span class="mxinfo " id="T3:U365"><span class="mxinfo " id="T26:U366"><span class="var type1" id="S2T4U512">thruster_data</span>(<span class="var type1" id="S37T3U513">j</span>)</span>.dTmax</span></span></span>, <span class="mxinfo " id="T3:U369"><span class="mxinfo " id="T26:U370"><span class="var type1" id="S2T4U517">thruster_data</span>(<span class="var type1" id="S37T3U518">j</span>)</span>.Tmin</span>)</span> <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,120" id="srcline120">120</a></span><span class="line">                * <span class="mxinfo " id="T3:U373">polyval(<span class="var type1" id="S17T11U522">Rangle_T</span>,<span class="mxinfo " id="T3:U375">abs(<span class="mxinfo " id="T3:U376"><span class="mxinfo " id="T26:U377"><span class="var type1" id="S2T4U527">thruster_data</span>(<span class="var type1" id="S37T3U528">j</span>)</span>.phi</span>)</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,121" id="srcline121">121</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="86,122" id="srcline122">122</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="86,123" id="srcline123">123</a></span><span class="line">            [<span class="var type1" id="S44T3U533">temp1</span>,<span class="var type1" id="S45T3U534">temp2</span>]= <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,124" id="srcline124">124</a></span><span class="line">                <span class="fcn" id="F293N7:B536">angleMaxMin</span>(<span class="mxinfo " id="T3:U382"><span class="mxinfo " id="T26:U383"><span class="var type1" id="S2T4U539">thruster_data</span>(<span class="var type1" id="S37T3U540">j</span>)</span>.phi_min</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,125" id="srcline125">125</a></span><span class="line">                <span class="mxinfo " id="T3:U386"><span class="mxinfo " id="T26:U387"><span class="var type1" id="S2T4U544">thruster_data</span>(<span class="var type1" id="S37T3U545">j</span>)</span>.phi_max</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,126" id="srcline126">126</a></span><span class="line">                <span class="mxinfo " id="T3:U390"><span class="mxinfo " id="T26:U391"><span class="var type1" id="S2T4U549">thruster_data</span>(<span class="var type1" id="S37T3U550">j</span>)</span>.phi</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,127" id="srcline127">127</a></span><span class="line">                <span class="mxinfo " id="T3:U394"><span class="mxinfo " id="T3:U395"><span class="mxinfo " id="T26:U396"><span class="var type1" id="S2T4U555">thruster_data</span>(<span class="var type1" id="S37T3U556">j</span>)</span>.phi</span> - <span class="mxinfo " id="T3:U399"><span class="var type1" id="S29T3U559">dt</span> * <span class="mxinfo " id="T3:U401"><span class="mxinfo " id="T26:U402"><span class="var type1" id="S2T4U562">thruster_data</span>(<span class="var type1" id="S37T3U563">j</span>)</span>.dphi_max</span></span></span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,128" id="srcline128">128</a></span><span class="line">                <span class="mxinfo " id="T3:U405"><span class="mxinfo " id="T3:U406"><span class="mxinfo " id="T26:U407"><span class="var type1" id="S2T4U568">thruster_data</span>(<span class="var type1" id="S37T3U569">j</span>)</span>.phi</span> + <span class="mxinfo " id="T3:U410"><span class="var type1" id="S29T3U572">dt</span> * <span class="mxinfo " id="T3:U412"><span class="mxinfo " id="T26:U413"><span class="var type1" id="S2T4U575">thruster_data</span>(<span class="var type1" id="S37T3U576">j</span>)</span>.dphi_max</span></span></span>);</span></span>
<span class="srcline"><span class="lineno"><a href="86,129" id="srcline129">129</a></span><span class="line">            <span class="mxinfo " id="T3:U416"><span class="mxinfo " id="T3:U417"><span class="mxinfo " id="T26:U418"><span class="var type1" id="S2T4U582">thruster_data</span>(<span class="var type1" id="S37T3U583">j</span>)</span>.phiPlus</span> = <span class="mxinfo " id="T3:U421"><span class="mxinfo " id="T3:U422">sign(<span class="var type1" id="S45T3U588">temp2</span>)</span> * <span class="mxinfo " id="T3:U424">polyval(<span class="var type1" id="S18T11U591">Rangle_Fangle</span>,<span class="mxinfo " id="T3:U426">abs(<span class="var type1" id="S45T3U594">temp2</span>)</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,130" id="srcline130">130</a></span><span class="line">            <span class="mxinfo " id="T3:U428"><span class="mxinfo " id="T3:U429"><span class="mxinfo " id="T26:U430"><span class="var type1" id="S2T4U599">thruster_data</span>(<span class="var type1" id="S37T3U600">j</span>)</span>.phi_</span> = <span class="mxinfo " id="T3:U433"><span class="mxinfo " id="T3:U434">sign(<span class="var type1" id="S44T3U605">temp1</span>)</span> * <span class="mxinfo " id="T3:U436">polyval(<span class="var type1" id="S18T11U608">Rangle_Fangle</span>,<span class="mxinfo " id="T3:U438">abs(<span class="var type1" id="S44T3U611">temp1</span>)</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,131" id="srcline131">131</a></span><span class="line">            <span class="comment">%             temp = (min(thruster_data(j).phi + <span class="keyword">...</span><span class="comment"> %force angle</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="86,132" id="srcline132">132</a></span><span class="line">            <span class="comment">%                 dt * thruster_data(j).dphi_max, thruster_data(j).phi_max));</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,133" id="srcline133">133</a></span><span class="line">            <span class="comment">%             thruster_data(j).phiPlus = sign(temp) * polyval(Rangle_Fangle,abs(temp));</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,134" id="srcline134">134</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="86,135" id="srcline135">135</a></span><span class="line">            <span class="comment">%             temp = (max(thruster_data(j).phi - <span class="keyword">...</span><span class="comment"> %force angle</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="86,136" id="srcline136">136</a></span><span class="line">            <span class="comment">%                 dt * thruster_data(j).dphi_max, thruster_data(j).phi_min));</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,137" id="srcline137">137</a></span><span class="line">            <span class="comment">%             thruster_data(j).phi_ = sign(temp) * polyval(Rangle_Fangle,abs(temp));</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,138" id="srcline138">138</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="86,139" id="srcline139">139</a></span><span class="line">            <span class="mxinfo " id="T3:U440"><span class="var type1" id="S28T3U614">Nfpp</span> = <span class="mxinfo " id="T3:U442"><span class="var type1" id="S28T3U616">Nfpp</span> + <span class="mxinfo " id="T3:U444">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,140" id="srcline140">140</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,141" id="srcline141">141</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,142" id="srcline142">142</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="86,143" id="srcline143">143</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="86,144" id="srcline144">144</a></span><span class="line"><span class="comment">%!!!!!to be improved</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,145" id="srcline145">145</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="86,146" id="srcline146">146</a></span><span class="line"><span class="comment">%     for j=1:N_enabled_thruster%!!!!!the above Tplus is overwitten</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,147" id="srcline147">147</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="86,148" id="srcline148">148</a></span><span class="line"><span class="comment">%         thruster_data(j).Tplus = thruster_data(j).Tmax;</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,149" id="srcline149">149</a></span><span class="line"><span class="comment">%         thruster_data(j).T_ = thruster_data(j).Tmin;</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,150" id="srcline150">150</a></span><span class="line"><span class="comment">%         thruster_data(j).phi_ = thruster_data(j).phi_min;%not correct. if phi_max - phi_min &gt;pi, constraint falls</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,151" id="srcline151">151</a></span><span class="line"><span class="comment">%         thruster_data(j).phiPlus = thruster_data(j).phi_max;</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,152" id="srcline152">152</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="86,153" id="srcline153">153</a></span><span class="line"><span class="comment">%     end</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,154" id="srcline154">154</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="86,155" id="srcline155">155</a></span><span class="line"><span class="comment">% chck_sol = [[thruster_data(:).phi_min]' [thruster_data(:).phi_]' [thruster_data.phi]' [thruster_data.phiPlus]' [thruster_data(:).phi_max]'];</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,156" id="srcline156">156</a></span><span class="line"><span class="comment">% check_angle(chck_sol(:,1),chck_sol(:,2),chck_sol(:,3),chck_sol(:,4),chck_sol(:,5))</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,157" id="srcline157">157</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="86,158" id="srcline158">158</a></span><span class="line"><span class="mxinfo " id="T3:U445"><span class="var type1" id="S3T3U620">Nvar</span> = <span class="mxinfo " id="T3:U447"><span class="mxinfo " id="T3:U448"><span class="mxinfo " id="T3:U449"><span class="mxinfo " id="T3:U450"><span class="mxinfo " id="T3:U451">2</span> * <span class="var type1" id="S26T3U626">Ntunnel</span></span> + <span class="mxinfo " id="T3:U453"><span class="mxinfo " id="T3:U454">2</span> * <span class="var type1" id="S27T3U629">Nazi</span></span></span> + <span class="mxinfo " id="T3:U456"><span class="mxinfo " id="T3:U457">2</span> * <span class="var type1" id="S28T3U632">Nfpp</span></span></span> + <span class="mxinfo " id="T3:U459">3</span></span></span>;<span class="comment">%number of variables in quad</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,159" id="srcline159">159</a></span><span class="line"><span class="comment">% if no_azi_angle_constr == 0 % there is angle constraint</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,160" id="srcline160">160</a></span><span class="line"><span class="comment">%     N_A = Ntunnel * 2 + Nazi * (5 + NA_azi) + Nfpp * (5 + NA_fpp);</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,161" id="srcline161">161</a></span><span class="line"><span class="comment">% else</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,162" id="srcline162">162</a></span><span class="line"><span class="comment">%     N_A = Ntunnel * 2 + Nazi *  NA_azi + Nfpp * (5 + NA_fpp);</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,163" id="srcline163">163</a></span><span class="line"><span class="comment">% end</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,164" id="srcline164">164</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="86,165" id="srcline165">165</a></span><span class="line"><span class="mxinfo " id="T3:U460"><span class="var type1" id="S48T3U636">N_A</span> = <span class="mxinfo " id="T3:U462">0</span></span>;<span class="comment">%added v1.08</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,166" id="srcline166">166</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S37T3U640">j</span>=<span class="mxinfo " id="T1:U464"><span class="mxinfo " id="T3:U465">1</span>:<span class="var type1" id="S13T3U643">N_enabled_thruster</span></span> <span class="comment">%added v1.08</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,167" id="srcline167">167</a></span><span class="line">    <span class="keyword">switch</span> <span class="mxinfo " id="T3:U467"><span class="mxinfo " id="T26:U468"><span class="var type1" id="S2T4U647">thruster_data</span>(<span class="var type1" id="S37T3U648">j</span>)</span>.type</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,168" id="srcline168">168</a></span><span class="line">        <span class="keyword">case</span> <span class="mxinfo " id="T3:U471">4</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,169" id="srcline169">169</a></span><span class="line">            <span class="mxinfo " id="T3:U472"><span class="var type1" id="S48T3U654">N_A</span> = <span class="mxinfo " id="T3:U474"><span class="var type1" id="S48T3U656">N_A</span> + <span class="mxinfo " id="T3:U476">2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,170" id="srcline170">170</a></span><span class="line">        <span class="keyword">case</span> <span class="mxinfo " id="T3:U477">3</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,171" id="srcline171">171</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="86,172" id="srcline172">172</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo " id="T7:U478"><span class="mxinfo " id="T3:U479"><span class="mxinfo " id="T26:U480"><span class="var type1" id="S2T4U666">thruster_data</span>(<span class="var type1" id="S37T3U667">j</span>)</span>.constr</span> == <span class="mxinfo " id="T3:U483">2</span></span> || <span class="mxinfo " id="T7:U484"><span class="mxinfo " id="T3:U485"><span class="mxinfo " id="T26:U486"><span class="var type1" id="S2T4U673">thruster_data</span>(<span class="var type1" id="S37T3U674">j</span>)</span>.constr</span> == <span class="mxinfo " id="T3:U489">3</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="86,173" id="srcline173">173</a></span><span class="line">                <span class="mxinfo " id="T3:U490"><span class="var type1" id="S48T3U679">N_A</span> = <span class="mxinfo " id="T3:U492"><span class="var type1" id="S48T3U681">N_A</span> + (<span class="mxinfo " id="T3:U494"><span class="mxinfo " id="T3:U495">5</span> + <span class="var type1" id="S22T3U685">NA_azi</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,174" id="srcline174">174</a></span><span class="line">            <span class="keyword">else</span> </span></span>
<span class="srcline"><span class="lineno"><a href="86,175" id="srcline175">175</a></span><span class="line">                <span class="mxinfo " id="T3:U497"><span class="var type1" id="S48T3U689">N_A</span> = <span class="mxinfo " id="T3:U499"><span class="var type1" id="S48T3U691">N_A</span> + <span class="var type1" id="S22T3U692">NA_azi</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,176" id="srcline176">176</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,177" id="srcline177">177</a></span><span class="line">        <span class="keyword">case</span> <span class="mxinfo " id="T3:U502">2</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,178" id="srcline178">178</a></span><span class="line">            <span class="mxinfo " id="T3:U503"><span class="var type1" id="S48T3U697">N_A</span> = <span class="mxinfo " id="T3:U505"><span class="var type1" id="S48T3U699">N_A</span> + (<span class="mxinfo " id="T3:U507"><span class="mxinfo " id="T3:U508">5</span> + <span class="var type1" id="S15T3U703">NA_fpp</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,179" id="srcline179">179</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,180" id="srcline180">180</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="86,181" id="srcline181">181</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,182" id="srcline182">182</a></span><span class="line"><span class="comment">%% ------------------------------------------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,183" id="srcline183">183</a></span><span class="line"><span class="keyword">persistent</span> <span class="var type1" id="S49T28U705">H</span> <span class="var type1" id="S50T1U706">f</span> <span class="var type1" id="S51T3U707">N_Aeq</span> <span class="var type1" id="S52T28U708">Aeq</span> <span class="var type1" id="S53T1U709">beq</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,184" id="srcline184">184</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T7:U515">isempty(<span class="var type0" id="S49T0U719">H</span>)</span>||<span class="mxinfo " id="T7:U516">isempty(<span class="var type0" id="S50T0U722">f</span>)</span>||<span class="mxinfo " id="T7:U517">isempty(<span class="var type0" id="S51T0U725">N_Aeq</span>)</span>||<span class="mxinfo " id="T7:U518">isempty(<span class="var type0" id="S52T0U728">Aeq</span>)</span>||<span class="mxinfo " id="T7:U519">isempty(<span class="var type0" id="S53T0U731">beq</span>)</span>||<span class="mxinfo " id="T7:U520"><span class="var type1" id="S11T7U733">init</span> == <span class="mxinfo " id="T7:U522">true</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="86,185" id="srcline185">185</a></span><span class="line">    <span class="mxinfo " id="T28:U523"><span class="var type1" id="S49T28U738">H</span> = <span class="mxinfo " id="T28:U525">eye(<span class="var type1" id="S3T3U741">Nvar</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,186" id="srcline186">186</a></span><span class="line">    <span class="mxinfo " id="T1:U527"><span class="var type1" id="S50T1U744">f</span>= <span class="mxinfo " id="T1:U529">zeros(<span class="var type1" id="S3T3U747">Nvar</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,187" id="srcline187">187</a></span><span class="line">    <span class="mxinfo " id="T3:U531"><span class="var type1" id="S51T3U751">N_Aeq</span> = <span class="mxinfo " id="T3:U533"><span class="mxinfo " id="T3:U534">3</span> + <span class="var type1" id="S26T3U754">Ntunnel</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,188" id="srcline188">188</a></span><span class="line">    <span class="mxinfo " id="T28:U536"><span class="var type1" id="S52T28U757">Aeq</span>= <span class="mxinfo " id="T28:U538">zeros(<span class="var type1" id="S51T3U760">N_Aeq</span>,<span class="var type1" id="S3T3U761">Nvar</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,189" id="srcline189">189</a></span><span class="line">    <span class="mxinfo " id="T1:U541"><span class="var type1" id="S53T1U764">beq</span>=<span class="mxinfo " id="T1:U543">zeros(<span class="var type1" id="S51T3U767">N_Aeq</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,190" id="srcline190">190</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="86,191" id="srcline191">191</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="86,192" id="srcline192">192</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,193" id="srcline193">193</a></span><span class="line">    <span class="mxinfo " id="T28:U545"><span class="var type1" id="S55T28U771">A</span>=<span class="mxinfo " id="T28:U547">zeros(<span class="var type1" id="S48T3U774">N_A</span>,<span class="var type1" id="S3T3U775">Nvar</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,194" id="srcline194">194</a></span><span class="line">    <span class="mxinfo " id="T1:U550"><span class="var type1" id="S56T1U778">b</span>= <span class="mxinfo " id="T1:U552">zeros(<span class="var type1" id="S48T3U781">N_A</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,195" id="srcline195">195</a></span><span class="line">    <span class="mxinfo " id="T3:U554"><span class="mxinfo " id="T3:U555"><span class="var type1" id="S53T1U786">beq</span>(<span class="mxinfo " id="T3:U557">1</span>)</span> = <span class="mxinfo " id="T3:U558"><span class="var type1" id="S12T8U789">T_r</span>.Tx</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,196" id="srcline196">196</a></span><span class="line">    <span class="mxinfo " id="T3:U560"><span class="mxinfo " id="T3:U561"><span class="var type1" id="S53T1U794">beq</span>(<span class="mxinfo " id="T3:U563">2</span>)</span> = <span class="mxinfo " id="T3:U564"><span class="var type1" id="S12T8U797">T_r</span>.Ty</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,197" id="srcline197">197</a></span><span class="line">    <span class="mxinfo " id="T3:U566"><span class="mxinfo " id="T3:U567"><span class="var type1" id="S53T1U802">beq</span>(<span class="mxinfo " id="T3:U569">3</span>)</span> = <span class="mxinfo " id="T3:U570"><span class="var type1" id="S12T8U805">T_r</span>.Tm</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,198" id="srcline198">198</a></span><span class="line"><span class="comment">% ------------------------------------------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,199" id="srcline199">199</a></span><span class="line"><span class="mxinfo " id="T3:U572"><span class="var type1" id="S57T3U809">i_H</span> = <span class="mxinfo " id="T3:U574">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,200" id="srcline200">200</a></span><span class="line"><span class="mxinfo " id="T3:U575"><span class="var type1" id="S58T3U813">numOfTunnel</span>=<span class="mxinfo " id="T3:U577">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,201" id="srcline201">201</a></span><span class="line"><span class="mxinfo " id="T3:U578"><span class="var type1" id="S59T3U817">numOfAzi</span>=<span class="mxinfo " id="T3:U580">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,202" id="srcline202">202</a></span><span class="line"><span class="mxinfo " id="T3:U581"><span class="var type1" id="S60T3U821">numOfFpp</span>=<span class="mxinfo " id="T3:U583">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,203" id="srcline203">203</a></span><span class="line"><span class="mxinfo " id="T3:U584"><span class="var type1" id="S61T3U825">pos_A</span> = <span class="mxinfo " id="T3:U586">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,204" id="srcline204">204</a></span><span class="line"><span class="mxinfo " id="T3:U587"><span class="var type1" id="S62T3U829">pos_Aeq</span> = <span class="mxinfo " id="T3:U589">4</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,205" id="srcline205">205</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="86,206" id="srcline206">206</a></span><span class="line"><span class="mxinfo " id="T32:U590"><span class="var type1" id="S63T32U833">eff_all</span> = <span class="mxinfo " id="T32:U592">ones(<span class="mxinfo " id="T3:U593">1</span>,<span class="var type1" id="S13T3U837">N_enabled_thruster</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,207" id="srcline207">207</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S37T3U840">j</span>=<span class="mxinfo " id="T1:U596"><span class="mxinfo " id="T3:U597">1</span>:<span class="var type1" id="S13T3U843">N_enabled_thruster</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="86,208" id="srcline208">208</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo " id="T7:U599"><span class="mxinfo " id="T3:U600"><span class="mxinfo " id="T26:U601"><span class="var type1" id="S2T4U849">thruster_data</span>(<span class="var type1" id="S37T3U850">j</span>)</span>.type</span> == <span class="mxinfo " id="T3:U604">3</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="86,209" id="srcline209">209</a></span><span class="line">        <span class="mxinfo " id="T3:U605"><span class="mxinfo " id="T3:U606"><span class="var type1" id="S63T32U856">eff_all</span>(<span class="var type1" id="S37T3U857">j</span>)</span> = <span class="mxinfo " id="T1:U609"><span class="fcn" id="F320N9:B859">azi_eff</span>(<span class="mxinfo " id="T20:U610"><span class="mxinfo " id="T89:U611"><span class="var type1" id="S14T23U862">Ce</span>(<span class="var type1" id="S37T3U863">j</span>)</span>.value</span>,<span class="mxinfo " id="T3:U614"><span class="mxinfo " id="T26:U615"><span class="var type1" id="S2T4U867">thruster_data</span>(<span class="var type1" id="S37T3U868">j</span>)</span>.phi</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,210" id="srcline210">210</a></span><span class="line">    <span class="keyword">end</span>    </span></span>
<span class="srcline"><span class="lineno"><a href="86,211" id="srcline211">211</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,212" id="srcline212">212</a></span><span class="line">[<span class="var type1" id="S66T3U873">eff</span>,<span class="var type1" id="S67T3U874">pos_eff</span>] = min(<span class="var type1" id="S63T32U877">eff_all</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="86,213" id="srcline213">213</a></span><span class="line"><span class="mxinfo " id="T32:U621"><span class="var type1" id="S63T32U880">eff_all</span> = <span class="mxinfo " id="T32:U623">ones(<span class="mxinfo " id="T3:U624">1</span>,<span class="var type1" id="S13T3U884">N_enabled_thruster</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,214" id="srcline214">214</a></span><span class="line"><span class="mxinfo " id="T3:U626"><span class="mxinfo " id="T3:U627"><span class="var type1" id="S63T32U888">eff_all</span>(<span class="var type1" id="S67T3U889">pos_eff</span>)</span> = <span class="var type1" id="S66T3U890">eff</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,215" id="srcline215">215</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="86,216" id="srcline216">216</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S37T3U893">j</span>=<span class="mxinfo " id="T1:U632"><span class="mxinfo " id="T3:U633">1</span>:<span class="var type1" id="S13T3U896">N_enabled_thruster</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="86,217" id="srcline217">217</a></span><span class="line">    <span class="keyword">switch</span> <span class="mxinfo " id="T3:U635"><span class="mxinfo " id="T26:U636"><span class="var type1" id="S2T4U900">thruster_data</span>(<span class="var type1" id="S37T3U901">j</span>)</span>.type</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,218" id="srcline218">218</a></span><span class="line">        <span class="keyword">case</span> <span class="mxinfo " id="T3:U639">4</span>  <span class="comment">%tunnel</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,219" id="srcline219">219</a></span><span class="line">            <span class="mxinfo " id="T3:U640"><span class="var type1" id="S68T3U907">temp</span> = <span class="mxinfo " id="T3:U642"><span class="mxinfo " id="T3:U643"><span class="mxinfo " id="T3:U644"><span class="var type1" id="S59T3U911">numOfAzi</span> * <span class="mxinfo " id="T3:U646">2</span></span> + <span class="mxinfo " id="T3:U647"><span class="var type1" id="S58T3U914">numOfTunnel</span> * <span class="mxinfo " id="T3:U649">2</span></span></span> + <span class="mxinfo " id="T3:U650"><span class="var type1" id="S60T3U917">numOfFpp</span> * <span class="mxinfo " id="T3:U652">2</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,220" id="srcline220">220</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo " id="T7:U653"><span class="var type1" id="S11T7U922">init</span> == <span class="mxinfo " id="T7:U655">true</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="86,221" id="srcline221">221</a></span><span class="line">            <span class="mxinfo " id="T3:U656"><span class="mxinfo " id="T3:U657"><span class="var type1" id="S49T28U928">H</span>(<span class="var type1" id="S57T3U929">i_H</span>,<span class="var type1" id="S57T3U930">i_H</span>)</span> = <span class="mxinfo " id="T3:U661"><span class="mxinfo " id="T3:U662"><span class="mxinfo " id="T5:U663"><span class="mxinfo " id="T26:U664"><span class="var type1" id="S2T4U935">thruster_data</span>(<span class="var type1" id="S37T3U936">j</span>)</span>.weight</span>(<span class="mxinfo " id="T3:U667">1</span>)</span> * <span class="mxinfo " id="T3:U668"><span class="mxinfo " id="T3:U669"><span class="mxinfo " id="T26:U670"><span class="var type1" id="S2T4U942">thruster_data</span>(<span class="var type1" id="S37T3U943">j</span>)</span>.Tmax</span>^4</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,222" id="srcline222">222</a></span><span class="line">            <span class="mxinfo " id="T3:U673"><span class="mxinfo " id="T3:U674"><span class="var type1" id="S49T28U949">H</span>(<span class="mxinfo " id="T3:U676"><span class="var type1" id="S57T3U951">i_H</span> + <span class="mxinfo " id="T3:U678">1</span></span>,<span class="mxinfo " id="T3:U679"><span class="var type1" id="S57T3U954">i_H</span> + <span class="mxinfo " id="T3:U681">1</span></span>)</span> = <span class="mxinfo " id="T3:U682"><span class="mxinfo " id="T3:U683"><span class="mxinfo " id="T5:U684"><span class="mxinfo " id="T26:U685"><span class="var type1" id="S2T4U960">thruster_data</span>(<span class="var type1" id="S37T3U961">j</span>)</span>.weight</span>(<span class="mxinfo " id="T3:U688">2</span>)</span> * <span class="mxinfo " id="T3:U689"><span class="mxinfo " id="T3:U690"><span class="mxinfo " id="T26:U691"><span class="var type1" id="S2T4U967">thruster_data</span>(<span class="var type1" id="S37T3U968">j</span>)</span>.Tmax</span>^4</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,223" id="srcline223">223</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="86,224" id="srcline224">224</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="86,225" id="srcline225">225</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="86,226" id="srcline226">226</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="86,227" id="srcline227">227</a></span><span class="line">                <span class="mxinfo " id="T103:U694"><span class="mxinfo " id="T103:U695"><span class="var type1" id="S52T28U974">Aeq</span>(<span class="mxinfo " id="T11:U697"><span class="mxinfo " id="T3:U698">1</span>:<span class="mxinfo " id="T3:U699">3</span></span>,<span class="mxinfo " id="T27:U700"><span class="mxinfo " id="T3:U701"><span class="var type1" id="S68T3U980">temp</span> + 1</span>:<span class="mxinfo " id="T3:U703"><span class="var type1" id="S68T3U983">temp</span> + 2</span></span>)</span><span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,228" id="srcline228">228</a></span><span class="line">                    = <span class="mxinfo " id="T103:U705"><span class="mxinfo " id="T103:U706">[<span class="mxinfo " id="T5:U707">1 0</span>;<span class="mxinfo " id="T5:U708">0 1</span>; <span class="mxinfo " id="T5:U709"><span class="mxinfo " id="T3:U710"><span class="mxinfo " id="T3:U711">- <span class="mxinfo " id="T3:U712"><span class="mxinfo " id="T26:U713"><span class="var type1" id="S2T4U998">thruster_data</span>(<span class="var type1" id="S37T3U999">j</span>)</span>.y</span></span> + <span class="mxinfo " id="T3:U716"><span class="mxinfo " id="T26:U717"><span class="var type1" id="S2T4U1003">thruster_data</span>(<span class="var type1" id="S37T3U1004">j</span>)</span>.y0</span></span> <span class="mxinfo " id="T3:U720"><span class="mxinfo " id="T3:U721"><span class="mxinfo " id="T26:U722"><span class="var type1" id="S2T4U1009">thruster_data</span>(<span class="var type1" id="S37T3U1010">j</span>)</span>.x</span> - <span class="mxinfo " id="T3:U725"><span class="mxinfo " id="T26:U726"><span class="var type1" id="S2T4U1014">thruster_data</span>(<span class="var type1" id="S37T3U1015">j</span>)</span>.x0</span></span></span>]</span> * <span class="mxinfo " id="T3:U729"><span class="mxinfo " id="T3:U730"><span class="mxinfo " id="T26:U731"><span class="var type1" id="S2T4U1020">thruster_data</span>(<span class="var type1" id="S37T3U1021">j</span>)</span>.Tmax</span>^2</span></span></span>;<span class="comment">%R1 R2 R3</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,229" id="srcline229">229</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="86,230" id="srcline230">230</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="86,231" id="srcline231">231</a></span><span class="line"><span class="comment">%             Aeq(pos_Aeq,numOfAzi * 2 + numOfTunnel * 2 + numOfFpp * 2 + 1) = sin(thruster_data(j).phi_min);</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,232" id="srcline232">232</a></span><span class="line"><span class="comment">%             Aeq(pos_Aeq,numOfAzi * 2 + numOfTunnel * 2 + numOfFpp * 2 + 2) = -cos(thruster_data(j).phi_min);</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,233" id="srcline233">233</a></span><span class="line">            <span class="mxinfo " id="T5:U734"><span class="mxinfo " id="T5:U735"><span class="var type1" id="S52T28U1027">Aeq</span>(<span class="var type1" id="S62T3U1028">pos_Aeq</span>,<span class="mxinfo " id="T27:U738"><span class="mxinfo " id="T3:U739"><span class="var type1" id="S68T3U1031">temp</span> + 1</span>:<span class="mxinfo " id="T3:U741"><span class="var type1" id="S68T3U1034">temp</span> + 2</span></span>)</span> = <span class="mxinfo " id="T5:U743"><span class="mxinfo " id="T5:U744">[<span class="mxinfo " id="T3:U745">sin(<span class="mxinfo " id="T3:U746"><span class="mxinfo " id="T26:U747"><span class="var type1" id="S2T4U1043">thruster_data</span>(<span class="var type1" id="S37T3U1044">j</span>)</span>.phi_min</span>)</span> <span class="mxinfo " id="T3:U750">-<span class="mxinfo " id="T3:U751">cos(<span class="mxinfo " id="T3:U752"><span class="mxinfo " id="T26:U753"><span class="var type1" id="S2T4U1051">thruster_data</span>(<span class="var type1" id="S37T3U1052">j</span>)</span>.phi_min</span>)</span></span>]</span> * <span class="mxinfo " id="T3:U756"><span class="mxinfo " id="T3:U757"><span class="mxinfo " id="T26:U758"><span class="var type1" id="S2T4U1057">thruster_data</span>(<span class="var type1" id="S37T3U1058">j</span>)</span>.Tmax</span>^2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,234" id="srcline234">234</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="86,235" id="srcline235">235</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="86,236" id="srcline236">236</a></span><span class="line">            <span class="mxinfo " id="T3:U761"><span class="mxinfo " id="T3:U762"><span class="var type1" id="S53T1U1064">beq</span>(<span class="var type1" id="S62T3U1065">pos_Aeq</span>)</span> = <span class="mxinfo " id="T3:U765">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,237" id="srcline237">237</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="86,238" id="srcline238">238</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="86,239" id="srcline239">239</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,240" id="srcline240">240</a></span><span class="line">            <span class="comment">%             A(pos_A,numOfAzi * 2 + numOfTunnel * 2 + numOfFpp * 2 + 1) = -cos(thruster_data(j).phi_min);</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,241" id="srcline241">241</a></span><span class="line"><span class="comment">%             A(pos_A,numOfAzi * 2 + numOfTunnel * 2 + numOfFpp * 2 + 2) = -sin(thruster_data(j).phi_min);</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,242" id="srcline242">242</a></span><span class="line">            <span class="mxinfo " id="T5:U766"><span class="mxinfo " id="T5:U767"><span class="var type1" id="S55T28U1070">A</span>(<span class="var type1" id="S61T3U1071">pos_A</span>,<span class="mxinfo " id="T27:U770"><span class="mxinfo " id="T3:U771"><span class="var type1" id="S68T3U1074">temp</span> + 1</span>:<span class="mxinfo " id="T3:U773"><span class="var type1" id="S68T3U1077">temp</span> + 2</span></span>)</span> = <span class="mxinfo " id="T5:U775"><span class="mxinfo " id="T5:U776">[<span class="mxinfo " id="T3:U777">-<span class="mxinfo " id="T3:U778">cos(<span class="mxinfo " id="T3:U779"><span class="mxinfo " id="T26:U780"><span class="var type1" id="S2T4U1087">thruster_data</span>(<span class="var type1" id="S37T3U1088">j</span>)</span>.phi_min</span>)</span></span> <span class="mxinfo " id="T3:U783">-<span class="mxinfo " id="T3:U784">sin(<span class="mxinfo " id="T3:U785"><span class="mxinfo " id="T26:U786"><span class="var type1" id="S2T4U1095">thruster_data</span>(<span class="var type1" id="S37T3U1096">j</span>)</span>.phi_min</span>)</span></span>]</span>* <span class="mxinfo " id="T3:U789"><span class="mxinfo " id="T3:U790"><span class="mxinfo " id="T26:U791"><span class="var type1" id="S2T4U1101">thruster_data</span>(<span class="var type1" id="S37T3U1102">j</span>)</span>.Tmax</span>^2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,243" id="srcline243">243</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="86,244" id="srcline244">244</a></span><span class="line"><span class="comment">%             b(pos_A) = -thruster_data(j).Tplus;</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,245" id="srcline245">245</a></span><span class="line"><span class="comment">%             A(pos_A + 1,numOfAzi * 2 + numOfTunnel * 2 + numOfFpp * 2 + 1) = cos(thruster_data(j).phi_min);</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,246" id="srcline246">246</a></span><span class="line"><span class="comment">%             A(pos_A + 1,numOfAzi * 2 + numOfTunnel * 2 + numOfFpp * 2 + 2) = sin(thruster_data(j).phi_min);</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,247" id="srcline247">247</a></span><span class="line">            <span class="mxinfo " id="T5:U794"><span class="mxinfo " id="T5:U795"><span class="var type1" id="S55T28U1108">A</span>(<span class="mxinfo " id="T3:U797"><span class="var type1" id="S61T3U1110">pos_A</span> + <span class="mxinfo " id="T3:U799">1</span></span>,<span class="mxinfo " id="T27:U800"><span class="mxinfo " id="T3:U801"><span class="var type1" id="S68T3U1114">temp</span> + 1</span>:<span class="mxinfo " id="T3:U803"><span class="var type1" id="S68T3U1117">temp</span> + 2</span></span>)</span> = <span class="mxinfo " id="T5:U805"><span class="mxinfo " id="T5:U806">[<span class="mxinfo " id="T3:U807">cos(<span class="mxinfo " id="T3:U808"><span class="mxinfo " id="T26:U809"><span class="var type1" id="S2T4U1126">thruster_data</span>(<span class="var type1" id="S37T3U1127">j</span>)</span>.phi_min</span>)</span> <span class="mxinfo " id="T3:U812">sin(<span class="mxinfo " id="T3:U813"><span class="mxinfo " id="T26:U814"><span class="var type1" id="S2T4U1133">thruster_data</span>(<span class="var type1" id="S37T3U1134">j</span>)</span>.phi_min</span>)</span>]</span>* <span class="mxinfo " id="T3:U817"><span class="mxinfo " id="T3:U818"><span class="mxinfo " id="T26:U819"><span class="var type1" id="S2T4U1139">thruster_data</span>(<span class="var type1" id="S37T3U1140">j</span>)</span>.Tmax</span>^2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,248" id="srcline248">248</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="86,249" id="srcline249">249</a></span><span class="line"><span class="comment">%             b(pos_A + 1) = thruster_data(j).T_;</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,250" id="srcline250">250</a></span><span class="line">            <span class="mxinfo " id="T5:U822"><span class="mxinfo " id="T5:U823"><span class="var type1" id="S56T1U1146">b</span>(<span class="mxinfo " id="T27:U825"><span class="var type1" id="S61T3U1148">pos_A</span>:<span class="mxinfo " id="T3:U827"><span class="var type1" id="S61T3U1150">pos_A</span> + 1</span></span>)</span> = <span class="mxinfo " id="T27:U829">[<span class="mxinfo " id="T3:U830">-<span class="mxinfo " id="T3:U831"><span class="mxinfo " id="T26:U832"><span class="var type1" id="S2T4U1157">thruster_data</span>(<span class="var type1" id="S37T3U1158">j</span>)</span>.Tplus</span></span>; <span class="mxinfo " id="T3:U835"><span class="mxinfo " id="T26:U836"><span class="var type1" id="S2T4U1163">thruster_data</span>(<span class="var type1" id="S37T3U1164">j</span>)</span>.T_</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,251" id="srcline251">251</a></span><span class="line">            <span class="comment">%             check_rudder_constr(thruster_data(j).Tmax*[-1 -1;-1 1;1 1;1 -1],A(pos_A:pos_A + 1, <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="86,252" id="srcline252">252</a></span><span class="line">            <span class="comment">%                 numOfAzi * 2 + numOfTunnel * 2 + numOfFpp * 2 + 1:numOfAzi * 2 + numOfTunnel * 2 + numOfFpp * 2 + 2), <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="86,253" id="srcline253">253</a></span><span class="line">            <span class="comment">%                 b(pos_A:pos_A + 1));</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,254" id="srcline254">254</a></span><span class="line">            <span class="mxinfo " id="T3:U839"><span class="var type1" id="S57T3U1168">i_H</span> = <span class="mxinfo " id="T3:U841"><span class="var type1" id="S57T3U1170">i_H</span> + <span class="mxinfo " id="T3:U843">2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,255" id="srcline255">255</a></span><span class="line">            <span class="mxinfo " id="T3:U844"><span class="var type1" id="S61T3U1174">pos_A</span> = <span class="mxinfo " id="T3:U846"><span class="var type1" id="S61T3U1176">pos_A</span> + <span class="mxinfo " id="T3:U848">2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,256" id="srcline256">256</a></span><span class="line">            <span class="mxinfo " id="T3:U849"><span class="var type1" id="S62T3U1180">pos_Aeq</span> = <span class="mxinfo " id="T3:U851"><span class="var type1" id="S62T3U1182">pos_Aeq</span> + <span class="mxinfo " id="T3:U853">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,257" id="srcline257">257</a></span><span class="line">            <span class="mxinfo " id="T3:U854"><span class="var type1" id="S58T3U1186">numOfTunnel</span> = <span class="mxinfo " id="T3:U856"><span class="var type1" id="S58T3U1188">numOfTunnel</span> + <span class="mxinfo " id="T3:U858">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,258" id="srcline258">258</a></span><span class="line">        <span class="keyword">case</span> <span class="mxinfo " id="T3:U859">3</span>  <span class="comment">%azi</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,259" id="srcline259">259</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo " id="T7:U860"><span class="var type1" id="S11T7U1195">init</span> == <span class="mxinfo " id="T7:U862">true</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="86,260" id="srcline260">260</a></span><span class="line">            <span class="mxinfo " id="T3:U863"><span class="mxinfo " id="T3:U864"><span class="var type1" id="S49T28U1201">H</span>(<span class="var type1" id="S57T3U1202">i_H</span>,<span class="var type1" id="S57T3U1203">i_H</span>)</span> = <span class="mxinfo " id="T3:U868"><span class="mxinfo " id="T3:U869"><span class="mxinfo " id="T5:U870"><span class="mxinfo " id="T26:U871"><span class="var type1" id="S2T4U1208">thruster_data</span>(<span class="var type1" id="S37T3U1209">j</span>)</span>.weight</span>(<span class="mxinfo " id="T3:U874">1</span>)</span> * <span class="mxinfo " id="T3:U875"><span class="mxinfo " id="T3:U876"><span class="mxinfo " id="T26:U877"><span class="var type1" id="S2T4U1215">thruster_data</span>(<span class="var type1" id="S37T3U1216">j</span>)</span>.Tmax</span>^4</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,261" id="srcline261">261</a></span><span class="line">            <span class="mxinfo " id="T3:U880"><span class="mxinfo " id="T3:U881"><span class="var type1" id="S49T28U1222">H</span>(<span class="mxinfo " id="T3:U883"><span class="var type1" id="S57T3U1224">i_H</span> + <span class="mxinfo " id="T3:U885">1</span></span>,<span class="mxinfo " id="T3:U886"><span class="var type1" id="S57T3U1227">i_H</span> + <span class="mxinfo " id="T3:U888">1</span></span>)</span> = <span class="mxinfo " id="T3:U889"><span class="mxinfo " id="T3:U890"><span class="mxinfo " id="T5:U891"><span class="mxinfo " id="T26:U892"><span class="var type1" id="S2T4U1233">thruster_data</span>(<span class="var type1" id="S37T3U1234">j</span>)</span>.weight</span>(<span class="mxinfo " id="T3:U895">2</span>)</span> * <span class="mxinfo " id="T3:U896"><span class="mxinfo " id="T3:U897"><span class="mxinfo " id="T26:U898"><span class="var type1" id="S2T4U1240">thruster_data</span>(<span class="var type1" id="S37T3U1241">j</span>)</span>.Tmax</span>^4</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,262" id="srcline262">262</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,263" id="srcline263">263</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="86,264" id="srcline264">264</a></span><span class="line">            <span class="mxinfo " id="T3:U901"><span class="var type1" id="S68T3U1246">temp</span> = <span class="mxinfo " id="T3:U903"><span class="mxinfo " id="T3:U904"><span class="mxinfo " id="T3:U905"><span class="var type1" id="S59T3U1250">numOfAzi</span> * <span class="mxinfo " id="T3:U907">2</span></span> + <span class="mxinfo " id="T3:U908"><span class="var type1" id="S58T3U1253">numOfTunnel</span> * <span class="mxinfo " id="T3:U910">2</span></span></span> + <span class="mxinfo " id="T3:U911"><span class="var type1" id="S60T3U1256">numOfFpp</span> * <span class="mxinfo " id="T3:U913">2</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,265" id="srcline265">265</a></span><span class="line">            <span class="mxinfo " id="T103:U914"><span class="mxinfo " id="T103:U915"><span class="var type1" id="S52T28U1261">Aeq</span>(<span class="mxinfo " id="T11:U917"><span class="mxinfo " id="T3:U918">1</span>:<span class="mxinfo " id="T3:U919">3</span></span>,<span class="mxinfo " id="T27:U920"><span class="mxinfo " id="T3:U921"><span class="var type1" id="S68T3U1267">temp</span> + 1</span>:<span class="mxinfo " id="T3:U923"><span class="var type1" id="S68T3U1270">temp</span> + 2</span></span>)</span> = <span class="mxinfo " id="T103:U925"><span class="mxinfo " id="T103:U926">[<span class="mxinfo " id="T5:U927"><span class="mxinfo " id="T3:U928"><span class="var type1" id="S63T32U1276">eff_all</span>(<span class="var type1" id="S37T3U1277">j</span>)</span> <span class="mxinfo " id="T3:U931">0</span></span>;<span class="mxinfo " id="T5:U932"><span class="mxinfo " id="T3:U933">0</span> <span class="mxinfo " id="T3:U934"><span class="var type1" id="S63T32U1282">eff_all</span>(<span class="var type1" id="S37T3U1283">j</span>)</span></span>; <span class="mxinfo " id="T5:U937"><span class="mxinfo " id="T3:U938"><span class="mxinfo " id="T3:U939">- <span class="mxinfo " id="T3:U940"><span class="mxinfo " id="T26:U941"><span class="var type1" id="S2T4U1289">thruster_data</span>(<span class="var type1" id="S37T3U1290">j</span>)</span>.y</span></span> + <span class="mxinfo " id="T3:U944"><span class="mxinfo " id="T26:U945"><span class="var type1" id="S2T4U1294">thruster_data</span>(<span class="var type1" id="S37T3U1295">j</span>)</span>.y0</span></span> <span class="mxinfo " id="T3:U948"><span class="mxinfo " id="T3:U949"><span class="mxinfo " id="T26:U950"><span class="var type1" id="S2T4U1300">thruster_data</span>(<span class="var type1" id="S37T3U1301">j</span>)</span>.x</span> - <span class="mxinfo " id="T3:U953"><span class="mxinfo " id="T26:U954"><span class="var type1" id="S2T4U1305">thruster_data</span>(<span class="var type1" id="S37T3U1306">j</span>)</span>.x0</span></span></span>]</span> * <span class="mxinfo " id="T3:U957"><span class="mxinfo " id="T3:U958"><span class="mxinfo " id="T26:U959"><span class="var type1" id="S2T4U1311">thruster_data</span>(<span class="var type1" id="S37T3U1312">j</span>)</span>.Tmax</span>^2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,266" id="srcline266">266</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo " id="T7:U962"><span class="mxinfo " id="T3:U963"><span class="mxinfo " id="T26:U964"><span class="var type1" id="S2T4U1321">thruster_data</span>(<span class="var type1" id="S37T3U1322">j</span>)</span>.constr</span> == <span class="mxinfo " id="T3:U967">2</span></span> || <span class="mxinfo " id="T7:U968"><span class="mxinfo " id="T3:U969"><span class="mxinfo " id="T26:U970"><span class="var type1" id="S2T4U1328">thruster_data</span>(<span class="var type1" id="S37T3U1329">j</span>)</span>.constr</span> == <span class="mxinfo " id="T3:U973">3</span></span> <span class="comment">% there is constraint</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,267" id="srcline267">267</a></span><span class="line">                <span class="mxinfo " id="T104:U974"><span class="mxinfo " id="T104:U975"><span class="var type1" id="S55T28U1335">A</span>(<span class="mxinfo " id="T105:U977"><span class="var type1" id="S61T3U1337">pos_A</span>:<span class="mxinfo " id="T3:U979"><span class="var type1" id="S61T3U1339">pos_A</span> + 4</span></span>,<span class="mxinfo " id="T27:U981"><span class="mxinfo " id="T3:U982"><span class="var type1" id="S68T3U1343">temp</span> + 1</span> : <span class="mxinfo " id="T3:U984"><span class="var type1" id="S68T3U1346">temp</span> + 2</span></span>)</span> = <span class="mxinfo " id="T104:U986"><span class="mxinfo " id="T104:U987">[<span class="mxinfo " id="T5:U988"><span class="mxinfo " id="T3:U989">-<span class="mxinfo " id="T3:U990">sin(<span class="mxinfo " id="T3:U991"><span class="mxinfo " id="T26:U992"><span class="var type1" id="S2T4U1356">thruster_data</span>(<span class="var type1" id="S37T3U1357">j</span>)</span>.phi_</span>)</span></span> <span class="mxinfo " id="T3:U995">cos(<span class="mxinfo " id="T3:U996"><span class="mxinfo " id="T26:U997"><span class="var type1" id="S2T4U1363">thruster_data</span>(<span class="var type1" id="S37T3U1364">j</span>)</span>.phi_</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="86,268" id="srcline268">268</a></span><span class="line">                    <span class="mxinfo " id="T5:U1000"><span class="mxinfo " id="T3:U1001">sin(<span class="mxinfo " id="T3:U1002"><span class="mxinfo " id="T26:U1003"><span class="var type1" id="S2T4U1371">thruster_data</span>(<span class="var type1" id="S37T3U1372">j</span>)</span>.phiPlus</span>)</span> <span class="mxinfo " id="T3:U1006">-<span class="mxinfo " id="T3:U1007">cos(<span class="mxinfo " id="T3:U1008"><span class="mxinfo " id="T26:U1009"><span class="var type1" id="S2T4U1379">thruster_data</span>(<span class="var type1" id="S37T3U1380">j</span>)</span>.phiPlus</span>)</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="86,269" id="srcline269">269</a></span><span class="line">                    <span class="mxinfo " id="T5:U1012"><span class="mxinfo " id="T3:U1013">cos(<span class="mxinfo " id="T3:U1014"><span class="mxinfo " id="T26:U1015"><span class="var type1" id="S2T4U1387">thruster_data</span>(<span class="var type1" id="S37T3U1388">j</span>)</span>.phi</span>)</span> <span class="mxinfo " id="T3:U1018">sin(<span class="mxinfo " id="T3:U1019"><span class="mxinfo " id="T26:U1020"><span class="var type1" id="S2T4U1394">thruster_data</span>(<span class="var type1" id="S37T3U1395">j</span>)</span>.phi</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="86,270" id="srcline270">270</a></span><span class="line">                    <span class="mxinfo " id="T5:U1023"><span class="mxinfo " id="T3:U1024">-<span class="mxinfo " id="T3:U1025">cos(<span class="mxinfo " id="T3:U1026"><span class="mxinfo " id="T26:U1027"><span class="var type1" id="S2T4U1403">thruster_data</span>(<span class="var type1" id="S37T3U1404">j</span>)</span>.phi_</span>)</span></span> <span class="mxinfo " id="T3:U1030">-<span class="mxinfo " id="T3:U1031">sin(<span class="mxinfo " id="T3:U1032"><span class="mxinfo " id="T26:U1033"><span class="var type1" id="S2T4U1411">thruster_data</span>(<span class="var type1" id="S37T3U1412">j</span>)</span>.phi_</span>)</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="86,271" id="srcline271">271</a></span><span class="line">                    <span class="mxinfo " id="T5:U1036"><span class="mxinfo " id="T3:U1037">-<span class="mxinfo " id="T3:U1038">cos(<span class="mxinfo " id="T3:U1039"><span class="mxinfo " id="T26:U1040"><span class="var type1" id="S2T4U1420">thruster_data</span>(<span class="var type1" id="S37T3U1421">j</span>)</span>.phiPlus</span>)</span></span> <span class="mxinfo " id="T3:U1043">-<span class="mxinfo " id="T3:U1044">sin(<span class="mxinfo " id="T3:U1045"><span class="mxinfo " id="T26:U1046"><span class="var type1" id="S2T4U1428">thruster_data</span>(<span class="var type1" id="S37T3U1429">j</span>)</span>.phiPlus</span>)</span></span></span>]</span> * <span class="mxinfo " id="T3:U1049"><span class="mxinfo " id="T3:U1050"><span class="mxinfo " id="T26:U1051"><span class="var type1" id="S2T4U1434">thruster_data</span>(<span class="var type1" id="S37T3U1435">j</span>)</span>.Tmax</span>^2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,272" id="srcline272">272</a></span><span class="line">                <span class="mxinfo " id="T106:U1054"><span class="mxinfo " id="T106:U1055"><span class="var type1" id="S56T1U1441">b</span>(<span class="mxinfo " id="T105:U1057"><span class="var type1" id="S61T3U1443">pos_A</span> : <span class="mxinfo " id="T3:U1059"><span class="var type1" id="S61T3U1445">pos_A</span> + 4</span></span>)</span> = <span class="mxinfo " id="T105:U1061">[<span class="mxinfo " id="T3:U1062"><span class="mxinfo " id="T3:U1063"><span class="mxinfo " id="T3:U1064">-<span class="var type1" id="S30T3U1452">c2</span></span> * <span class="mxinfo " id="T3:U1066">abs(<span class="mxinfo " id="T3:U1067">cos(<span class="mxinfo " id="T3:U1068"><span class="mxinfo " id="T26:U1069"><span class="var type1" id="S2T4U1459">thruster_data</span>(<span class="var type1" id="S37T3U1460">j</span>)</span>.phi_</span>)</span>)</span></span> * <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,273" id="srcline273">273</a></span><span class="line">                    (<span class="mxinfo " id="T3:U1072"><span class="mxinfo " id="T3:U1073"><span class="mxinfo " id="T26:U1074"><span class="var type1" id="S2T4U1466">thruster_data</span>(<span class="var type1" id="S37T3U1467">j</span>)</span>.Tplus</span> - <span class="mxinfo " id="T3:U1077"><span class="mxinfo " id="T26:U1078"><span class="var type1" id="S2T4U1471">thruster_data</span>(<span class="var type1" id="S37T3U1472">j</span>)</span>.T_</span></span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,274" id="srcline274">274</a></span><span class="line">                    <span class="mxinfo " id="T3:U1081"><span class="mxinfo " id="T3:U1082"><span class="mxinfo " id="T3:U1083">-<span class="var type1" id="S30T3U1478">c2</span></span> * <span class="mxinfo " id="T3:U1085">abs(<span class="mxinfo " id="T3:U1086">cos(<span class="mxinfo " id="T3:U1087"><span class="mxinfo " id="T26:U1088"><span class="var type1" id="S2T4U1485">thruster_data</span>(<span class="var type1" id="S37T3U1486">j</span>)</span>.phiPlus</span>)</span>)</span></span> * <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,275" id="srcline275">275</a></span><span class="line">                    (<span class="mxinfo " id="T3:U1091"><span class="mxinfo " id="T3:U1092"><span class="mxinfo " id="T26:U1093"><span class="var type1" id="S2T4U1492">thruster_data</span>(<span class="var type1" id="S37T3U1493">j</span>)</span>.Tplus</span> - <span class="mxinfo " id="T3:U1096"><span class="mxinfo " id="T26:U1097"><span class="var type1" id="S2T4U1497">thruster_data</span>(<span class="var type1" id="S37T3U1498">j</span>)</span>.T_</span></span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,276" id="srcline276">276</a></span><span class="line">                    <span class="mxinfo " id="T3:U1100"><span class="mxinfo " id="T26:U1101"><span class="var type1" id="S2T4U1503">thruster_data</span>(<span class="var type1" id="S37T3U1504">j</span>)</span>.T_</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,277" id="srcline277">277</a></span><span class="line">                    <span class="mxinfo " id="T3:U1104"><span class="mxinfo " id="T3:U1105">-<span class="mxinfo " id="T3:U1106">cos(<span class="mxinfo " id="T3:U1107"><span class="mxinfo " id="T3:U1108"><span class="mxinfo " id="T26:U1109"><span class="var type1" id="S2T4U1514">thruster_data</span>(<span class="var type1" id="S37T3U1515">j</span>)</span>.phi_</span> - <span class="mxinfo " id="T3:U1112"><span class="mxinfo " id="T26:U1113"><span class="var type1" id="S2T4U1519">thruster_data</span>(<span class="var type1" id="S37T3U1520">j</span>)</span>.phi</span></span>)</span></span> * <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,278" id="srcline278">278</a></span><span class="line">                    <span class="mxinfo " id="T3:U1116"><span class="mxinfo " id="T26:U1117"><span class="var type1" id="S2T4U1524">thruster_data</span>(<span class="var type1" id="S37T3U1525">j</span>)</span>.Tplus</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="86,279" id="srcline279">279</a></span><span class="line">                    <span class="mxinfo " id="T3:U1120"><span class="mxinfo " id="T3:U1121">-<span class="mxinfo " id="T3:U1122">cos(<span class="mxinfo " id="T3:U1123"><span class="mxinfo " id="T3:U1124"><span class="mxinfo " id="T26:U1125"><span class="var type1" id="S2T4U1535">thruster_data</span>(<span class="var type1" id="S37T3U1536">j</span>)</span>.phiPlus</span> - <span class="mxinfo " id="T3:U1128"><span class="mxinfo " id="T26:U1129"><span class="var type1" id="S2T4U1540">thruster_data</span>(<span class="var type1" id="S37T3U1541">j</span>)</span>.phi</span></span>)</span></span> * <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,280" id="srcline280">280</a></span><span class="line">                    <span class="mxinfo " id="T3:U1132"><span class="mxinfo " id="T26:U1133"><span class="var type1" id="S2T4U1545">thruster_data</span>(<span class="var type1" id="S37T3U1546">j</span>)</span>.Tplus</span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,281" id="srcline281">281</a></span><span class="line"><span class="comment">%                 if init == true</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,282" id="srcline282">282</a></span><span class="line">                    <span class="mxinfo " id="T107:U1136"><span class="mxinfo " id="T107:U1137"><span class="var type1" id="S55T28U1551">A</span>(<span class="mxinfo " id="T1:U1139"><span class="mxinfo " id="T3:U1140"><span class="mxinfo " id="T3:U1141"><span class="var type1" id="S61T3U1555">pos_A</span> + <span class="mxinfo " id="T3:U1143">4</span></span> + 1</span>:<span class="mxinfo " id="T3:U1144"><span class="var type1" id="S61T3U1560">pos_A</span> + 4 + <span class="var type1" id="S22T3U1562">NA_azi</span></span></span>,<span class="mxinfo " id="T27:U1147"><span class="mxinfo " id="T3:U1148"><span class="var type1" id="S68T3U1565">temp</span> + 1</span>:<span class="mxinfo " id="T3:U1150"><span class="var type1" id="S68T3U1568">temp</span> + 2</span></span>)</span> = <span class="mxinfo " id="T99:U1152"><span class="var type1" id="S21T99U1571">A_azi</span> * <span class="mxinfo " id="T3:U1154"><span class="mxinfo " id="T3:U1155"><span class="mxinfo " id="T26:U1156"><span class="var type1" id="S2T4U1575">thruster_data</span>(<span class="var type1" id="S37T3U1576">j</span>)</span>.Tmax</span>^2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,283" id="srcline283">283</a></span><span class="line">                    <span class="mxinfo " id="T32:U1159"><span class="mxinfo " id="T32:U1160"><span class="var type1" id="S56T1U1582">b</span>(<span class="mxinfo " id="T1:U1162"><span class="mxinfo " id="T3:U1163"><span class="mxinfo " id="T3:U1164"><span class="var type1" id="S61T3U1586">pos_A</span> + <span class="mxinfo " id="T3:U1166">4</span></span> + 1</span>:<span class="mxinfo " id="T3:U1167"><span class="var type1" id="S61T3U1591">pos_A</span> + 4 + <span class="var type1" id="S22T3U1593">NA_azi</span></span></span>)</span> = <span class="mxinfo " id="T3:U1170"><span class="mxinfo " id="T3:U1171">- <span class="mxinfo " id="T3:U1172"><span class="mxinfo " id="T26:U1173"><span class="var type1" id="S2T4U1598">thruster_data</span>(<span class="var type1" id="S37T3U1599">j</span>)</span>.Tmax</span></span> * <span class="mxinfo " id="T3:U1176">cos(<span class="mxinfo " id="T3:U1177"><span class="mxinfo " id="T3:U1178">pi</span> / <span class="var type1" id="S22T3U1606">NA_azi</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,284" id="srcline284">284</a></span><span class="line"><span class="comment">%                 end</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,285" id="srcline285">285</a></span><span class="line">            <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,286" id="srcline286">286</a></span><span class="line"><span class="comment">%                 if init == true</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,287" id="srcline287">287</a></span><span class="line">                    <span class="mxinfo " id="T107:U1180"><span class="mxinfo " id="T107:U1181"><span class="var type1" id="S55T28U1611">A</span>(<span class="mxinfo " id="T1:U1183"><span class="mxinfo " id="T3:U1184"><span class="mxinfo " id="T3:U1185"><span class="var type1" id="S61T3U1615">pos_A</span> - <span class="mxinfo " id="T3:U1187">1</span></span> + 1</span> : <span class="mxinfo " id="T3:U1188"><span class="var type1" id="S61T3U1620">pos_A</span> - 1 + <span class="var type1" id="S22T3U1622">NA_azi</span></span></span>,<span class="mxinfo " id="T27:U1191"><span class="mxinfo " id="T3:U1192"><span class="var type1" id="S68T3U1625">temp</span> + 1</span>:<span class="mxinfo " id="T3:U1194"><span class="var type1" id="S68T3U1628">temp</span> + 2</span></span>)</span> = <span class="mxinfo " id="T99:U1196"><span class="var type1" id="S21T99U1631">A_azi</span> * <span class="mxinfo " id="T3:U1198"><span class="mxinfo " id="T3:U1199"><span class="mxinfo " id="T26:U1200"><span class="var type1" id="S2T4U1635">thruster_data</span>(<span class="var type1" id="S37T3U1636">j</span>)</span>.Tmax</span>^2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,288" id="srcline288">288</a></span><span class="line">                    </span></span>
<span class="srcline"><span class="lineno"><a href="86,289" id="srcline289">289</a></span><span class="line">                    <span class="mxinfo " id="T32:U1203"><span class="mxinfo " id="T32:U1204"><span class="var type1" id="S56T1U1642">b</span>(<span class="mxinfo " id="T1:U1206"><span class="mxinfo " id="T3:U1207"><span class="mxinfo " id="T3:U1208"><span class="var type1" id="S61T3U1646">pos_A</span> - <span class="mxinfo " id="T3:U1210">1</span></span> + 1</span> : <span class="mxinfo " id="T3:U1211"><span class="var type1" id="S61T3U1651">pos_A</span> - 1 + <span class="var type1" id="S22T3U1653">NA_azi</span></span></span>)</span> = <span class="mxinfo " id="T3:U1214"><span class="mxinfo " id="T3:U1215">- <span class="mxinfo " id="T3:U1216"><span class="mxinfo " id="T26:U1217"><span class="var type1" id="S2T4U1658">thruster_data</span>(<span class="var type1" id="S37T3U1659">j</span>)</span>.Tmax</span></span> * <span class="mxinfo " id="T3:U1220">cos(<span class="mxinfo " id="T3:U1221"><span class="mxinfo " id="T3:U1222">pi</span> / <span class="var type1" id="S22T3U1666">NA_azi</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,290" id="srcline290">290</a></span><span class="line"><span class="comment">%                 end</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,291" id="srcline291">291</a></span><span class="line">            <span class="keyword">end</span>    </span></span>
<span class="srcline"><span class="lineno"><a href="86,292" id="srcline292">292</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="86,293" id="srcline293">293</a></span><span class="line">            <span class="comment">%             check_rudder_constr(thruster_data(j).Tmax*[-1 -1;-1 1;1 1;1 -1],A(pos_A:pos_A + 4, <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="86,294" id="srcline294">294</a></span><span class="line">            <span class="comment">%                 numOfAzi * 2 + numOfTunnel * 2 + numOfFpp * 2 + 1:numOfAzi * 2 + numOfTunnel * 2 + numOfFpp * 2 + 2), <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="86,295" id="srcline295">295</a></span><span class="line">            <span class="comment">%                 b(pos_A:pos_A + 4));%azi</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,296" id="srcline296">296</a></span><span class="line">            <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,297" id="srcline297">297</a></span><span class="line">            <span class="comment">%                     check_rudder_constr(thruster_data(j).Tmax*[-1 -1;-1 1;1 1;1 -1],A(pos_A + 4 + 1:pos_A + 4 + i_Azi, <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="86,298" id="srcline298">298</a></span><span class="line">            <span class="comment">%                         numOfAzi * 2 + numOfTunnel * 2 + numOfFpp * 2 + 1:numOfAzi * 2 + numOfTunnel * 2 + numOfFpp * 2 + 2), <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="86,299" id="srcline299">299</a></span><span class="line">            <span class="comment">%                         b(pos_A + 4 + 1:pos_A + 4 + i_Azi));</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,300" id="srcline300">300</a></span><span class="line">            <span class="comment">%         check_rudder_constr(thruster_data(j).Tmax*[-1 -1;-1 1;1 1;1 -1],A(pos_A:pos_A + 4 + i_Azi, <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="86,301" id="srcline301">301</a></span><span class="line">            <span class="comment">%             numOfAzi * 2 + numOfTunnel * 2 + numOfFpp * 2 + 1:numOfAzi * 2 + numOfTunnel * 2 + numOfFpp * 2 + 2), <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="86,302" id="srcline302">302</a></span><span class="line">            <span class="comment">%             b(pos_A:pos_A + 4 + i_Azi));</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,303" id="srcline303">303</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo " id="T7:U1224"><span class="mxinfo " id="T3:U1225"><span class="mxinfo " id="T26:U1226"><span class="var type1" id="S2T4U1673">thruster_data</span>(<span class="var type1" id="S37T3U1674">j</span>)</span>.constr</span> == <span class="mxinfo " id="T3:U1229">2</span></span> || <span class="mxinfo " id="T7:U1230"><span class="mxinfo " id="T3:U1231"><span class="mxinfo " id="T26:U1232"><span class="var type1" id="S2T4U1680">thruster_data</span>(<span class="var type1" id="S37T3U1681">j</span>)</span>.constr</span> == <span class="mxinfo " id="T3:U1235">3</span></span> <span class="comment">% there is constraint </span></span></span>
<span class="srcline"><span class="lineno"><a href="86,304" id="srcline304">304</a></span><span class="line">                <span class="mxinfo " id="T3:U1236"><span class="var type1" id="S61T3U1686">pos_A</span> = <span class="mxinfo " id="T3:U1238"><span class="mxinfo " id="T3:U1239"><span class="var type1" id="S61T3U1689">pos_A</span> + <span class="mxinfo " id="T3:U1241">5</span></span> + <span class="var type1" id="S22T3U1691">NA_azi</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,305" id="srcline305">305</a></span><span class="line">            <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,306" id="srcline306">306</a></span><span class="line">                <span class="mxinfo " id="T3:U1243"><span class="var type1" id="S61T3U1695">pos_A</span> = <span class="mxinfo " id="T3:U1245"><span class="var type1" id="S61T3U1697">pos_A</span> + <span class="var type1" id="S22T3U1698">NA_azi</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,307" id="srcline307">307</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,308" id="srcline308">308</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="86,309" id="srcline309">309</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="86,310" id="srcline310">310</a></span><span class="line">            <span class="mxinfo " id="T3:U1248"><span class="var type1" id="S57T3U1701">i_H</span> = <span class="mxinfo " id="T3:U1250"><span class="var type1" id="S57T3U1703">i_H</span> + <span class="mxinfo " id="T3:U1252">2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,311" id="srcline311">311</a></span><span class="line">            <span class="mxinfo " id="T3:U1253"><span class="var type1" id="S59T3U1707">numOfAzi</span> = <span class="mxinfo " id="T3:U1255"><span class="var type1" id="S59T3U1709">numOfAzi</span> + <span class="mxinfo " id="T3:U1257">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,312" id="srcline312">312</a></span><span class="line">        <span class="keyword">case</span> <span class="mxinfo " id="T3:U1258">2</span> <span class="comment">%fpp</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,313" id="srcline313">313</a></span><span class="line">            <span class="mxinfo " id="T3:U1259">[<span class="var type1" id="S23T100U1716">A_fpp</span>,<span class="var type1" id="S24T101U1717">b_fpp</span>,<span class="mxinfo " id="T3:U1262">~</span>] = <span class="fcn" id="F276N16:B1720">N_sided_rudder</span>(<span class="mxinfo " id="T102:U1263"><span class="mxinfo " id="T3:U1264"><span class="mxinfo " id="T26:U1265"><span class="var type1" id="S2T4U1724">thruster_data</span>(<span class="var type1" id="S37T3U1725">j</span>)</span>.Tmax</span> * <span class="mxinfo " id="T102:U1268"><span class="var type1" id="S16T10U1728">rudder_table</span>(<span class="mxinfo " id="T16:U1270">:</span>,<span class="mxinfo " id="T18:U1271">2:3</span>)</span></span>)</span>;<span class="comment">%x,y</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,314" id="srcline314">314</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo " id="T7:U1272"><span class="var type1" id="S11T7U1736">init</span> == <span class="mxinfo " id="T7:U1274">true</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="86,315" id="srcline315">315</a></span><span class="line">            <span class="mxinfo " id="T3:U1275"><span class="mxinfo " id="T3:U1276"><span class="var type1" id="S49T28U1742">H</span>(<span class="var type1" id="S57T3U1743">i_H</span>,<span class="var type1" id="S57T3U1744">i_H</span>)</span> = <span class="mxinfo " id="T3:U1280"><span class="mxinfo " id="T3:U1281"><span class="mxinfo " id="T5:U1282"><span class="mxinfo " id="T26:U1283"><span class="var type1" id="S2T4U1749">thruster_data</span>(<span class="var type1" id="S37T3U1750">j</span>)</span>.weight</span>(<span class="mxinfo " id="T3:U1286">1</span>)</span> * <span class="mxinfo " id="T3:U1287"><span class="mxinfo " id="T3:U1288"><span class="mxinfo " id="T26:U1289"><span class="var type1" id="S2T4U1756">thruster_data</span>(<span class="var type1" id="S37T3U1757">j</span>)</span>.Tmax</span>^4</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,316" id="srcline316">316</a></span><span class="line">            <span class="mxinfo " id="T3:U1292"><span class="mxinfo " id="T3:U1293"><span class="var type1" id="S49T28U1763">H</span>(<span class="mxinfo " id="T3:U1295"><span class="var type1" id="S57T3U1765">i_H</span> + <span class="mxinfo " id="T3:U1297">1</span></span>,<span class="mxinfo " id="T3:U1298"><span class="var type1" id="S57T3U1768">i_H</span> + <span class="mxinfo " id="T3:U1300">1</span></span>)</span> = <span class="mxinfo " id="T3:U1301"><span class="mxinfo " id="T3:U1302"><span class="mxinfo " id="T5:U1303"><span class="mxinfo " id="T26:U1304"><span class="var type1" id="S2T4U1774">thruster_data</span>(<span class="var type1" id="S37T3U1775">j</span>)</span>.weight</span>(<span class="mxinfo " id="T3:U1307">2</span>)</span> * <span class="mxinfo " id="T3:U1308"><span class="mxinfo " id="T3:U1309"><span class="mxinfo " id="T26:U1310"><span class="var type1" id="S2T4U1781">thruster_data</span>(<span class="var type1" id="S37T3U1782">j</span>)</span>.Tmax</span>^4</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,317" id="srcline317">317</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,318" id="srcline318">318</a></span><span class="line">            <span class="mxinfo " id="T3:U1313"><span class="var type1" id="S68T3U1787">temp</span> = <span class="mxinfo " id="T3:U1315"><span class="mxinfo " id="T3:U1316"><span class="mxinfo " id="T3:U1317"><span class="var type1" id="S59T3U1791">numOfAzi</span> * <span class="mxinfo " id="T3:U1319">2</span></span> + <span class="mxinfo " id="T3:U1320"><span class="var type1" id="S58T3U1794">numOfTunnel</span> * <span class="mxinfo " id="T3:U1322">2</span></span></span> + <span class="mxinfo " id="T3:U1323"><span class="var type1" id="S60T3U1797">numOfFpp</span> * <span class="mxinfo " id="T3:U1325">2</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,319" id="srcline319">319</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo " id="T7:U1326"><span class="var type1" id="S11T7U1802">init</span> == <span class="mxinfo " id="T7:U1328">true</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="86,320" id="srcline320">320</a></span><span class="line">            <span class="mxinfo " id="T103:U1329"><span class="mxinfo " id="T103:U1330"><span class="var type1" id="S52T28U1808">Aeq</span>(<span class="mxinfo " id="T11:U1332"><span class="mxinfo " id="T3:U1333">1</span>:<span class="mxinfo " id="T3:U1334">3</span></span>,<span class="mxinfo " id="T27:U1335"><span class="mxinfo " id="T3:U1336"><span class="var type1" id="S68T3U1814">temp</span> + 1</span>:<span class="mxinfo " id="T3:U1338"><span class="var type1" id="S68T3U1817">temp</span> + 2</span></span>)</span> = <span class="mxinfo " id="T103:U1340"><span class="mxinfo " id="T103:U1341">[<span class="mxinfo " id="T5:U1342">1 0</span>;<span class="mxinfo " id="T5:U1343">0 1</span>; <span class="mxinfo " id="T5:U1344"><span class="mxinfo " id="T3:U1345"><span class="mxinfo " id="T3:U1346">- <span class="mxinfo " id="T3:U1347"><span class="mxinfo " id="T26:U1348"><span class="var type1" id="S2T4U1832">thruster_data</span>(<span class="var type1" id="S37T3U1833">j</span>)</span>.y</span></span> + <span class="mxinfo " id="T3:U1351"><span class="mxinfo " id="T26:U1352"><span class="var type1" id="S2T4U1837">thruster_data</span>(<span class="var type1" id="S37T3U1838">j</span>)</span>.y0</span></span> <span class="mxinfo " id="T3:U1355"><span class="mxinfo " id="T3:U1356"><span class="mxinfo " id="T26:U1357"><span class="var type1" id="S2T4U1843">thruster_data</span>(<span class="var type1" id="S37T3U1844">j</span>)</span>.x</span> - <span class="mxinfo " id="T3:U1360"><span class="mxinfo " id="T26:U1361"><span class="var type1" id="S2T4U1848">thruster_data</span>(<span class="var type1" id="S37T3U1849">j</span>)</span>.x0</span></span></span>]</span> * <span class="mxinfo " id="T3:U1364"><span class="mxinfo " id="T3:U1365"><span class="mxinfo " id="T26:U1366"><span class="var type1" id="S2T4U1854">thruster_data</span>(<span class="var type1" id="S37T3U1855">j</span>)</span>.Tmax</span>^2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,321" id="srcline321">321</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,322" id="srcline322">322</a></span><span class="line">            <span class="mxinfo " id="T104:U1369"><span class="mxinfo " id="T104:U1370"><span class="var type1" id="S55T28U1861">A</span>(<span class="mxinfo " id="T105:U1372"><span class="var type1" id="S61T3U1863">pos_A</span>:<span class="mxinfo " id="T3:U1374"><span class="var type1" id="S61T3U1865">pos_A</span> + 4</span></span>,<span class="mxinfo " id="T27:U1376"><span class="mxinfo " id="T3:U1377"><span class="var type1" id="S68T3U1869">temp</span> + 1</span> : <span class="mxinfo " id="T3:U1379"><span class="var type1" id="S68T3U1872">temp</span> + 2</span></span>)</span> = <span class="mxinfo " id="T104:U1381"><span class="mxinfo " id="T104:U1382">[<span class="mxinfo " id="T5:U1383"><span class="mxinfo " id="T3:U1384">-<span class="mxinfo " id="T3:U1385">sin(<span class="mxinfo " id="T3:U1386"><span class="mxinfo " id="T26:U1387"><span class="var type1" id="S2T4U1882">thruster_data</span>(<span class="var type1" id="S37T3U1883">j</span>)</span>.phi_</span>)</span></span> <span class="mxinfo " id="T3:U1390">cos(<span class="mxinfo " id="T3:U1391"><span class="mxinfo " id="T26:U1392"><span class="var type1" id="S2T4U1889">thruster_data</span>(<span class="var type1" id="S37T3U1890">j</span>)</span>.phi_</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="86,323" id="srcline323">323</a></span><span class="line">                    <span class="mxinfo " id="T5:U1395"><span class="mxinfo " id="T3:U1396">sin(<span class="mxinfo " id="T3:U1397"><span class="mxinfo " id="T26:U1398"><span class="var type1" id="S2T4U1897">thruster_data</span>(<span class="var type1" id="S37T3U1898">j</span>)</span>.phiPlus</span>)</span> <span class="mxinfo " id="T3:U1401">-<span class="mxinfo " id="T3:U1402">cos(<span class="mxinfo " id="T3:U1403"><span class="mxinfo " id="T26:U1404"><span class="var type1" id="S2T4U1905">thruster_data</span>(<span class="var type1" id="S37T3U1906">j</span>)</span>.phiPlus</span>)</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="86,324" id="srcline324">324</a></span><span class="line">                    <span class="mxinfo " id="T5:U1407"><span class="mxinfo " id="T3:U1408">cos(<span class="mxinfo " id="T3:U1409"><span class="mxinfo " id="T26:U1410"><span class="var type1" id="S2T4U1913">thruster_data</span>(<span class="var type1" id="S37T3U1914">j</span>)</span>.phi</span>)</span> <span class="mxinfo " id="T3:U1413">sin(<span class="mxinfo " id="T3:U1414"><span class="mxinfo " id="T26:U1415"><span class="var type1" id="S2T4U1920">thruster_data</span>(<span class="var type1" id="S37T3U1921">j</span>)</span>.phi</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="86,325" id="srcline325">325</a></span><span class="line">                    <span class="mxinfo " id="T5:U1418"><span class="mxinfo " id="T3:U1419">-<span class="mxinfo " id="T3:U1420">cos(<span class="mxinfo " id="T3:U1421"><span class="mxinfo " id="T26:U1422"><span class="var type1" id="S2T4U1929">thruster_data</span>(<span class="var type1" id="S37T3U1930">j</span>)</span>.phi_</span>)</span></span> <span class="mxinfo " id="T3:U1425">-<span class="mxinfo " id="T3:U1426">sin(<span class="mxinfo " id="T3:U1427"><span class="mxinfo " id="T26:U1428"><span class="var type1" id="S2T4U1937">thruster_data</span>(<span class="var type1" id="S37T3U1938">j</span>)</span>.phi_</span>)</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="86,326" id="srcline326">326</a></span><span class="line">                    <span class="mxinfo " id="T5:U1431"><span class="mxinfo " id="T3:U1432">-<span class="mxinfo " id="T3:U1433">cos(<span class="mxinfo " id="T3:U1434"><span class="mxinfo " id="T26:U1435"><span class="var type1" id="S2T4U1946">thruster_data</span>(<span class="var type1" id="S37T3U1947">j</span>)</span>.phiPlus</span>)</span></span> <span class="mxinfo " id="T3:U1438">-<span class="mxinfo " id="T3:U1439">sin(<span class="mxinfo " id="T3:U1440"><span class="mxinfo " id="T26:U1441"><span class="var type1" id="S2T4U1954">thruster_data</span>(<span class="var type1" id="S37T3U1955">j</span>)</span>.phiPlus</span>)</span></span></span>]</span> * <span class="mxinfo " id="T3:U1444"><span class="mxinfo " id="T3:U1445"><span class="mxinfo " id="T26:U1446"><span class="var type1" id="S2T4U1960">thruster_data</span>(<span class="var type1" id="S37T3U1961">j</span>)</span>.Tmax</span>^2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,327" id="srcline327">327</a></span><span class="line">                <span class="mxinfo " id="T106:U1449"><span class="mxinfo " id="T106:U1450"><span class="var type1" id="S56T1U1967">b</span>(<span class="mxinfo " id="T105:U1452"><span class="var type1" id="S61T3U1969">pos_A</span> : <span class="mxinfo " id="T3:U1454"><span class="var type1" id="S61T3U1971">pos_A</span> + 4</span></span>)</span> = <span class="mxinfo " id="T105:U1456">[<span class="mxinfo " id="T3:U1457"><span class="mxinfo " id="T3:U1458"><span class="mxinfo " id="T3:U1459">-<span class="var type1" id="S30T3U1978">c2</span></span> * <span class="mxinfo " id="T3:U1461">abs(<span class="mxinfo " id="T3:U1462">cos(<span class="mxinfo " id="T3:U1463"><span class="mxinfo " id="T26:U1464"><span class="var type1" id="S2T4U1985">thruster_data</span>(<span class="var type1" id="S37T3U1986">j</span>)</span>.phi_</span>)</span>)</span></span> * <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,328" id="srcline328">328</a></span><span class="line">                    (<span class="mxinfo " id="T3:U1467"><span class="mxinfo " id="T3:U1468"><span class="mxinfo " id="T26:U1469"><span class="var type1" id="S2T4U1992">thruster_data</span>(<span class="var type1" id="S37T3U1993">j</span>)</span>.Tplus</span> - <span class="mxinfo " id="T3:U1472"><span class="mxinfo " id="T26:U1473"><span class="var type1" id="S2T4U1997">thruster_data</span>(<span class="var type1" id="S37T3U1998">j</span>)</span>.T_</span></span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,329" id="srcline329">329</a></span><span class="line">                    <span class="mxinfo " id="T3:U1476"><span class="mxinfo " id="T3:U1477"><span class="mxinfo " id="T3:U1478">-<span class="var type1" id="S30T3U2004">c2</span></span> * <span class="mxinfo " id="T3:U1480">abs(<span class="mxinfo " id="T3:U1481">cos(<span class="mxinfo " id="T3:U1482"><span class="mxinfo " id="T26:U1483"><span class="var type1" id="S2T4U2011">thruster_data</span>(<span class="var type1" id="S37T3U2012">j</span>)</span>.phiPlus</span>)</span>)</span></span> * <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,330" id="srcline330">330</a></span><span class="line">                    (<span class="mxinfo " id="T3:U1486"><span class="mxinfo " id="T3:U1487"><span class="mxinfo " id="T26:U1488"><span class="var type1" id="S2T4U2018">thruster_data</span>(<span class="var type1" id="S37T3U2019">j</span>)</span>.Tplus</span> - <span class="mxinfo " id="T3:U1491"><span class="mxinfo " id="T26:U1492"><span class="var type1" id="S2T4U2023">thruster_data</span>(<span class="var type1" id="S37T3U2024">j</span>)</span>.T_</span></span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,331" id="srcline331">331</a></span><span class="line">                    <span class="mxinfo " id="T3:U1495"><span class="mxinfo " id="T26:U1496"><span class="var type1" id="S2T4U2029">thruster_data</span>(<span class="var type1" id="S37T3U2030">j</span>)</span>.T_</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,332" id="srcline332">332</a></span><span class="line">                    <span class="mxinfo " id="T3:U1499"><span class="mxinfo " id="T3:U1500">-<span class="mxinfo " id="T3:U1501">cos(<span class="mxinfo " id="T3:U1502"><span class="mxinfo " id="T3:U1503"><span class="mxinfo " id="T26:U1504"><span class="var type1" id="S2T4U2040">thruster_data</span>(<span class="var type1" id="S37T3U2041">j</span>)</span>.phi_</span> - <span class="mxinfo " id="T3:U1507"><span class="mxinfo " id="T26:U1508"><span class="var type1" id="S2T4U2045">thruster_data</span>(<span class="var type1" id="S37T3U2046">j</span>)</span>.phi</span></span>)</span></span> * <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,333" id="srcline333">333</a></span><span class="line">                    <span class="mxinfo " id="T3:U1511"><span class="mxinfo " id="T26:U1512"><span class="var type1" id="S2T4U2050">thruster_data</span>(<span class="var type1" id="S37T3U2051">j</span>)</span>.Tplus</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="86,334" id="srcline334">334</a></span><span class="line">                    <span class="mxinfo " id="T3:U1515"><span class="mxinfo " id="T3:U1516">-<span class="mxinfo " id="T3:U1517">cos(<span class="mxinfo " id="T3:U1518"><span class="mxinfo " id="T3:U1519"><span class="mxinfo " id="T26:U1520"><span class="var type1" id="S2T4U2061">thruster_data</span>(<span class="var type1" id="S37T3U2062">j</span>)</span>.phiPlus</span> - <span class="mxinfo " id="T3:U1523"><span class="mxinfo " id="T26:U1524"><span class="var type1" id="S2T4U2066">thruster_data</span>(<span class="var type1" id="S37T3U2067">j</span>)</span>.phi</span></span>)</span></span> * <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,335" id="srcline335">335</a></span><span class="line">                    <span class="mxinfo " id="T3:U1527"><span class="mxinfo " id="T26:U1528"><span class="var type1" id="S2T4U2071">thruster_data</span>(<span class="var type1" id="S37T3U2072">j</span>)</span>.Tplus</span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,336" id="srcline336">336</a></span><span class="line">                <span class="keyword">if</span> <span class="mxinfo " id="T7:U1531"><span class="var type1" id="S11T7U2077">init</span> == <span class="mxinfo " id="T7:U1533">true</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="86,337" id="srcline337">337</a></span><span class="line">                 <span class="mxinfo " id="T100:U1534"><span class="mxinfo " id="T100:U1535"><span class="var type1" id="S55T28U2083">A</span>(<span class="mxinfo " id="T101:U1537"><span class="mxinfo " id="T3:U1538"><span class="mxinfo " id="T3:U1539"><span class="var type1" id="S61T3U2087">pos_A</span> + <span class="mxinfo " id="T3:U1541">4</span></span> + 1</span>:<span class="mxinfo " id="T3:U1542"><span class="var type1" id="S61T3U2092">pos_A</span> + 4 + <span class="var type1" id="S15T3U2094">NA_fpp</span></span></span>,<span class="mxinfo " id="T27:U1545"><span class="mxinfo " id="T3:U1546"><span class="var type1" id="S68T3U2097">temp</span> + 1</span>:<span class="mxinfo " id="T3:U1548"><span class="var type1" id="S68T3U2100">temp</span> + 2</span></span>)</span> = <span class="mxinfo " id="T100:U1550"><span class="var type1" id="S23T100U2103">A_fpp</span> * <span class="mxinfo " id="T3:U1552"><span class="mxinfo " id="T3:U1553"><span class="mxinfo " id="T26:U1554"><span class="var type1" id="S2T4U2107">thruster_data</span>(<span class="var type1" id="S37T3U2108">j</span>)</span>.Tmax</span>^2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,338" id="srcline338">338</a></span><span class="line">                    <span class="mxinfo " id="T108:U1557"><span class="mxinfo " id="T108:U1558"><span class="var type1" id="S56T1U2114">b</span>(<span class="mxinfo " id="T101:U1560"><span class="mxinfo " id="T3:U1561"><span class="mxinfo " id="T3:U1562"><span class="var type1" id="S61T3U2118">pos_A</span> + <span class="mxinfo " id="T3:U1564">4</span></span> + 1</span>:<span class="mxinfo " id="T3:U1565"><span class="var type1" id="S61T3U2123">pos_A</span> + 4 + <span class="var type1" id="S15T3U2125">NA_fpp</span></span></span>)</span> = <span class="var type1" id="S24T101U2126">b_fpp</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,339" id="srcline339">339</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,340" id="srcline340">340</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="86,341" id="srcline341">341</a></span><span class="line">            <span class="comment">%         check_rudder_constr(thruster_data(j).Tmax*[-1 -1;-1 1;1 1;1 -1],A(pos_A:pos_A + 4, <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="86,342" id="srcline342">342</a></span><span class="line">            <span class="comment">%             numOfAzi * 2 + numOfTunnel * 2 + numOfFpp * 2 + 1:numOfAzi * 2 + numOfTunnel * 2 + numOfFpp * 2 + 2), <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="86,343" id="srcline343">343</a></span><span class="line">            <span class="comment">%             b(pos_A:pos_A + 4));%fpp</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,344" id="srcline344">344</a></span><span class="line">            <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,345" id="srcline345">345</a></span><span class="line">            <span class="comment">%         check_rudder_constr(thruster_data(j).Tmax*[-1 -1;-1 1;1 1;1 -1],A(pos_A + 4 + 1:pos_A + 4 + i_Fpp, <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="86,346" id="srcline346">346</a></span><span class="line">            <span class="comment">%             numOfAzi * 2 + numOfTunnel * 2 + numOfFpp * 2 + 1:numOfAzi * 2 + numOfTunnel * 2 + numOfFpp * 2 + 2), <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="86,347" id="srcline347">347</a></span><span class="line">            <span class="comment">%             b(pos_A + 4 + 1:pos_A + 4 + i_Fpp));</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,348" id="srcline348">348</a></span><span class="line">            <span class="comment">%             check_rudder_constr(thruster_data(j).Tmax*[-1 -1;-1 1;1 1;1 -1],A(pos_A:pos_A + 4 + i_Fpp, <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="86,349" id="srcline349">349</a></span><span class="line">            <span class="comment">%                 numOfAzi * 2 + numOfTunnel * 2 + numOfFpp * 2 + 1:numOfAzi * 2 + numOfTunnel * 2 + numOfFpp * 2 + 2), <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="86,350" id="srcline350">350</a></span><span class="line">            <span class="comment">%                 b(pos_A:pos_A + 4 + i_Fpp));</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,351" id="srcline351">351</a></span><span class="line">            <span class="mxinfo " id="T3:U1569"><span class="var type1" id="S57T3U2129">i_H</span> = <span class="mxinfo " id="T3:U1571"><span class="var type1" id="S57T3U2131">i_H</span> + <span class="mxinfo " id="T3:U1573">2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,352" id="srcline352">352</a></span><span class="line">            <span class="mxinfo " id="T3:U1574"><span class="var type1" id="S61T3U2135">pos_A</span> = <span class="mxinfo " id="T3:U1576"><span class="mxinfo " id="T3:U1577"><span class="var type1" id="S61T3U2138">pos_A</span> + <span class="mxinfo " id="T3:U1579">5</span></span> + <span class="var type1" id="S15T3U2140">NA_fpp</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,353" id="srcline353">353</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="86,354" id="srcline354">354</a></span><span class="line">            <span class="mxinfo " id="T3:U1581"><span class="var type1" id="S60T3U2143">numOfFpp</span> = <span class="mxinfo " id="T3:U1583"><span class="var type1" id="S60T3U2145">numOfFpp</span> + <span class="mxinfo " id="T3:U1585">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,355" id="srcline355">355</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,356" id="srcline356">356</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,357" id="srcline357">357</a></span><span class="line"><span class="comment">%!!-----------------add bound for s1 s2 s3---does not help------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,358" id="srcline358">358</a></span><span class="line"><span class="comment">% A(end + 1,numOfAzi * 2 + numOfTunnel * 2 + numOfFpp * 2 + 1) = 1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,359" id="srcline359">359</a></span><span class="line"><span class="comment">% A(end + 1,numOfAzi * 2 + numOfTunnel * 2 + numOfFpp * 2 + 1) = 1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,360" id="srcline360">360</a></span><span class="line"><span class="comment">% A(end + 1,numOfAzi * 2 + numOfTunnel * 2 + numOfFpp * 2 + 1) = 1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,361" id="srcline361">361</a></span><span class="line"><span class="comment">% A(end + 1,numOfAzi * 2 + numOfTunnel * 2 + numOfFpp * 2 + 1) = -1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,362" id="srcline362">362</a></span><span class="line"><span class="comment">% A(end + 1,numOfAzi * 2 + numOfTunnel * 2 + numOfFpp * 2 + 1) = -1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,363" id="srcline363">363</a></span><span class="line"><span class="comment">% A(end + 1,numOfAzi * 2 + numOfTunnel * 2 + numOfFpp * 2 + 1) = -1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,364" id="srcline364">364</a></span><span class="line"><span class="comment">% b(end + 1) = -1000000;</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,365" id="srcline365">365</a></span><span class="line"><span class="comment">% b(end + 1) = -1000000;</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,366" id="srcline366">366</a></span><span class="line"><span class="comment">% b(end + 1) = -1000000;</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,367" id="srcline367">367</a></span><span class="line"><span class="comment">% b(end + 1) = 1000000;</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,368" id="srcline368">368</a></span><span class="line"><span class="comment">% b(end + 1) = 1000000;</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,369" id="srcline369">369</a></span><span class="line"><span class="comment">% b(end + 1) = 1000000;</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,370" id="srcline370">370</a></span><span class="line"><span class="comment">%-------------------------------------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,371" id="srcline371">371</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T7:U1586"><span class="var type1" id="S11T7U2150">init</span> == <span class="mxinfo " id="T7:U1588">true</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="86,372" id="srcline372">372</a></span><span class="line"><span class="mxinfo " id="T3:U1589"><span class="var type1" id="S68T3U2155">temp</span> = <span class="mxinfo " id="T3:U1591"><span class="mxinfo " id="T3:U1592"><span class="mxinfo " id="T3:U1593"><span class="var type1" id="S59T3U2159">numOfAzi</span> * <span class="mxinfo " id="T3:U1595">2</span></span> + <span class="mxinfo " id="T3:U1596"><span class="var type1" id="S58T3U2162">numOfTunnel</span> * <span class="mxinfo " id="T3:U1598">2</span></span></span> + <span class="mxinfo " id="T3:U1599"><span class="var type1" id="S60T3U2165">numOfFpp</span> * <span class="mxinfo " id="T3:U1601">2</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,373" id="srcline373">373</a></span><span class="line">    <span class="mxinfo " id="T3:U1602"><span class="mxinfo " id="T3:U1603"><span class="var type1" id="S52T28U2170">Aeq</span>(<span class="mxinfo " id="T3:U1605">1</span>,<span class="mxinfo " id="T3:U1606"><span class="var type1" id="S68T3U2173">temp</span> + <span class="mxinfo " id="T3:U1608">1</span></span>)</span> = <span class="mxinfo " id="T3:U1609">-<span class="mxinfo " id="T3:U1610">1</span></span></span>;<span class="comment">%s1</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,374" id="srcline374">374</a></span><span class="line">    <span class="mxinfo " id="T3:U1611"><span class="mxinfo " id="T3:U1612"><span class="var type1" id="S52T28U2180">Aeq</span>(<span class="mxinfo " id="T3:U1614">2</span>,<span class="mxinfo " id="T3:U1615"><span class="var type1" id="S68T3U2183">temp</span> + <span class="mxinfo " id="T3:U1617">2</span></span>)</span> = <span class="mxinfo " id="T3:U1618">-<span class="mxinfo " id="T3:U1619">1</span></span></span>;<span class="comment">%s2</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,375" id="srcline375">375</a></span><span class="line">    <span class="mxinfo " id="T3:U1620"><span class="mxinfo " id="T3:U1621"><span class="var type1" id="S52T28U2190">Aeq</span>(<span class="mxinfo " id="T3:U1623">3</span>,<span class="mxinfo " id="T3:U1624"><span class="var type1" id="S68T3U2193">temp</span> + <span class="mxinfo " id="T3:U1626">3</span></span>)</span> = <span class="mxinfo " id="T3:U1627">-<span class="mxinfo " id="T3:U1628">1</span></span></span>;<span class="comment">%s3</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,376" id="srcline376">376</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S70T3U2199">i</span> = <span class="mxinfo " id="T6:U1630"><span class="mxinfo " id="T3:U1631">1</span>:3</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,377" id="srcline377">377</a></span><span class="line">    <span class="mxinfo " id="T3:U1632"><span class="mxinfo " id="T3:U1633"><span class="var type1" id="S49T28U2206">H</span>(<span class="mxinfo " id="T3:U1635"><span class="mxinfo " id="T3:U1636"><span class="var type1" id="S57T3U2209">i_H</span> + <span class="var type1" id="S70T3U2210">i</span></span> - <span class="mxinfo " id="T3:U1639">1</span></span>,<span class="mxinfo " id="T3:U1640"><span class="mxinfo " id="T3:U1641"><span class="var type1" id="S57T3U2214">i_H</span> + <span class="var type1" id="S70T3U2215">i</span></span> - <span class="mxinfo " id="T3:U1644">1</span></span>)</span> = <span class="mxinfo " id="T3:U1645"><span class="mxinfo " id="T6:U1646"><span class="mxinfo " id="T26:U1647"><span class="var type1" id="S2T4U2220">thruster_data</span>(<span class="mxinfo " id="T3:U1649">1</span>)</span>.weight_s</span>(<span class="var type1" id="S70T3U2223">i</span>)</span></span>;<span class="comment">%!!!thruster_data(1) must be available</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,378" id="srcline378">378</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,379" id="srcline379">379</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,380" id="srcline380">380</a></span><span class="line"><span class="mxinfo " id="T28:U1651"><span class="var type1" id="S4T28U2226">Ho</span> = <span class="var type1" id="S49T28U2227">H</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,381" id="srcline381">381</a></span><span class="line"><span class="mxinfo " id="T1:U1654"><span class="var type1" id="S5T1U2230">fo</span> = <span class="var type1" id="S50T1U2231">f</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,382" id="srcline382">382</a></span><span class="line"><span class="mxinfo " id="T28:U1657"><span class="var type1" id="S6T28U2234">Ao</span> = <span class="var type1" id="S55T28U2235">A</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,383" id="srcline383">383</a></span><span class="line"><span class="mxinfo " id="T1:U1660"><span class="var type1" id="S7T1U2238">bo</span> = <span class="var type1" id="S56T1U2239">b</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,384" id="srcline384">384</a></span><span class="line"><span class="mxinfo " id="T28:U1663"><span class="var type1" id="S8T28U2242">Aeqo</span> = <span class="var type1" id="S52T28U2243">Aeq</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,385" id="srcline385">385</a></span><span class="line"><span class="mxinfo " id="T1:U1666"><span class="var type1" id="S9T1U2246">beqo</span> = <span class="var type1" id="S53T1U2247">beq</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="86,386" id="srcline386">386</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,387" id="srcline387">387</a></span><span class="line"></span></span>
</pre>
<div class="dead">
<pre class="code">
<span class="srcline"><span class="lineno"><a href="86,388" id="srcline388">388</a></span><span class="line">function [A,N] = N_sided_linear(error)</span></span>
<span class="srcline"><span class="lineno"><a href="86,389" id="srcline389">389</a></span><span class="line"><span class="comment">%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,390" id="srcline390">390</a></span><span class="line">N = floor(pi / (acos(1 - error))) + 1;</span></span>
<span class="srcline"><span class="lineno"><a href="86,391" id="srcline391">391</a></span><span class="line"><span class="comment">%     r = - R * cos(pi / N);%change &lt;= to &gt;=</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,392" id="srcline392">392</a></span><span class="line">phi = zeros(N,1);</span></span>
<span class="srcline"><span class="lineno"><a href="86,393" id="srcline393">393</a></span><span class="line">A = zeros(N,2);</span></span>
<span class="srcline"><span class="lineno"><a href="86,394" id="srcline394">394</a></span><span class="line">for i = 0 : (N - 1)</span></span>
<span class="srcline"><span class="lineno"><a href="86,395" id="srcline395">395</a></span><span class="line">    phi(i + 1) = (2 * i + 1) * pi / N;</span></span>
<span class="srcline"><span class="lineno"><a href="86,396" id="srcline396">396</a></span><span class="line">    A(i + 1,1) = - cos(phi(i + 1));<span class="comment">%change &lt;= to &gt;=</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,397" id="srcline397">397</a></span><span class="line">    A(i + 1,2) = - sin(phi(i + 1));<span class="comment">%change &lt;= to &gt;=</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,398" id="srcline398">398</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="86,399" id="srcline399">399</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="86,400" id="srcline400">400</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="86,401" id="srcline401">401</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="86,402" id="srcline402">402</a></span><span class="line">function [A,b,N] = N_sided_rudder(points)<span class="comment">%x,y</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,403" id="srcline403">403</a></span><span class="line"><span class="comment">%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,404" id="srcline404">404</a></span><span class="line"><span class="comment">% points =[0.980,0;0.965,0.0800;0.956,0.163;0.920,0.200;0.895,0.287;0.840,0.300</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,405" id="srcline405">405</a></span><span class="line"><span class="comment">%     0.811,0.341;0.770,0.345;0.743,0.347;0.720,0.300];</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,406" id="srcline406">406</a></span><span class="line">temp = flipud(points(2:end,:));</span></span>
<span class="srcline"><span class="lineno"><a href="86,407" id="srcline407">407</a></span><span class="line">temp(:,2) = -temp(:,2);</span></span>
<span class="srcline"><span class="lineno"><a href="86,408" id="srcline408">408</a></span><span class="line">points = [0 0;temp;points;0 0];</span></span>
<span class="srcline"><span class="lineno"><a href="86,409" id="srcline409">409</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="86,410" id="srcline410">410</a></span><span class="line">N = size(points,1) - 1;</span></span>
<span class="srcline"><span class="lineno"><a href="86,411" id="srcline411">411</a></span><span class="line">b = zeros(N,1);</span></span>
<span class="srcline"><span class="lineno"><a href="86,412" id="srcline412">412</a></span><span class="line">A = zeros(N,2);</span></span>
<span class="srcline"><span class="lineno"><a href="86,413" id="srcline413">413</a></span><span class="line"><span class="comment">%     points(end + 1,:) = points(1,:);</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,414" id="srcline414">414</a></span><span class="line">for i = 1 : N</span></span>
<span class="srcline"><span class="lineno"><a href="86,415" id="srcline415">415</a></span><span class="line">    A(i,1) = -points(i + 1,2) + points(i,2);</span></span>
<span class="srcline"><span class="lineno"><a href="86,416" id="srcline416">416</a></span><span class="line">    A(i,2) = -points(i,1) + points(i + 1,1);</span></span>
<span class="srcline"><span class="lineno"><a href="86,417" id="srcline417">417</a></span><span class="line">    b(i) = -points(i,1) * points(i + 1,2) + points(i + 1,1) * points(i,2);</span></span>
<span class="srcline"><span class="lineno"><a href="86,418" id="srcline418">418</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="86,419" id="srcline419">419</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="86,420" id="srcline420">420</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="86,421" id="srcline421">421</a></span><span class="line"><span class="comment">% check_rudder_constr(points,A,b);</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,422" id="srcline422">422</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="86,423" id="srcline423">423</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="86,424" id="srcline424">424</a></span><span class="line">function check = check_rudder_constr(points,A,b)</span></span>
<span class="srcline"><span class="lineno"><a href="86,425" id="srcline425">425</a></span><span class="line"><span class="comment">%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,426" id="srcline426">426</a></span><span class="line">check = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="86,427" id="srcline427">427</a></span><span class="line">[max_dat]=max(points,[],1);</span></span>
<span class="srcline"><span class="lineno"><a href="86,428" id="srcline428">428</a></span><span class="line">[min_dat]=min(points,[],1);</span></span>
<span class="srcline"><span class="lineno"><a href="86,429" id="srcline429">429</a></span><span class="line">interv = (max_dat - min_dat)/30;</span></span>
<span class="srcline"><span class="lineno"><a href="86,430" id="srcline430">430</a></span><span class="line">[x, y]=meshgrid(min_dat(1):interv:max_dat(1),min_dat(2):interv:max_dat(2));</span></span>
<span class="srcline"><span class="lineno"><a href="86,431" id="srcline431">431</a></span><span class="line">M=size(x,1);</span></span>
<span class="srcline"><span class="lineno"><a href="86,432" id="srcline432">432</a></span><span class="line">NN=size(x,2);</span></span>
<span class="srcline"><span class="lineno"><a href="86,433" id="srcline433">433</a></span><span class="line">dat_sav = [];</span></span>
<span class="srcline"><span class="lineno"><a href="86,434" id="srcline434">434</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="86,435" id="srcline435">435</a></span><span class="line">plot(points(:,2),points(:,1));</span></span>
<span class="srcline"><span class="lineno"><a href="86,436" id="srcline436">436</a></span><span class="line">axis equal</span></span>
<span class="srcline"><span class="lineno"><a href="86,437" id="srcline437">437</a></span><span class="line">hold on</span></span>
<span class="srcline"><span class="lineno"><a href="86,438" id="srcline438">438</a></span><span class="line">for i = 1:M</span></span>
<span class="srcline"><span class="lineno"><a href="86,439" id="srcline439">439</a></span><span class="line">    for j=1:NN</span></span>
<span class="srcline"><span class="lineno"><a href="86,440" id="srcline440">440</a></span><span class="line">        if A * [x(i,j) y(i,j)]' &gt;= b</span></span>
<span class="srcline"><span class="lineno"><a href="86,441" id="srcline441">441</a></span><span class="line">            dat_sav(end+1,:) = [x(i,j) y(i,j)];</span></span>
<span class="srcline"><span class="lineno"><a href="86,442" id="srcline442">442</a></span><span class="line">            plot(y(i,j),x(i,j),'*');</span></span>
<span class="srcline"><span class="lineno"><a href="86,443" id="srcline443">443</a></span><span class="line">            check = 1;</span></span>
<span class="srcline"><span class="lineno"><a href="86,444" id="srcline444">444</a></span><span class="line">        end</span></span>
<span class="srcline"><span class="lineno"><a href="86,445" id="srcline445">445</a></span><span class="line">    end</span></span>
<span class="srcline"><span class="lineno"><a href="86,446" id="srcline446">446</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="86,447" id="srcline447">447</a></span><span class="line">hold off</span></span>
<span class="srcline"><span class="lineno"><a href="86,448" id="srcline448">448</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="86,449" id="srcline449">449</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="86,450" id="srcline450">450</a></span><span class="line">function y = check_angle(phi_min,phi_,phi,phiPlus,phi_max)</span></span>
<span class="srcline"><span class="lineno"><a href="86,451" id="srcline451">451</a></span><span class="line">tol = 1e-8;<span class="comment">%!!!avoid numerical problem</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,452" id="srcline452">452</a></span><span class="line">if abs(phi_min - phi_max) &lt; tol<span class="comment">%phi_min == phi_max means no forbidden zone</span></span></span>
<span class="srcline"><span class="lineno"><a href="86,453" id="srcline453">453</a></span><span class="line">    k = true;</span></span>
<span class="srcline"><span class="lineno"><a href="86,454" id="srcline454">454</a></span><span class="line">else</span></span>
<span class="srcline"><span class="lineno"><a href="86,455" id="srcline455">455</a></span><span class="line">k = (angle_dist(phi_min,phi_)&lt;=angle_dist(phi_min,phi) + tol) ...</span></span>
<span class="srcline"><span class="lineno"><a href="86,456" id="srcline456">456</a></span><span class="line">    &amp;(angle_dist(phi_min,phi)&lt;=angle_dist(phi_min,phiPlus) + tol) ...</span></span>
<span class="srcline"><span class="lineno"><a href="86,457" id="srcline457">457</a></span><span class="line">    &amp; (angle_dist(phi,phiPlus)&lt;=angle_dist(phi,phi_max) + tol);</span></span>
<span class="srcline"><span class="lineno"><a href="86,458" id="srcline458">458</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="86,459" id="srcline459">459</a></span><span class="line">if prod(k) == 0</span></span>
<span class="srcline"><span class="lineno"><a href="86,460" id="srcline460">460</a></span><span class="line">    y = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="86,461" id="srcline461">461</a></span><span class="line">else</span></span>
<span class="srcline"><span class="lineno"><a href="86,462" id="srcline462">462</a></span><span class="line">    y = 1;</span></span>
<span class="srcline"><span class="lineno"><a href="86,463" id="srcline463">463</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="86,464" id="srcline464">464</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="86,465" id="srcline465">465</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="86,466" id="srcline466">466</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="86,467" id="srcline467">467</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="86,468" id="srcline468">468</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="86,469" id="srcline469">469</a></span><span class="line"> </span></span>
</pre>
</div>
